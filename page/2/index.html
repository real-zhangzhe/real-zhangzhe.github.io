<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"real-zhangzhe.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Zhangzhe&#39;s Blog">
<meta property="og:url" content="https://real-zhangzhe.github.io/page/2/index.html">
<meta property="og:site_name" content="Zhangzhe&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zhangzhe">
<meta property="article:tag" content="No mistakes in the tango, not like life.">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://real-zhangzhe.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Zhangzhe's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Zhangzhe's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The projection of my life.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/archives/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/08/14/A-Generalist-Agent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/14/A-Generalist-Agent/" class="post-title-link" itemprop="url">A Generalist Agent</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-08-14 15:10:15" itemprop="dateCreated datePublished" datetime="2025-08-14T15:10:15+08:00">2025-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VLA/" itemprop="url" rel="index"><span itemprop="name">VLA</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/08/14/A-Generalist-Agent/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/08/14/A-Generalist-Agent/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2205.06175">https://arxiv.org/pdf/2205.06175</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>è¿™ç¯‡è®ºæ–‡æ„å»ºäº†ä¸€ä¸ªå•ä¸€çš„é€šç”¨æ™ºèƒ½ä½“ <code>Gato</code>ï¼Œå®ƒå…·æœ‰å¤šæ¨¡æ€ã€å¤šä»»åŠ¡ã€å¤šå®æ–½æ–¹å¼èƒ½åŠ›ï¼Œæ˜¯ä¸€ä¸ªçº¯ç«¯åˆ°ç«¯çš„æ™ºèƒ½ä½“ï¼Œç”šè‡³å¯ä»¥ç›´æ¥ç»™å‡ºæœºæ¢°è‡‚åŠ¨ä½œæ§åˆ¶æŒ‡ä»¤ã€‚</li>
<li>æ¨¡å‹å°±æ˜¯ <code>1.2B</code> å‚æ•°çš„ <code>decoder only Transformer</code> æ¶æ„ï¼Œåªç”¨ä¸€ä»½æƒé‡å¯ä»¥ç© Atari æ¸¸æˆã€ç»™å›¾ç‰‡åŠ å­—å¹•ã€æ§åˆ¶æœºæ¢°æ‰‹è‡‚å †å ç§¯æœ¨ç­‰ 604 ä¸ªä»»åŠ¡ã€‚</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<p><img src="https://s2.loli.net/2025/08/14/BbYy1cLzkH5QqOA.png" alt="Gato.png" /></p>
<h3 id="ç¼–ç æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#ç¼–ç æ–¹æ¡ˆ"></a> ç¼–ç æ–¹æ¡ˆ</h3>
<p><code>Gato</code> å°†æ‰€æœ‰æ¨¡æ€çš„è¾“å…¥å’Œè¾“å‡ºéƒ½ç¼–ç ä¸ºæ•´æ•°åºåˆ—ï¼Œè¾“å‡ºé™¤äº†ä¸èƒ½è¾“å‡ºå›¾åƒä¹‹å¤–ï¼Œå…¶ä»–æ¨¡æ€éƒ½å¯ä»¥è¾“å‡ºã€‚</p>
<ul>
<li>æ–‡æœ¬ï¼šé€šè¿‡ <code>SentencePiece</code> æ–¹å¼ç¼–ç ï¼Œå…± <code>32000</code> ä¸ªå­å•è¯ç¼–ç ä¸ºæ•´æ•°èŒƒå›´ <code>[0, 32000)</code></li>
<li>å›¾åƒï¼šæŒ‰ç…§ <code>ViT</code> çš„ç¼–ç æ–¹å¼ï¼Œåˆ‡æˆä¸é‡å çš„ <code>16x16</code> çš„ <code>patches</code></li>
<li>ç¦»æ•£å€¼ï¼šå­˜å‚¨ä¸º <code>[0, 1024)</code> çš„æ•´æ•°åºåˆ—</li>
<li>è¿ç»­å€¼: ç¦»æ•£åŒ–ä¸º <code>1024</code> ä¸ªç®±å­ï¼Œå¹¶ç§»åˆ° <code>[32000, 33024)</code> çš„èŒƒå›´</li>
</ul>
<h3 id="è®­ç»ƒå’Œéƒ¨ç½²æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#è®­ç»ƒå’Œéƒ¨ç½²æ–¹æ¡ˆ"></a> è®­ç»ƒå’Œéƒ¨ç½²æ–¹æ¡ˆ</h3>
<ol>
<li>ä½¿ç”¨ <code>decoder only Transformer</code> æ¶æ„ï¼Œåšè‡ªå›å½’è®­ç»ƒï¼Œå›¾åƒåˆ‡æˆ <code>16x16</code> çš„ <code>patches</code> åï¼Œå½’ä¸€åŒ–åˆ° <code>[-1, 1]</code> ä¹‹é—´ï¼Œå†ç”¨ <code>Resnet</code> å°†å›¾åƒç¼–ç æˆå¤šä¸ªç‰¹å¾å‘é‡å’Œå…¶ä»–æ¨¡æ€çš„ç‰¹å¾å‘é‡æ‹¼æ¥èµ·æ¥ï¼Œä½œä¸ºè¾“å…¥ã€‚</li>
<li>ä»€ä¹ˆå‚ä¸è‡ªå›å½’è®­ç»ƒï¼Ÿä»€ä¹ˆä¸å‚ä¸ï¼Ÿ
<ul>
<li>å‚ä¸è‡ªå›å½’è®­ç»ƒçš„ï¼šæ–‡æœ¬ç¬¦å…ƒã€ç¦»æ•£å’Œè¿ç»­å€¼ä»¥åŠåŠ¨ä½œ</li>
<li>ä¸å‚ä¸è‡ªå›å½’è®­ç»ƒçš„ï¼šå›¾åƒã€æ™ºèƒ½ä½“è§‚æµ‹åˆ°çš„éæ–‡æœ¬ä¿¡æ¯ï¼ˆæ¯”å¦‚æœºæ¢°è‡‚çš„å…³èŠ‚å‚æ•°ç­‰ï¼‰</li>
</ul>
</li>
<li>è®­ç»ƒç»“æŸåï¼Œæ¨¡å‹èƒ½åšä»€ä¹ˆï¼Ÿ
<ul>
<li>è®­ç»ƒæ—¶å€™æ²¡æœ‰å±è”½ä»€ä¹ˆï¼Œè®­ç»ƒæ”¶æ•›çš„æ¨¡å‹å°±èƒ½åšä»€ä¹ˆã€‚</li>
</ul>
</li>
<li>è®­ç»ƒæ—¶å›ºå®šä¸Šä¸‹æ–‡é•¿åº¦ä¸º <code>1024</code>ï¼Œè¶…è¿‡ <code>1024</code> çš„æ•°æ®ä¼šè¢«éšæœºæˆªå– <code>1024</code></li>
<li>æ¨ç†æ—¶ä¸é™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦<br />
<img src="https://s2.loli.net/2025/08/14/CxgKYfheaGRJumr.png" alt="gato2.png" /></li>
</ol>
<h3 id="å®éªŒç»“æœ"><a class="markdownIt-Anchor" href="#å®éªŒç»“æœ"></a> å®éªŒç»“æœ</h3>
<ul>
<li>åœ¨ <code>604</code> é¡¹ä»»åŠ¡ä¸­ï¼Œæœ‰ <code>450</code> é¡¹ä»»åŠ¡èƒ½å¤Ÿè¾¾åˆ°ä¸“å®¶åˆ†æ•°çš„ <code>50%</code></li>
<li>è®ºæ–‡ä¸­æœ‰æ¯ä¸ªä»»åŠ¡ç±»å‹çš„è¯¦ç»†ç»“æœï¼Œå¯ä»¥å‚è€ƒè®ºæ–‡</li>
</ul>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>æŠŠè¿™ä¹ˆå¤šç§ä»»åŠ¡æŠ½è±¡æˆä¸€ç§ç¼–ç ï¼Œç„¶åç”¨ä¸€ä¸ª <code>1.2B</code> å‚æ•°çš„æ¨¡å‹æ¥å¤„ç†ï¼Œè¿™ä¸ªæƒ³æ³•å¾ˆå‰å®³</li>
<li>ç¼–ç æ–¹å¼æœ‰ç‚¹å¤æ‚ï¼Œå¯ä»¥å¯¹æ¯”ä¸‹å°†å›¾ç‰‡ä¹‹å¤–çš„æ¨¡æ€è½¬æˆæ–‡æœ¬ï¼Œç„¶åç”¨ <code>tokenizer</code> ç¼–ç çš„æœ€ç»ˆæ•ˆæœ</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/08/10/On-the-Generalization-of-SFT-A-Reinforcement-Learning-Perspective-with-Reward-Rectification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/10/On-the-Generalization-of-SFT-A-Reinforcement-Learning-Perspective-with-Reward-Rectification/" class="post-title-link" itemprop="url">On the Generalization of SFT: A Reinforcement Learning Perspective with Reward Rectification</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-08-10 15:14:11" itemprop="dateCreated datePublished" datetime="2025-08-10T15:14:11+08:00">2025-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SFT/" itemprop="url" rel="index"><span itemprop="name">SFT</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/08/10/On-the-Generalization-of-SFT-A-Reinforcement-Learning-Perspective-with-Reward-Rectification/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/08/10/On-the-Generalization-of-SFT-A-Reinforcement-Learning-Perspective-with-Reward-Rectification/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2508.05629">https://arxiv.org/pdf/2508.05629</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/yongliang-wu/DFT">https://github.com/yongliang-wu/DFT</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>æœ¬æ–‡è¯æ˜ä¼ ç»Ÿ <code>SFT</code> è¿‡ç¨‹å¸¸ç”¨çš„ <code>Cross Entropy Loss</code> çš„æ¢¯åº¦ç­‰ä»·äº <code>Reinforcement Learning</code> ä¸­ç­–ç•¥æ¢¯åº¦æ›´æ–°ï¼Œä½†éšå«ä¸€ä¸ªç—…æ€çš„å¥–åŠ±ç»“æ„ï¼šç¨€ç–å¥–åŠ±å’Œé€†æ¦‚ç‡æƒé‡ç»“åˆï¼Œå¯¼è‡´ <font color=red>æ¨¡å‹å¯¹ä½æ¦‚ç‡æ ·æœ¬è¿‡æ‹Ÿåˆ</font>ã€‚</li>
<li>è§£å†³æ–¹æ¡ˆç‰¹åˆ«ç®€å•ï¼š<font color=red>åœ¨æ¯ä¸ª <code>token</code> çš„æŸå¤±å‰ä¹˜å½“å‰ <code>token</code> çš„æ¦‚ç‡ä½œä¸ºæƒé‡</font>ã€‚</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="å…¬å¼è§’åº¦"><a class="markdownIt-Anchor" href="#å…¬å¼è§’åº¦"></a> å…¬å¼è§’åº¦</h3>
<ul>
<li>ä¼ ç»Ÿ <code>SFT</code> è¿‡ç¨‹çš„æŸå¤±å‡½æ•°ï¼š</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">âˆ‡</mi><mi mathvariant="bold-italic">Î¸</mi></msub><msub><mi mathvariant="script">L</mi><mrow><mi mathvariant="normal">S</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">T</mi></mrow></msub><mo stretchy="false">(</mo><mi mathvariant="bold-italic">Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><msub><mi mathvariant="double-struck">E</mi><mrow><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ¼</mo><msub><mi>Ï€</mi><mi mathvariant="bold-italic">Î¸</mi></msub></mrow></msub><mrow><mo fence="true">[</mo><munder><munder><mfrac><mn>1</mn><mrow><msub><mi>Ï€</mi><mi mathvariant="bold-italic">Î¸</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo>âˆ£</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac><mo stretchy="true">âŸ</mo></munder><mtext>é€†æ¦‚ç‡æƒé‡</mtext></munder><mo>â‹…</mo><munder><munder><mrow><mn mathvariant="double-struck">1</mn><mo stretchy="false">[</mo><mi>y</mi><mo>=</mo><msup><mi>y</mi><mo lspace="0em" rspace="0em">âˆ—</mo></msup><mo stretchy="false">]</mo></mrow><mo stretchy="true">âŸ</mo></munder><mtext>ç¨€ç–å¥–åŠ±</mtext></munder><mo>â‹…</mo><msub><mi mathvariant="normal">âˆ‡</mi><mi mathvariant="bold-italic">Î¸</mi></msub><mi>log</mi><mo>â¡</mo><msub><mi>Ï€</mi><mi mathvariant="bold-italic">Î¸</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo>âˆ£</mo><mi>x</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla_{\boldsymbol{\theta}}\mathcal{L}_{\mathrm{SFT}}(\boldsymbol{\theta}) = 
- \mathbb{E}_{x,y \sim \pi_{\boldsymbol{\theta}}}
\left[ 
    \underbrace{\frac{1}{\pi_{\boldsymbol{\theta}}(y \mid x)}}_{\text{é€†æ¦‚ç‡æƒé‡}}
    \cdot 
    \underbrace{\mathbb{1}[y = y^{*}]}_{\text{ç¨€ç–å¥–åŠ±}}
    \cdot 
    \nabla_{\boldsymbol{\theta}} \log \pi_{\boldsymbol{\theta}}(y \mid x)
\right]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">âˆ‡</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right:0.03194em;">Î¸</span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">S</span><span class="mord mathrm mtight">F</span><span class="mord mathrm mtight">T</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03194em;">Î¸</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.915331em;vertical-align:-2.262331em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mord"><span class="mord mathbb">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mrel mtight">âˆ¼</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right:0.03194em;">Î¸</span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214399999999997em;"><span style="top:-1.0591089999999999em;"><span class="pstrut" style="height:3.32144em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">é€†æ¦‚ç‡æƒé‡</span></span></span></span></span><span style="top:-3.32144em;"><span class="pstrut" style="height:3.32144em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span class="svg-align" style="top:-1.7374399999999999em;"><span class="pstrut" style="height:3.32144em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3.32144em;"><span class="pstrut" style="height:3.32144em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right:0.03194em;">Î¸</span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.584em;"><span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.262331em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7499999999999998em;"><span style="top:-1.4236689999999999em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">ç¨€ç–å¥–åŠ±</span></span></span></span></span><span style="top:-2.9999999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em;"><span class="svg-align" style="top:-2.102em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">1</span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.738696em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ—</span></span></span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.898em;"><span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5763310000000001em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">âˆ‡</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right:0.03194em;">Î¸</span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right:0.03194em;">Î¸</span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<ul>
<li><code>DFT</code> æŸå¤±å‡½æ•°ï¼š</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="script">L</mi><mrow><mi mathvariant="normal">D</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">T</mi></mrow></msub><mo>=</mo><mo>âˆ’</mo><msub><mi>E</mi><mrow><mrow><mo fence="true">(</mo><mi>x</mi><mo separator="true">,</mo><msup><mi>y</mi><mo lspace="0em" rspace="0em">âˆ—</mo></msup><mo fence="true">)</mo></mrow><mo>âˆ¼</mo><mi mathvariant="script">D</mi></mrow></msub><munderover><mo>âˆ‘</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow><mo fence="true">âˆ£</mo><msup><mi>y</mi><mo lspace="0em" rspace="0em">âˆ—</mo></msup><mo fence="true">âˆ£</mo></mrow></munderover><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">g</mi></mrow><mrow><mo fence="true">(</mo><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mrow><mo fence="true">(</mo><msubsup><mi>y</mi><mi>t</mi><mo lspace="0em" rspace="0em">âˆ—</mo></msubsup><mo>âˆ£</mo><msubsup><mi>y</mi><mrow><mo>&lt;</mo><mi>t</mi></mrow><mo lspace="0em" rspace="0em">âˆ—</mo></msubsup><mo separator="true">,</mo><mi>x</mi><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mi>log</mi><mo>â¡</mo><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mrow><mo fence="true">(</mo><msubsup><mi>y</mi><mi>t</mi><mo lspace="0em" rspace="0em">âˆ—</mo></msubsup><mo>âˆ£</mo><msubsup><mi>y</mi><mrow><mo>&lt;</mo><mi>t</mi></mrow><mo lspace="0em" rspace="0em">âˆ—</mo></msubsup><mo separator="true">,</mo><mi>x</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\mathrm{DFT}} = - E_{\left(x, y^{*}\right)\sim\mathcal{D}} \sum_{t=1}^{\left|y^{*}\right|} \mathrm{sg}\left(\pi_{\theta}\left(y_{t}^{*}\mid y_{&lt;t}^{*},x\right)\right) \log\pi_{\theta}\left(y_{t}^{*}\mid y_{&lt;t}^{*},x\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">D</span><span class="mord mathrm mtight">F</span><span class="mord mathrm mtight">T</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.237458em;vertical-align:-1.267113em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">(</span></span><span class="mord mathnormal mtight">x</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6183428571428571em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ—</span></span></span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">)</span></span></span><span class="mrel mtight">âˆ¼</span><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9703450000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.386005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">âˆ£</span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7633428571428571em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ—</span></span></span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">âˆ£</span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">s</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7386959999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.738696em;"><span style="top:-2.453em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.27437em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7386959999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.738696em;"><span style="top:-2.453em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ—</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.27437em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<ul>
<li>æ³¨æ„ï¼šè¿™é‡Œçš„ <code>sg</code> æ˜¯ <code>stop gradient</code> æ“ä½œï¼Œå³ä¸è®¡ç®—æ¢¯åº¦ <font color=red>å¯¹åº” pytorch ä¸­å¸¸ç”¨çš„ .detach() æ“ä½œ</font>ã€‚</li>
</ul>
<h3 id="ä»£ç è§’åº¦"><a class="markdownIt-Anchor" href="#ä»£ç è§’åº¦"></a> ä»£ç è§’åº¦</h3>
<p><img src="https://s2.loli.net/2025/08/10/GdIl2HrfgcnFa5m.png" alt=" 2025-08-10 154116.png" /></p>
<ul>
<li><code>a</code> è¡¨ç¤ºé¢„æµ‹åºåˆ—ä¸­æŸä¸ªä½ç½®çš„çš„ <code>logits</code></li>
<li><code>b</code> è¡¨ç¤ºå¯¹åº”ä½ç½®çš„ <code>GT</code></li>
<li><code>cross entropy loss</code> å°±æ˜¯ <code>-log(softmax(a))[b]</code></li>
<li><code>DFT</code> æŸå¤±å‡½æ•°å°±æ˜¯ <code>-(softmax(a) * log(softmax(a)))[b]</code>ï¼Œä½†æ³¨æ„è¦ <code>stop gradient</code>ï¼Œ<code>softmax(a)</code> åªä½œä¸ºç³»æ•°ï¼Œåå‘ä¼ æ’­ä¸ä¼˜åŒ–ã€‚</li>
</ul>
<h3 id="å‡½æ•°è§’åº¦"><a class="markdownIt-Anchor" href="#å‡½æ•°è§’åº¦"></a> å‡½æ•°è§’åº¦</h3>
<p><img src="https://s2.loli.net/2025/08/10/GI2Eb76vr4zp1Zo.png" alt="dft2.png" /></p>
<ul>
<li>è“è‰²æ˜¯æ ‡å‡† <code>SFT</code> è¿‡ç¨‹çš„æŸå¤±å‡½æ•°ï¼ˆäº¤å‰ç†µï¼‰</li>
<li>çº¢è‰²æ˜¯æœ¬æ–‡æå‡ºçš„ <code>DFT</code> æŸå¤±å‡½æ•°</li>
<li>ç»¿è‰²æ˜¯æˆ‘è‡ªå·±è„‘è¡¥çš„ <code>DFT</code> å‡½æ•°æ‰©å±•ä¹‹åçš„æŸå¤±å‡½æ•°ï¼Œä¼˜ç‚¹æ˜¯æ¯” <code>DFT</code> å¯¹ç§°æ€§æ›´å¥½ï¼Œæ•ˆæœæ€ä¹ˆæ ·ä¸çŸ¥é“â€¦</li>
<li>ä»å‡½æ•°è§’åº¦çœ‹ï¼Œ<code>SFT</code> åœ¨æŸä¸ªä½ç½® <code>GT</code> éå¸¸å†·é—¨çš„æƒ…å†µä¸‹ï¼Œ<code>-log(softmax(a))</code> ä¼šè¶‹å‘äº <code>inf</code>ï¼Œå¯¼è‡´æ¨¡å‹å¯¹è¿™ä¸ªå†·é—¨çš„ <code>token</code> åšäº†è¿‡å¤§çš„å‚æ•°æ›´æ–°ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼ˆå› ä¸ºæ¨¡å‹å·²ç»ç»è¿‡äº†é¢„è®­ç»ƒï¼Œç”¨éå¸¸ä½çš„æ¦‚ç‡é¢„æµ‹ <code>GT</code> è¯´æ˜è¿™ä¸ª <code>GT</code> å¯èƒ½æ˜¯å™ªå£°ï¼‰ã€‚</li>
<li>è€Œ <code>DFT</code> çš„å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å‹ <font color=red>ä¼˜å…ˆå…³æ³¨ä¸è¿‡åˆ†éš¾æˆ–è¿‡åˆ†ç®€å•çš„ token</font>ï¼Œå¤ªéš¾çš„å¯èƒ½æ˜¯æ•°æ®å™ªå£°ï¼Œå¤ªç®€å•çš„æœ¬èº«å°±æ²¡ä»€ä¹ˆå¥½å­¦çš„ã€‚</li>
</ul>
<h2 id="thoughts"><a class="markdownIt-Anchor" href="#thoughts"></a> Thoughts</h2>
<ul>
<li>ä»å‡½æ•°è§’åº¦çœ‹ï¼šå¤ªéš¾çš„æˆ‘ä¸å­¦ï¼Œå› ä¸ºå¤ªéš¾ï¼›å¤ªç®€å•çš„æˆ‘ä¸å­¦ï¼Œå› ä¸ºå¤ªç®€å•ã€‚</li>
<li><s>éƒ­å¾·çº²ï¼šæˆ‘æœ‰å››ä¸åƒâ€¦</s>ğŸ˜‚ğŸ˜‚ğŸ˜‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/07/24/%E7%94%A8-langchain-%E5%AE%9E%E7%8E%B0-RAG-%E7%9A%84-demo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/24/%E7%94%A8-langchain-%E5%AE%9E%E7%8E%B0-RAG-%E7%9A%84-demo/" class="post-title-link" itemprop="url">ç”¨ langchain å®ç° RAG çš„ demo</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-24 20:59:47" itemprop="dateCreated datePublished" datetime="2025-07-24T20:59:47+08:00">2025-07-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Agent/" itemprop="url" rel="index"><span itemprop="name">Agent</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/07/24/%E7%94%A8-langchain-%E5%AE%9E%E7%8E%B0-RAG-%E7%9A%84-demo/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/07/24/%E7%94%A8-langchain-%E5%AE%9E%E7%8E%B0-RAG-%E7%9A%84-demo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li><code>langchain Semi-structured RAG cookbook</code>ï¼š<a target="_blank" rel="noopener" href="https://github.com/langchain-ai/langchain/blob/master/cookbook/Semi_Structured_RAG.ipynb">https://github.com/langchain-ai/langchain/blob/master/cookbook/Semi_Structured_RAG.ipynb</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li><code>langchain</code> çš„ <code>Semi-structured RAG</code> çš„ <code>demo</code>ï¼ŒåŒ…å« <code>PDF</code> çš„ è§£æ -&gt; å‘é‡åŒ– -&gt; å­˜å‚¨ -&gt; æ£€ç´¢ -&gt; å›ç­” çš„å…¨æµç¨‹</li>
<li>æ¥è‡ª <code>langchain</code> å®˜æ–¹çš„ <code>cookbook</code>ï¼Œå€¼å¾—å‚è€ƒ</li>
</ul>
<h2 id="æ€»ä½“æµç¨‹"><a class="markdownIt-Anchor" href="#æ€»ä½“æµç¨‹"></a> æ€»ä½“æµç¨‹</h2>
<p><img src="https://s2.loli.net/2025/07/24/pPAL3JkjGKb5ohH.png" alt="langchain_rag_demo.png" /></p>
<ol>
<li><strong>è§£æ <code>PDF</code> æ–‡ä»¶</strong>ã€‚ç”¨ <code>partition_pdf</code> å·¥å…·ï¼Œå°† <code>PDF</code> æ–‡ä»¶è§£æä¸º <code>chunks</code>ï¼Œåˆ†æˆæ–‡æœ¬å’Œè¡¨æ ¼ä¸¤ç§</li>
<li><strong>æ€»ç»“ <code>chunks</code></strong>ã€‚ç”¨å¤§æ¨¡å‹ <code>API</code> æ€»ç»“ <code>chunks</code>ï¼Œå¾—åˆ° <code>summary</code>ï¼Œç”¨å“ªå®¶çš„æ¨¡å‹éƒ½è¡Œ</li>
<li><strong>å‘é‡åŒ– <code>summary</code></strong>ã€‚è°ƒç”¨ <code>embedding</code> æ¨¡å‹ <code>API</code> å¯¹ <code>summary</code> è¿›è¡Œå‘é‡åŒ–ï¼Œä½œä¸ºç´¢å¼•çš„ <code>key</code>ï¼ˆ<code>value</code> æ˜¯åŸå§‹æ–‡æœ¬/è¡¨æ ¼ï¼‰ï¼Œå­˜åˆ° <code>Chroma</code> æ•°æ®åº“ä¸­</li>
<li><strong>é—®ç­”æ—¶è‡ªåŠ¨æ£€ç´¢</strong>ã€‚åœ¨é—®ç­”æ—¶ï¼Œä¼šè‡ªåŠ¨æ ¹æ®é—®é¢˜å‘é‡åœ¨ <code>Chroma</code> æ•°æ®åº“ä¸­æ£€ç´¢å‡ºæœ€ç›¸ä¼¼çš„ <code>summary</code>ï¼Œå°† <code>summary</code> å‘é‡å¯¹åº”çš„åŸå§‹æ–‡æœ¬/è¡¨æ ¼ä½œä¸º <code>prompt</code> ä¸­çš„ <code>context</code> åŸŸä¼ ç»™å¤§æ¨¡å‹ï¼Œå¾—åˆ°å›ç­”</li>
</ol>
<h2 id="å…·ä½“å®ç°ä»£ç "><a class="markdownIt-Anchor" href="#å…·ä½“å®ç°ä»£ç "></a> å…·ä½“å®ç°ä»£ç </h2>
<h3 id="1-è§£æ-pdf-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#1-è§£æ-pdf-æ–‡ä»¶"></a> 1. è§£æ <code>PDF</code> æ–‡ä»¶</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> unstructured.partition.pdf <span class="keyword">import</span> partition_pdf</span><br><span class="line"></span><br><span class="line">path = <span class="string">&quot;/Users/rlm/Desktop/Papers/LLaMA2/&quot;</span></span><br><span class="line"><span class="comment"># Get elements</span></span><br><span class="line">raw_pdf_elements = partition_pdf(</span><br><span class="line">    filename=path + <span class="string">&quot;LLaMA2.pdf&quot;</span>,</span><br><span class="line">    <span class="comment"># Unstructured first finds embedded image blocks</span></span><br><span class="line">    extract_images_in_pdf=<span class="literal">False</span>,</span><br><span class="line">    <span class="comment"># Use layout model (YOLOX) to get bounding boxes (for tables) and find titles</span></span><br><span class="line">    <span class="comment"># Titles are any sub-section of the document</span></span><br><span class="line">    infer_table_structure=<span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># Post processing to aggregate text once we have the title</span></span><br><span class="line">    chunking_strategy=<span class="string">&quot;by_title&quot;</span>,</span><br><span class="line">    <span class="comment"># Chunking params to aggregate text blocks</span></span><br><span class="line">    <span class="comment"># Attempt to create a new chunk 3800 chars</span></span><br><span class="line">    <span class="comment"># Attempt to keep chunks &gt; 2000 chars</span></span><br><span class="line">    max_characters=<span class="number">4000</span>,</span><br><span class="line">    new_after_n_chars=<span class="number">3800</span>,</span><br><span class="line">    combine_text_under_n_chars=<span class="number">2000</span>,</span><br><span class="line">    image_output_dir_path=path,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="2-æ€»ç»“-chunks-å¾—åˆ°-summary"><a class="markdownIt-Anchor" href="#2-æ€»ç»“-chunks-å¾—åˆ°-summary"></a> 2. æ€»ç»“ <code>chunks</code> å¾—åˆ° <code>summary</code></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prompt</span></span><br><span class="line">prompt_text = <span class="string">&quot;&quot;&quot;You are an assistant tasked with summarizing tables and text. \ </span></span><br><span class="line"><span class="string">Give a concise summary of the table or text. Table or text chunk: &#123;element&#125; &quot;&quot;&quot;</span></span><br><span class="line">prompt = ChatPromptTemplate.from_template(prompt_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Summary chain</span></span><br><span class="line">model = ChatOpenAI(temperature=<span class="number">0</span>, model=<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">summarize_chain = &#123;<span class="string">&quot;element&quot;</span>: <span class="keyword">lambda</span> x: x&#125; | prompt | model | StrOutputParser()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply to tables</span></span><br><span class="line">tables = [i.text <span class="keyword">for</span> i <span class="keyword">in</span> table_elements]</span><br><span class="line">table_summaries = summarize_chain.batch(tables, &#123;<span class="string">&quot;max_concurrency&quot;</span>: <span class="number">5</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply to texts</span></span><br><span class="line">texts = [i.text <span class="keyword">for</span> i <span class="keyword">in</span> text_elements]</span><br><span class="line">text_summaries = summarize_chain.batch(texts, &#123;<span class="string">&quot;max_concurrency&quot;</span>: <span class="number">5</span>&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>langchain</code> ç”¨ <code>|</code> ç¬¦å·å°±å¯ä»¥æŠŠå¤šä¸ªå·¥å…·ä¸²æˆä¸€ä¸ª <code>chain</code>ï¼Œéå¸¸æ–¹ä¾¿</p>
</blockquote>
<h3 id="3-å‘é‡åŒ–-summary-å¹¶å­˜åˆ°-chroma-æ•°æ®åº“ä¸­"><a class="markdownIt-Anchor" href="#3-å‘é‡åŒ–-summary-å¹¶å­˜åˆ°-chroma-æ•°æ®åº“ä¸­"></a> 3. å‘é‡åŒ– <code>summary</code> å¹¶å­˜åˆ° <code>Chroma</code> æ•°æ®åº“ä¸­</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.multi_vector <span class="keyword">import</span> MultiVectorRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.storage <span class="keyword">import</span> InMemoryStore</span><br><span class="line"><span class="keyword">from</span> langchain_chroma <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain_core.documents <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># The vectorstore to use to index the child chunks</span></span><br><span class="line">vectorstore = Chroma(collection_name=<span class="string">&quot;summaries&quot;</span>, embedding_function=OpenAIEmbeddings())</span><br><span class="line"></span><br><span class="line"><span class="comment"># The storage layer for the parent documents</span></span><br><span class="line">store = InMemoryStore()</span><br><span class="line">id_key = <span class="string">&quot;doc_id&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The retriever (empty to start)</span></span><br><span class="line">retriever = MultiVectorRetriever(</span><br><span class="line">    vectorstore=vectorstore,</span><br><span class="line">    docstore=store,</span><br><span class="line">    id_key=id_key,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add texts</span></span><br><span class="line">doc_ids = [<span class="built_in">str</span>(uuid.uuid4()) <span class="keyword">for</span> _ <span class="keyword">in</span> texts]</span><br><span class="line">summary_texts = [</span><br><span class="line">    Document(page_content=s, metadata=&#123;id_key: doc_ids[i]&#125;)</span><br><span class="line">    <span class="keyword">for</span> i, s <span class="keyword">in</span> <span class="built_in">enumerate</span>(text_summaries)</span><br><span class="line">]</span><br><span class="line">retriever.vectorstore.add_documents(summary_texts)</span><br><span class="line">retriever.docstore.mset(<span class="built_in">list</span>(<span class="built_in">zip</span>(doc_ids, texts)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add tables</span></span><br><span class="line">table_ids = [<span class="built_in">str</span>(uuid.uuid4()) <span class="keyword">for</span> _ <span class="keyword">in</span> tables]</span><br><span class="line">summary_tables = [</span><br><span class="line">    Document(page_content=s, metadata=&#123;id_key: table_ids[i]&#125;)</span><br><span class="line">    <span class="keyword">for</span> i, s <span class="keyword">in</span> <span class="built_in">enumerate</span>(table_summaries)</span><br><span class="line">]</span><br><span class="line">retriever.vectorstore.add_documents(summary_tables)</span><br><span class="line">retriever.docstore.mset(<span class="built_in">list</span>(<span class="built_in">zip</span>(table_ids, tables)))</span><br></pre></td></tr></table></figure>
<h3 id="4-é—®ç­”æ—¶è‡ªåŠ¨æ£€ç´¢"><a class="markdownIt-Anchor" href="#4-é—®ç­”æ—¶è‡ªåŠ¨æ£€ç´¢"></a> 4. é—®ç­”æ—¶è‡ªåŠ¨æ£€ç´¢</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnablePassthrough</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prompt template</span></span><br><span class="line">template = <span class="string">&quot;&quot;&quot;Answer the question based only on the following context, which can include text and tables:</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string">Question: &#123;question&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">prompt = ChatPromptTemplate.from_template(template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># LLM</span></span><br><span class="line">model = ChatOpenAI(temperature=<span class="number">0</span>, model=<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># RAG pipeline</span></span><br><span class="line">chain = (</span><br><span class="line">    &#123;<span class="string">&quot;context&quot;</span>: retriever, <span class="string">&quot;question&quot;</span>: RunnablePassthrough()&#125;</span><br><span class="line">    | prompt</span><br><span class="line">    | model</span><br><span class="line">    | StrOutputParser()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># run the chain</span></span><br><span class="line">chain.invoke(<span class="string">&quot;What is the number of training tokens for LLaMA2?&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h2>
<ol>
<li><code>langchain</code> åšäº†éå¸¸å¤šçš„å·¥å…·ï¼Œå¹¶ç»™å‡ºä¸€ç§å°†è¿™äº›å·¥å…·éå¸¸å®¹æ˜“ç»„åˆä½¿ç”¨çš„æ–¹æ³•</li>
<li>æ›´é‡è¦çš„æ˜¯ï¼Œ<code>langsmith</code> æä¾›äº†éå¸¸æ–¹ä¾¿çš„ <code>trace</code> åŠŸèƒ½ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿½è¸ªä¸€æ¬¡é—®ç­”è¿‡ç¨‹ä¸­ç»è¿‡äº†å“ªäº›æ¨¡å‹/å·¥å…·/è¡Œä¸ºï¼Œä»¥åŠè¿™äº›æ¨¡å‹/å·¥å…·/è¡Œä¸ºçš„ <code>input</code> / <code>output</code> / è€—æ—¶ç­‰ï¼Œéå¸¸æ–¹ä¾¿</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/07/21/Qwen2-5-VL-Technical-Report/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/21/Qwen2-5-VL-Technical-Report/" class="post-title-link" itemprop="url">Qwen2.5-VL Technical Report</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-21 10:47:30" itemprop="dateCreated datePublished" datetime="2025-07-21T10:47:30+08:00">2025-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VLM/" itemprop="url" rel="index"><span itemprop="name">VLM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/07/21/Qwen2-5-VL-Technical-Report/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/07/21/Qwen2-5-VL-Technical-Report/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2502.13923">https://arxiv.org/pdf/2502.13923</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/QwenLM/Qwen2.5-VL">https://github.com/QwenLM/Qwen2.5-VL</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li><code>Qwen2.5-VL</code> æ˜¯ <code>Qwen</code> å›¢é˜Ÿæ¨å‡ºçš„ä¸€ä¸ªå¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œåœ¨ <code>Qwen2.5</code> çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†è§†è§‰æ¨¡æ€çš„æ”¯æŒï¼Œè¾“å…¥æ”¯æŒ <code>text</code> å’Œ <code>image</code> å’Œ <code>video</code> çš„æ··åˆè¾“å…¥ï¼Œè¾“å‡ºä¸º <code>text</code></li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<p><img src="https://s2.loli.net/2025/07/21/BYQy9KAc4oCdSJX.png" alt="qwen2.5-vl.png" /></p>
<h3 id="æ¨¡å‹æ¶æ„"><a class="markdownIt-Anchor" href="#æ¨¡å‹æ¶æ„"></a> æ¨¡å‹æ¶æ„</h3>
<ul>
<li>è§†è§‰ç¼–ç å™¨ï¼ˆ<code>Vision Encoder</code>ï¼‰ï¼šåŸºäºé‡æ–°è®¾è®¡çš„ <code>Vision Transformer</code>ï¼ˆ<code>ViT</code>ï¼‰ï¼Œå¤„ç†åŸç”Ÿåˆ†è¾¨ç‡çš„å›¾åƒå’Œè§†é¢‘è¾“å…¥</li>
<li>è¯­è¨€æ¨¡å‹ï¼ˆ<code>Large Language Model</code>ï¼Œ<code>LLM</code>ï¼‰ï¼šåŸºäº <code>Qwen2.5</code> <code>LLM</code>ï¼Œè´Ÿè´£æ–‡æœ¬ç†è§£å’Œç”Ÿæˆï¼Œåˆå§‹åŒ–æ—¶é¢„è®­ç»ƒæƒé‡è¢«å¾®è°ƒä»¥æ”¯æŒå¤šæ¨¡æ€ä»»åŠ¡</li>
<li>è§†è§‰-è¯­è¨€åˆå¹¶å™¨ï¼ˆ<code>Vision-Language Merger</code>ï¼‰ï¼šä¸€ä¸ª <code>MLP-based</code> æ¨¡å—ï¼Œå‹ç¼©è§†è§‰ç‰¹å¾ä»¥åŒ¹é…æ–‡æœ¬åµŒå…¥ç»´åº¦ï¼Œå‡å°‘è®¡ç®—å¼€é”€</li>
</ul>
<h3 id="ä¸‰é˜¶æ®µè®­ç»ƒ"><a class="markdownIt-Anchor" href="#ä¸‰é˜¶æ®µè®­ç»ƒ"></a> ä¸‰é˜¶æ®µè®­ç»ƒ</h3>
<h4 id="ç¬¬ä¸€é˜¶æ®µ"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€é˜¶æ®µ"></a> ç¬¬ä¸€é˜¶æ®µ</h4>
<ul>
<li>éšæœºåˆå§‹åŒ– <code>Vision Encoder</code> å¼€å§‹è®­ç»ƒ</li>
<li>ä½¿ç”¨çš„ <code>(text, image)</code> æ•°æ®å¦‚ä¸‹ï¼š
<ul>
<li><code>Image captions</code>ï¼šå›¾åƒå’Œå¯¹åº”çš„æ–‡æœ¬æè¿°</li>
<li><code>Visual knowledge</code>: æ¶µç›–åäººã€åœ°æ ‡ã€åŠ¨æ¤ç‰©ç­‰è¯†åˆ«æ•°æ®ï¼Œå¸®åŠ©æ¨¡å‹ç§¯ç´¯è§†è§‰å¸¸è¯†</li>
<li><code>OCR</code> æ•°æ®ï¼šä»å›¾åƒä¸­æå–çš„æ–‡æœ¬ä¿¡æ¯</li>
</ul>
</li>
<li>ç”¨äº† <code>CLIP</code> ä½œä¸ºä¼˜åŒ–ç›®æ ‡ï¼Œå¯¹é½ <code>ViT</code> å’Œ <code>Qwen2.5</code> çš„ <code>text</code> æ¨¡æ€</li>
<li><code>token</code> é•¿åº¦ä¸º <code>8k</code>ï¼Œæ•°æ®è§„æ¨¡ä¸º <code>1.5T tokens</code></li>
</ul>
<h4 id="ç¬¬äºŒé˜¶æ®µ"><a class="markdownIt-Anchor" href="#ç¬¬äºŒé˜¶æ®µ"></a> ç¬¬äºŒé˜¶æ®µ</h4>
<ul>
<li><code>ViT</code> å’Œ <code>Qwen2.5</code> çš„è”åˆé¢„è®­ç»ƒ</li>
<li><code>token</code> é•¿åº¦ä¸º <code>8k</code>ï¼Œæ•°æ®è§„æ¨¡ä¸º <code>2T tokens</code></li>
</ul>
<h4 id="ç¬¬ä¸‰é˜¶æ®µ"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰é˜¶æ®µ"></a> ç¬¬ä¸‰é˜¶æ®µ</h4>
<ul>
<li>é•¿ä¸Šä¸‹æ–‡ä¼˜åŒ–ï¼Œç›®æ ‡æ˜¯è§†é¢‘/æ–‡æ¡£åºåˆ—ç†è§£</li>
<li><code>token</code> é•¿åº¦ä¸º <code>32k</code>ï¼Œæ•°æ®è§„æ¨¡ä¸º <code>0.6T tokens</code></li>
</ul>
<h3 id="å…³é”®æŠ€æœ¯è§£æ"><a class="markdownIt-Anchor" href="#å…³é”®æŠ€æœ¯è§£æ"></a> å…³é”®æŠ€æœ¯è§£æ</h3>
<h4 id="1-åŠ¨æ€-vit-æ¶æ„"><a class="markdownIt-Anchor" href="#1-åŠ¨æ€-vit-æ¶æ„"></a> 1. åŠ¨æ€ <code>ViT</code> æ¶æ„</h4>
<ul>
<li>è¾“å…¥å°ºå¯¸è‡ªé€‚åº”ï¼šå›¾åƒæŒ‰ <code>14Ã—14</code> åˆ†å—ï¼Œå°ºå¯¸è°ƒæ•´ä¸º <code>28</code> çš„å€æ•°</li>
<li>çª—å£æ³¨æ„åŠ›ï¼š<code>32</code> å±‚ä¸­ä»… <code>4</code> å±‚ç”¨å…¨å±€æ³¨æ„åŠ›ï¼Œå…¶ä½™ç”¨ <code>112Ã—112</code> çª—å£æ³¨æ„åŠ›ï¼ˆè®¡ç®—å¤æ‚åº¦ä» <code>O(nÂ²)</code> é™è‡³ <code>O(n)</code>ï¼‰</li>
<li>ä½ç½®ç¼–ç ï¼š<code>2D</code> æ—‹è½¬ä½ç½®åµŒå…¥ï¼ˆ<code>RoPE</code>ï¼‰ä¿ç•™ç©ºé—´å…³ç³»</li>
</ul>
<h4 id="2-å¤šæ¨¡æ€åŠ¨æ€å¤„ç†"><a class="markdownIt-Anchor" href="#2-å¤šæ¨¡æ€åŠ¨æ€å¤„ç†"></a> 2. å¤šæ¨¡æ€åŠ¨æ€å¤„ç†</h4>
<ul>
<li>ç©ºé—´ç»´åº¦ï¼š
<ul>
<li>åŸç”Ÿåˆ†è¾¨ç‡åæ ‡ï¼šç›´æ¥ä½¿ç”¨å›¾åƒå®é™…å°ºå¯¸è¡¨ç¤ºç‰©ä½“ä½ç½®ï¼ˆéç›¸å¯¹åæ ‡ï¼‰</li>
<li>æ”¯æŒ <code>JSON/XML</code> æ ¼å¼è¾“å‡ºï¼Œå…¼å®¹å¼€æ”¾è¯æ±‡æ£€æµ‹ï¼ˆ<code>10,000+</code> ç±»åˆ«ï¼‰</li>
</ul>
</li>
<li>æ—¶é—´ç»´åº¦ï¼š
<ul>
<li>åŠ¨æ€å¸§ç‡é‡‡æ ·ï¼šé€‚åº”ä¸åŒé€Ÿåº¦çš„è§†é¢‘å†…å®¹</li>
<li>ç»å¯¹æ—¶é—´å¯¹é½ï¼š<code>RoPE</code> æ—¶é—´ <code>ID</code> ä¸æ—¶é—´æˆ³ç›´æ¥ç»‘å®šï¼Œç†è§£äº‹ä»¶èŠ‚å¥ï¼ˆå›¾1æœºåˆ¶ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="3-å¤šæ¨¡æ€ä½ç½®ç¼–ç mrope"><a class="markdownIt-Anchor" href="#3-å¤šæ¨¡æ€ä½ç½®ç¼–ç mrope"></a> 3. å¤šæ¨¡æ€ä½ç½®ç¼–ç ï¼ˆ<code>MRoPE</code>ï¼‰â€‹</h4>
<ul>
<li>ä¸‰ç»´åˆ†è§£ï¼šæ—¶é—´ã€é«˜åº¦ã€å®½åº¦ç‹¬ç«‹ä½ç½® <code>ID</code></li>
<li>è§†é¢‘å¤„ç†ï¼šæ—¶é—´ <code>ID</code> æŒ‰å¸§é€’å¢ï¼Œç©ºé—´ <code>ID</code> ä¸é™æ€å›¾åƒä¸€è‡´</li>
<li>å‡çº§ç‚¹ï¼šæ—¶é—´ <code>ID</code> å…³è”ç»å¯¹æ—¶é—´æˆ³ï¼Œè§£å†³ <code>Qwen2-VL</code> çš„æ—¶åºç†è§£å±€é™</li>
</ul>
<h3 id="æ€§èƒ½"><a class="markdownIt-Anchor" href="#æ€§èƒ½"></a> æ€§èƒ½</h3>
<ul>
<li>å…±æœ‰ <code>3B / 7B / 72B</code> ä¸‰ä¸ªå°ºå¯¸<br />
<img src="https://s2.loli.net/2025/07/21/2tXRI65vpe9wcUH.png" alt="qwen2.5-vl_2.png" /></li>
</ul>
<h2 id="thoughts"><a class="markdownIt-Anchor" href="#thoughts"></a> Thoughts</h2>
<ul>
<li><code>VLM</code> å°†è§†è§‰ä¿¡æ¯èå…¥è¯­è¨€æ¨¡æ€ï¼Œé‡ç‚¹è¿˜æ˜¯ <code>LM</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/07/15/Dynamic-Chunking-for-End-to-End-Hierarchical-Sequence-Modeling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/15/Dynamic-Chunking-for-End-to-End-Hierarchical-Sequence-Modeling/" class="post-title-link" itemprop="url">Dynamic Chunking for End-to-End Hierarchical Sequence Modeling</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-15 15:23:27" itemprop="dateCreated datePublished" datetime="2025-07-15T15:23:27+08:00">2025-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SSM/" itemprop="url" rel="index"><span itemprop="name">SSM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/07/15/Dynamic-Chunking-for-End-to-End-Hierarchical-Sequence-Modeling/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/07/15/Dynamic-Chunking-for-End-to-End-Hierarchical-Sequence-Modeling/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2507.07955">https://arxiv.org/pdf/2507.07955</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/goombalab/hnet">https://github.com/goombalab/hnet</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>æ ‡é¢˜æ˜¯ â€œç”¨äºç«¯åˆ°ç«¯åˆ†å±‚åºåˆ—å»ºæ¨¡çš„åŠ¨æ€åˆ†å—â€ ï¼Œå®é™…ä¸ŠåŒ…å«äº†ä¸å°‘ä¿¡æ¯é‡ï¼š
<ul>
<li>â€œç«¯åˆ°ç«¯â€ï¼šæ„å‘³ç€ <code>token free</code>ï¼ŒçœŸæ­£çš„ç«¯åˆ°ç«¯è¯­è¨€æ¨¡å‹ï¼Œè¾“å…¥è¾“å‡ºéƒ½æ˜¯å­—èŠ‚æµï¼Œä¸éœ€è¦ <code>tokenization</code> è¿‡ç¨‹</li>
<li>â€œåˆ†å±‚â€ï¼šæ„å‘³ç€ <code>H-Net</code> æ¨¡å‹ç»“æ„æ˜¯ <strong>é€’å½’</strong> çš„ï¼Œ<code>H-Net</code> æ¨¡å‹ç”± <code>encoder</code> + <code>main network</code> + <code>decoder</code> ç»„æˆï¼Œå…¶ä¸­ <code>main network</code> è¿˜å¯ä»¥æ˜¯ <code>H-Net</code> æ¨¡å‹</li>
<li>â€œåŠ¨æ€åˆ†å—â€ï¼šæ„å‘³ç€ <code>H-Net</code> æ¨¡å‹å¯ä»¥åŠ¨æ€åœ°è°ƒæ•´ <code>chunk</code> çš„å¤§å°ï¼Œå¯ä»¥ç†è§£ä¸ºç»´æŠ¤äº†ä¸€ä¸ªéšå¼çš„åŠ¨æ€ <code>tokenizer</code>ï¼Œæ¨¡å‹ä¼šåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æ‰¾åˆ°æœ€ä¼˜çš„éšå¼åˆ†è¯æ–¹æ³•</li>
</ul>
</li>
<li>æœ¬è´¨æ˜¯ä¸€ä¸ªåŸºäº <code>SSM + Transformer</code> ç»“æ„çš„å¤§æ¨¡å‹ï¼ŒæŠ›å¼ƒäº† <code>tokenization</code> è¿‡ç¨‹ï¼Œç›´æ¥åœ¨å­—èŠ‚æµä¸Šè¿›è¡Œè®­ç»ƒå’Œæ¨ç†</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="h-net-æ€»ä½“ç»“æ„"><a class="markdownIt-Anchor" href="#h-net-æ€»ä½“ç»“æ„"></a> H-Net æ€»ä½“ç»“æ„</h3>
<p><img src="https://s2.loli.net/2025/07/15/l7re8zg3QYXJEq6.png" alt="hnet.png" /></p>
<h3 id="ç°æœ‰çš„åˆ†è¯æœºåˆ¶çš„ç¼ºé™·"><a class="markdownIt-Anchor" href="#ç°æœ‰çš„åˆ†è¯æœºåˆ¶çš„ç¼ºé™·"></a> ç°æœ‰çš„åˆ†è¯æœºåˆ¶çš„ç¼ºé™·</h3>
<ul>
<li>å½“å‰ä¸»æµè¯­è¨€æ¨¡å‹ï¼ˆå¦‚ <code>ChatGPT</code> ï¼‰ä¾èµ–é¢„å®šä¹‰çš„åˆ†è¯å™¨ï¼ˆå¦‚ <code>BPE</code> ï¼‰ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
<ul>
<li>è¯­ä¹‰å‰²è£‚â€‹â€‹ï¼šåˆ†è¯å™¨åŸºäºç»Ÿè®¡è§„åˆ™ï¼Œæ— æ³•æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€è°ƒæ•´è¾¹ç•Œï¼ˆå¦‚å°† â€œproductâ€ é”™è¯¯æ‹†åˆ†ä¸º â€œpro-ductâ€ ï¼‰</li>
<li>è·¨è¯­è¨€/æ¨¡æ€é€‚é…æ€§å·®â€‹â€‹ï¼šåœ¨ä¸­æ–‡ã€ä»£ç æˆ– <code>DNA</code> åºåˆ—ç­‰ç¼ºä¹æ˜¾å¼åˆ†éš”ç¬¦çš„é¢†åŸŸè¡¨ç°ä¸ä½³</li>
</ul>
</li>
<li>ç›´æ¥å­—èŠ‚çº§å»ºæ¨¡ï¼ˆå¦‚ <code>MambaByte</code> ï¼‰ï¼Œè®¡ç®—å¼€é”€å·¨å¤§ï¼Œä¸”æ€§èƒ½ä½äºåˆ†è¯æ¨¡å‹</li>
<li>ä¸€äº›å¯å‘å¼åˆ†å—è§„åˆ™ï¼ˆå¦‚ <code>MegaByte</code> å’Œ <code>SpaceByte</code>ï¼‰ä¾èµ–â€‹â€‹å¯å‘å¼åˆ†å—è§„åˆ™â€‹â€‹ï¼ˆå¦‚å›ºå®šæ­¥é•¿æˆ–ç©ºæ ¼åˆ†éš”ï¼‰ï¼Œæ— æ³•å­¦ä¹ æ•°æ®é©±åŠ¨çš„åˆ†å—ç­–ç•¥ï¼Œé™åˆ¶äº†æ¨¡å‹å¯¹å¤æ‚ä¿¡æ¯çš„è¡¨è¾¾èƒ½åŠ›</li>
</ul>
<h3 id="h-net-çš„è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#h-net-çš„è§£å†³æ–¹æ¡ˆ"></a> H-Net çš„è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="å±‚çº§åŒ–å¤„ç†æ¶æ„u-net-å¼è®¾è®¡"><a class="markdownIt-Anchor" href="#å±‚çº§åŒ–å¤„ç†æ¶æ„u-net-å¼è®¾è®¡"></a> å±‚çº§åŒ–å¤„ç†æ¶æ„ï¼ˆ<code>U-Net</code> å¼è®¾è®¡ï¼‰â€‹â€‹</h4>
<ul>
<li>ä¸‰çº§æ¨¡å—
<ul>
<li>ç¼–ç å™¨ï¼ˆ<code>E</code>ï¼‰â€‹â€‹ï¼šå¤„ç†åŸå§‹å­—èŠ‚ï¼ˆå°è§„æ¨¡ <code>SSM</code> å±‚ï¼Œé«˜æ•ˆæ•è·ç»†ç²’åº¦ç‰¹å¾ï¼‰</li>
<li>ä¸»ç½‘ç»œï¼ˆ<code>M</code>ï¼‰â€‹â€‹ï¼šå¤„ç†å‹ç¼©åçš„è¯­ä¹‰å—ï¼ˆå¤§è§„æ¨¡ <code>Transformer</code> å±‚ï¼Œå­¦ä¹ é«˜å±‚æŠ½è±¡ï¼‰</li>
<li>è§£ç å™¨ï¼ˆ<code>D</code>ï¼‰â€‹â€‹ï¼šæ¢å¤åŸå§‹åˆ†è¾¨ç‡ï¼ˆ<code>SSM</code> å±‚ï¼‰</li>
</ul>
</li>
<li>é€’å½’æ‰©å±•â€‹â€‹ï¼šä¸»ç½‘ç»œå¯åµŒå¥— <code>H-Net</code> è‡ªèº«ï¼Œå½¢æˆå¤šçº§æŠ½è±¡ï¼ˆå¦‚å­—ç¬¦ â†’ è¯ â†’ çŸ­è¯­ï¼‰</li>
</ul>
<h4 id="encoder-network"><a class="markdownIt-Anchor" href="#encoder-network"></a> Encoder Network</h4>
<ol>
<li>è·¯ç”±æ¨¡å—ï¼ˆ<code>Routing Module</code>ï¼‰
<ul>
<li>ç”¨ç›¸é‚»å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†å—</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>s</mi><mi>i</mi><mi>m</mi><mo stretchy="false">(</mo><msub><mi>q</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>k</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p_t=\frac{1}{2}(1-sim(q_t,k_{t-1}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> è¡¨ç¤º <code>position</code></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> è¡¨ç¤º <code>query</code></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> è¡¨ç¤º <code>key</code></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>i</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span></span></span></span> è¡¨ç¤ºä½™å¼¦ç›¸ä¼¼åº¦</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">p_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå½“å‰ä½ç½®åˆ†å—æ¦‚ç‡</li>
</ul>
</li>
<li>å½“ç›¸é‚»å‘é‡è¯­ä¹‰å˜åŒ–å¤§æ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">p_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¼šè¶‹è¿‘äº 1ï¼Œè¡¨ç¤ºéœ€è¦åˆ†å—</li>
</ul>
</li>
<li>ä¸‹é‡‡æ ·æ¨¡å—ï¼ˆ<code>Downsampler</code>ï¼‰
<ul>
<li>å°†ä¸Šä¸€æ­¥åˆ†å—çš„åºåˆ—ä¸‹é‡‡æ ·</li>
<li>å…·ä½“ä½¿ç”¨çš„ä¸‹é‡‡æ ·æ–¹å¼æ˜¯ <strong>åªä¿ç•™è·¯ç”±æ¨¡å—é€‰å®šçš„è¾¹ç•Œå‘é‡</strong>ï¼Œå…¶ä»–å‘é‡ç›´æ¥ä¸¢å¼ƒ</li>
</ul>
</li>
</ol>
<h4 id="main-network"><a class="markdownIt-Anchor" href="#main-network"></a> Main Network</h4>
<ul>
<li>ä¸€ä¸ªæœ€å¸¸è§çš„ <code>Transformer</code> ç»“æ„</li>
<li>è¾“å…¥æ˜¯ <code>Encoder Network</code> è¾“å‡ºçš„ä¸‹é‡‡æ ·åçš„å‘é‡</li>
<li>è¾“å‡ºå’Œè¾“å…¥çš„ <code>shape</code> ç›¸åŒ</li>
</ul>
<h4 id="decoder-network"><a class="markdownIt-Anchor" href="#decoder-network"></a> Decoder Network</h4>
<ol>
<li>å¹³æ»‘æ¨¡å—ï¼ˆ<code>Smoothing Module</code>ï¼‰
<ul>
<li>ç”¨æŒ‡æ•°ç§»åŠ¨å¹³å‡æ³•è§£å†³ç¦»æ•£å†³ç­–çš„æ¢¯åº¦ä¸å¯å¯¼é—®é¢˜</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>z</mi><mo>Ë‰</mo></mover><mi>t</mi></msub><mo>=</mo><mi>P</mi><mo>â‹…</mo><msub><mover accent="true"><mi>z</mi><mo>^</mo></mover><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>P</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>â‹…</mo><msub><mover accent="true"><mi>z</mi><mo>Ë‰</mo></mover><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\bar z_t=P\cdot \hat z_{t-1}+(1-P_t)\cdot \bar z_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.71778em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">Ë‰</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.776111em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">Ë‰</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">P_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå½“å‰ä½ç½®åˆ†å—æ¦‚ç‡</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>z</mi><mo>^</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\hat z_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºä¸»ç½‘ç»œè¾“å‡ºçš„å‹ç¼©å‘é‡</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>z</mi><mo>Ë‰</mo></mover><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\bar z_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.776111em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">Ë‰</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºä¸Šä¸€æ­¥å¹³æ»‘åçš„å‘é‡</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>z</mi><mo>Ë‰</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\bar z_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.71778em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">Ë‰</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå¹³æ»‘åçš„å‘é‡</li>
</ul>
</li>
</ul>
</li>
<li>ä¸Šé‡‡æ ·æ¨¡å—ï¼ˆ<code>Upsampler</code>ï¼‰<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>c</mi><mi>t</mi></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.15999999999999992em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>p</mi><mi>t</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>ifÂ </mtext><msub><mi>b</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>p</mi><mi>t</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>ifÂ </mtext><msub><mi>b</mi><mi>t</mi></msub><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">c_t=\left\{
\begin{array}{l}
p_t &amp; \text{if}\ b_t=1 \\
1- p_t &amp; \text{if}\ b_t=0
\end{array}
\right.
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">{</span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">if</span></span><span class="mspace">Â </span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">if</span></span><span class="mspace">Â </span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>Upsampler</mtext><mi>t</mi></msub><mo>=</mo><mi>S</mi><mi>T</mi><mi>E</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>â‹…</mo><msub><mover accent="true"><mi>z</mi><mo>~</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\text{Upsampler}_t = STE(c_t)\cdot \tilde z_t
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord"><span class="mord text"><span class="mord">Upsampler</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.18641599999999994em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8178599999999999em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">b_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå½“å‰ä½ç½®æ˜¯å¦åˆ†å—ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b_t=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> è¡¨ç¤ºåˆ†å—ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>t</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b_t=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> è¡¨ç¤ºä¸åˆ†å—</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">p_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå½“å‰ä½ç½®åˆ†å—æ¦‚ç‡</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">c_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå½“å‰ä½ç½® <code>main network</code> <strong>è¾“å‡ºçš„ç½®ä¿¡åº¦</strong></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>z</mi><mo>~</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\tilde z_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8178599999999999em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå½“å‰ä½ç½® <code>main network</code> è¾“å‡ºçš„å‘é‡ <strong>å¤åˆ¶åˆ°åŸå§‹åˆ†è¾¨ç‡</strong></li>
</ul>
</li>
</ol>
<h3 id="æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ•ˆæœ"></a> æ•ˆæœ</h3>
<ul>
<li>æ•ˆæœæ¯” <code>tokenization</code> æ›´å¥½</li>
<li>åœ¨è¯­è¨€ã€ä»£ç ã€DNAç­‰å¼‚æ„æ•°æ®ä¸­éªŒè¯æ™®é€‚æ€§ï¼Œä¸ºå¤šæ¨¡æ€åŸºç¡€æ¨¡å‹æä¾›æ–°èŒƒå¼</li>
</ul>
<h2 id="thoughts"><a class="markdownIt-Anchor" href="#thoughts"></a> Thoughts</h2>
<ul>
<li>èƒ½çœ‹å‡º <code>SSM</code> æ¨¡å‹å·²ç»å¼€å§‹æ”¹å˜æˆ˜ç•¥ï¼Œä»æ­£é¢å’Œ <code>Transformer</code> ç¡¬åˆšåˆ° <strong>æ›²çº¿æ•‘å›½</strong></li>
<li><code>STE</code> çœŸæ˜¯ä¸ªä¸‡é‡‘æ²¹ï¼Œå“ªå“ªéƒ½æœ‰å®ƒ</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/07/13/CacheBlend-Fast-Large-Language-Model-Serving-for-RAG-with-Cached-Knowledge-Fusion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/13/CacheBlend-Fast-Large-Language-Model-Serving-for-RAG-with-Cached-Knowledge-Fusion/" class="post-title-link" itemprop="url">CacheBlend: Fast Large Language Model Serving for RAG with Cached Knowledge Fusion</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-13 15:33:34" itemprop="dateCreated datePublished" datetime="2025-07-13T15:33:34+08:00">2025-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RAG/" itemprop="url" rel="index"><span itemprop="name">RAG</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/07/13/CacheBlend-Fast-Large-Language-Model-Serving-for-RAG-with-Cached-Knowledge-Fusion/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/07/13/CacheBlend-Fast-Large-Language-Model-Serving-for-RAG-with-Cached-Knowledge-Fusion/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2405.16444">https://arxiv.org/pdf/2405.16444</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/LMCache/LMCache">https://github.com/LMCache/LMCache</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>æœ¬æ–‡æå‡ºä¸€ç§æ–°çš„ç¼“å­˜åˆ©ç”¨æœºåˆ¶ <code>CacheBlend</code>ï¼Œæ—¨åœ¨è§£å†³ <code>RAG</code> ç³»ç»Ÿä¸­çŸ¥è¯† <code>KV Cache</code> çš„å¯ç”¨æ€§ï¼Œé€šè¿‡ä¸€ç§ç¨€ç–è¿‘ä¼¼çš„æ–¹å¼å¹³è¡¡é€Ÿåº¦å’Œå‡†ç¡®æ€§ã€‚</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="çŸ¥è¯†æ³¨å…¥çš„ä¸¤ç§å¸¸è§æ–¹å¼"><a class="markdownIt-Anchor" href="#çŸ¥è¯†æ³¨å…¥çš„ä¸¤ç§å¸¸è§æ–¹å¼"></a> çŸ¥è¯†æ³¨å…¥çš„ä¸¤ç§å¸¸è§æ–¹å¼</h3>
<h4 id="1-å¾®è°ƒ"><a class="markdownIt-Anchor" href="#1-å¾®è°ƒ"></a> 1. å¾®è°ƒ</h4>
<ul>
<li>æ”¶é›†çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£æ•°æ®ï¼Œå¾®è°ƒæ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ç”Ÿæˆæ–‡æœ¬æ—¶åˆ©ç”¨è¿™äº›çŸ¥è¯†ã€‚</li>
<li>ä¼˜ç‚¹ï¼šæ¨ç†æ—¶ä¸ä¼šæœ‰é¢å¤–çš„å»¶è¿Ÿã€‚</li>
<li>ç¼ºç‚¹ï¼š
<ol>
<li>åŠ¨æ€æ›´æ–°å›°éš¾</li>
<li>æ¨¡å—åŒ–å›°éš¾ï¼ˆæ— æ³•è¦æ±‚æ¨¡å‹ä½¿ç”¨å“ªäº›çŸ¥è¯†ï¼Œä¸ç”¨å“ªäº›çŸ¥è¯†ï¼‰</li>
</ol>
</li>
</ul>
<h4 id="2-çŸ¥è¯†æ£€ç´¢"><a class="markdownIt-Anchor" href="#2-çŸ¥è¯†æ£€ç´¢"></a> 2. çŸ¥è¯†æ£€ç´¢</h4>
<ul>
<li>åœ¨æ¨ç†æ—¶ï¼Œæ£€ç´¢ç›¸å…³æ–‡æ¡£å¹¶å°†å…¶ä½œä¸ºä¸Šä¸‹æ–‡è¾“å…¥åˆ°æ¨¡å‹ä¸­ã€‚</li>
<li>ä¼˜ç‚¹ï¼šåŠ¨æ€æ›´æ–°çŸ¥è¯†åº“ï¼Œæ¨¡å—åŒ–ã€‚</li>
<li>ç¼ºç‚¹ï¼šæ¨ç†æ—¶éœ€è¦é¢å¤–çš„å»¶è¿Ÿï¼Œä¸€æ˜¯å› ä¸ºæ£€ç´¢æœ¬èº«çš„å»¶è¿Ÿï¼ŒäºŒæ˜¯å› ä¸ºæ¨¡å‹éœ€è¦è®¡ç®—é¢å¤–çš„ä¸Šä¸‹æ–‡æ³¨æ„åŠ›ã€‚</li>
</ul>
<h3 id="å¦‚ä½•åŒæ—¶è§£å†³æ¨¡å—åŒ–å’Œé€Ÿåº¦çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#å¦‚ä½•åŒæ—¶è§£å†³æ¨¡å—åŒ–å’Œé€Ÿåº¦çš„é—®é¢˜"></a> å¦‚ä½•åŒæ—¶è§£å†³æ¨¡å—åŒ–å’Œé€Ÿåº¦çš„é—®é¢˜ï¼Ÿ</h3>
<ul>
<li>å¦‚æœåœ¨çŸ¥è¯†æ£€ç´¢æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œæ£€ç´¢ç³»ç»Ÿæå‰ç¼“å­˜äº† <strong>çŸ¥è¯†åº“ä¸­æ–‡æ¡£å¯¹åº”çš„ <code>KV Cache</code></strong>ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ¨ç†æ—¶ç›´æ¥ä½¿ç”¨è¿™äº› <code>KV Cache</code> æ— éœ€è®¡ç®—è¿™éƒ¨åˆ†çš„æ³¨æ„åŠ›ï¼ˆåªéœ€è¦æ£€ç´¢å»¶è¿Ÿï¼‰ã€‚</li>
</ul>
<h3 id="è¿™æ ·åšæœ‰ä»€ä¹ˆé—®é¢˜"><a class="markdownIt-Anchor" href="#è¿™æ ·åšæœ‰ä»€ä¹ˆé—®é¢˜"></a> è¿™æ ·åšæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3>
<ul>
<li>ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜æ˜¯ï¼šä¼˜äºç°å¦‚ä»Šç»å¤§å¤šæ•° <code>LLM</code> çš„ <code>decoder only</code> æ¶æ„ï¼Œç¼“å­˜çš„çŸ¥è¯†åº“çš„ <code>KV Cache</code> å¿…é¡»ä½œä¸º <code>prefix</code> æ³¨å…¥åˆ°æ¨¡å‹ä¸­ï¼Œä¸”åªèƒ½ç”¨ä¸€ä¸ªï¼Œå¦åˆ™æ¨¡å‹æ— æ³•åˆ©ç”¨è¿™äº›çŸ¥è¯†ã€‚</li>
<li>ä¾‹å¦‚ï¼š
<ul>
<li>è®°æ£€ç´¢åˆ°çš„æ–‡æ¡£çš„ <code>KV Cache</code> ä¸º <code>A</code>ï¼Œå†å²å¯¹è¯ä¿¡æ¯å’Œç”¨æˆ·è¾“å…¥ä¸º <code>B</code></li>
<li>é‚£ä¹ˆæ¨¡å‹çš„è¾“å…¥åº”è¯¥æ˜¯ <code>A + B</code>ï¼Œè€Œä¸æ˜¯ <code>B + A</code></li>
<li>å› ä¸º <code>KV Cache</code> ä½ç½® <code>i</code> çš„å€¼ä¾èµ–äº <code>0 ~ i-1</code> ä½ç½®çš„å€¼ï¼Œå¦‚æœä¸ä½œä¸º <code>prefix</code> æ³¨å…¥ï¼Œé‚£ä¹ˆæ¨¡å‹æ— æ³•åˆ©ç”¨è¿™äº›çŸ¥è¯†ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://s2.loli.net/2025/07/13/m6c3r9KLCEgIdJY.png" alt="cacheblend_2.png" /><br />
<img src="https://s2.loli.net/2025/07/13/vai4cwZmEIR1sSJ.png" alt="cacheblend_3.png" /></p>
<h3 id="cacheblend-æƒ³è¦è§£å†³çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#cacheblend-æƒ³è¦è§£å†³çš„é—®é¢˜"></a> CacheBlend æƒ³è¦è§£å†³çš„é—®é¢˜</h3>
<ul>
<li><code>CacheBlend</code> ç›®çš„å°±æ˜¯ä¸ºäº† <strong>è§£å†³ <code>RAG</code> ç³»ç»Ÿä¸­çŸ¥è¯† <code>KV Cache</code> åªèƒ½ä½œä¸º <code>prefix</code> æ³¨å…¥çš„é—®é¢˜</strong></li>
<li><code>CacheBlend</code> åšä¸åˆ°å’Œå®Œå…¨é‡æ–°è®¡ç®—æ•°å­¦ä¸Šç­‰ä»·ï¼Œåªèƒ½æ˜¯è¿‘ä¼¼</li>
<li>åŸç†æœ¬è´¨ä¸Šè®²æ˜¯å¹³è¡¡ï¼Œå³ <strong>åœ¨å®Œå…¨é‡æ–°è®¡ç®— <code>KV Cache</code> å’Œå®Œå…¨ä½¿ç”¨ç¼“å­˜çš„ <code>KV Cache</code> ä¹‹é—´è¿›è¡Œå¹³è¡¡</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</li>
</ul>
<p><img src="https://s2.loli.net/2025/07/13/D1MyroxV3ZhLUlk.png" alt="cacheblend.png" /></p>
<h3 id="cacheblend-çš„è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#cacheblend-çš„è§£å†³æ–¹æ¡ˆ"></a> CacheBlend çš„è§£å†³æ–¹æ¡ˆ</h3>
<p><img src="https://s2.loli.net/2025/07/13/NbGWP4zluwV8tOm.png" alt="cacheblend_4.png" /></p>
<ul>
<li><code>CacheBlend</code> é€šè¿‡ <strong>ç¨€ç–è¿‘ä¼¼</strong> çš„æ–¹å¼ï¼Œå¹³è¡¡é€Ÿåº¦å’Œå‡†ç¡®æ€§ï¼Œå…·ä½“æ¥è¯´ï¼Œå¯¹é <code>prefix</code> çš„ <code>KV Cache</code>ï¼Œåšï¼š
<ol>
<li>ç¬¬ <code>1</code> å±‚â€‹â€‹ï¼šè®¡ç®—æ‰€æœ‰ <code>Token</code> çš„ <code>KV</code> åå·®ï¼Œé€‰æ‹© <code>Top 20%</code> ä½œä¸ºå€™é€‰ <code>HKVD (High-KV-Deviation) Token</code></li>
<li>â€‹åç»­å±‚â€‹â€‹ï¼šä»…å¯¹å‰ä¸€å±‚çš„ <code>HKVD Token</code> è®¡ç®—åå·®ï¼Œä»ä¸­é€‰æ‹© <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>o</mi><mi>p</mi><mtext>Â </mtext><msub><mi>r</mi><mi>i</mi></msub><mi mathvariant="normal">%</mi><mtext>Â </mtext><mo stretchy="false">(</mo><msub><mi>r</mi><mi>i</mi></msub><mo>&lt;</mo><msub><mi>r</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Top\ r_i\%\  (r_i &lt; r_{i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mspace">Â </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">%</span><span class="mspace">Â </span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ä½œä¸ºå½“å‰å±‚ <code>HKVD Token</code></li>
<li>â€‹â€‹ç»ˆæ­¢â€‹â€‹ï¼šæœ€ç»ˆæ¯å±‚ä»…æ›´æ–°çº¦ <code>10-15% Token</code>ï¼Œåå·®æ˜¾è‘—é™ä½</li>
</ol>
</li>
<li>æ€»ä½“ä¸Šå°±æ˜¯ç”¨é€å±‚ç”¨æ–°çš„ <code>KV Cache</code> æ›¿æ¢æ—§çš„ <code>KV Cache</code>ï¼Œæ›¿æ¢ä¾æ®æ˜¯ <code>KV</code> åå·®ï¼Œåå·®è¶Šå¤§çš„ <code>Token</code> æ›¿æ¢çš„ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li>
</ul>
<h3 id="cacheblend-çš„ä¼˜åŠ¿"><a class="markdownIt-Anchor" href="#cacheblend-çš„ä¼˜åŠ¿"></a> CacheBlend çš„ä¼˜åŠ¿</h3>
<ul>
<li><strong>è´¨é‡ä¿éšœ</strong>â€‹â€‹ï¼šä»…æ›´æ–° <code>10-15% Token</code> å³å¯è¾¾åˆ° <code>Full KV Recompute</code> çš„è´¨é‡ï¼ˆ<code>F1/Rouge-L</code> åå·® <code>&lt;0.02</code>ï¼‰</li>
<li><strong>â€‹â€‹å»¶è¿Ÿéšè—</strong>â€‹â€‹ï¼š<code>KV</code> é‡æ–°è®¡ç®—ä¸ <code>KV</code> ç¼“å­˜åŠ è½½æµæ°´çº¿å¹¶è¡Œï¼Œä½¿é¢å¤–å»¶è¿Ÿè¿‘ä¹ä¸ºé›¶</li>
<li>â€‹<strong>æé€Ÿ</strong>â€‹â€‹ï¼š<code>TTFT (Time To First Token)</code> é™ä½ <code>2.2 ~ 3.3</code> å€ï¼Œååé‡æå‡ <code>2.8 ~ 5</code> å€</li>
</ul>
<h2 id="thoughts"><a class="markdownIt-Anchor" href="#thoughts"></a> Thoughts</h2>
<ul>
<li>ç¨€ç–æ— å¤„ä¸åœ¨</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/07/04/Toolformer-Language-Models-Can-Teach-Themselves-to-Use-Tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/04/Toolformer-Language-Models-Can-Teach-Themselves-to-Use-Tools/" class="post-title-link" itemprop="url">Toolformer: Language Models Can Teach Themselves to Use Tools</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-04 19:46:11" itemprop="dateCreated datePublished" datetime="2025-07-04T19:46:11+08:00">2025-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Agent/" itemprop="url" rel="index"><span itemprop="name">Agent</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/07/04/Toolformer-Language-Models-Can-Teach-Themselves-to-Use-Tools/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/07/04/Toolformer-Language-Models-Can-Teach-Themselves-to-Use-Tools/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2302.04761">https://arxiv.org/pdf/2302.04761</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>å¤§æ¨¡å‹å¹¶ä¸æ˜¯å…¨èƒ½çš„ï¼Œå¤§æ¨¡å‹ + å·¥å…·å¯ä»¥æ›´å¥½åœ°è§£å†³é—®é¢˜ï¼Œæœ¬æ–‡æå‡ºä¸€ç§æ–°çš„è®­ç»ƒæ–¹æ³•ï¼Œè®©å¤§æ¨¡å‹å¯ä»¥è‡ªæˆ‘å­¦ä¹ ä½¿ç”¨å¦‚ä½•å·¥å…·ã€‚</li>
<li>æœ¬æ–‡çš„ä¸»è¦è´¡çŒ®æ˜¯æå‡ºäº†ä¸€ç§æ–°çš„è®­ç»ƒæ–¹æ³•ï¼ŒåŒ…æ‹¬é€šè¿‡å¤§æ¨¡å‹æ„é€ å·¥å…·è°ƒç”¨æ•°æ®é›†ã€æ¸…æ´—æ•°æ®é›†ã€ä½¿ç”¨å·¥å…·è°ƒç”¨æ•°æ®é›†å¾®è°ƒå¤§æ¨¡å‹ã€‚</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="toolformer-çš„æ„ä¹‰"><a class="markdownIt-Anchor" href="#toolformer-çš„æ„ä¹‰"></a> ToolFormer çš„æ„ä¹‰</h3>
<ol>
<li>ä¼—æ‰€å‘¨çŸ¥ï¼Œå¤§æ¨¡å‹åœ¨å¾ˆå¤šä»»åŠ¡ä¸Šè¡¨ç°å‡ºè‰²ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯å…¨èƒ½çš„ï¼Œæ¯”å¦‚å»æ•° â€œstrawberryâ€ è¿™ä¸ªå•è¯ä¸­æœ‰å¤šå°‘ä¸ª â€œrâ€ã€‚</li>
<li>å·¥å…·å¯ä»¥å¸®åŠ©å¤§æ¨¡å‹æ›´å¥½åœ°è§£å†³é—®é¢˜ï¼Œæ¯”å¦‚è®¡ç®—å™¨ã€æ—¥å†ã€çŸ¥è¯†åº“ç­‰ã€‚</li>
<li>ä¸€ç§å¸¸è§çš„å¤§æ¨¡å‹å’Œå·¥å…·ç»“åˆçš„æ–¹å¼æ˜¯ï¼šé€šè¿‡ <code>Agent</code> <strong>å¤šè§’è‰²ï¼ˆuser / llm / functionï¼‰å¤šè½®å¯¹è¯</strong> å½¢å¼è°ƒç”¨ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼š
<ol>
<li>å¤§æ¨¡å‹åœ¨éœ€è¦è°ƒç”¨å·¥å…·çš„æ—¶å€™ï¼Œè¾“å‡ºä¸€æ®µç‰¹å®šæ ¼å¼çš„æ–‡æœ¬</li>
<li>å¤–éƒ¨ç¨‹åºè§£æè¿™æ®µæ–‡æœ¬ï¼Œè°ƒç”¨ç›¸åº”çš„å·¥å…·ï¼Œè°ƒç”¨å¾—åˆ°ç»“æœ</li>
<li>æ–°çš„ç»“æœä½œä¸º <code>Function</code> è§’è‰²çš„è¾“å…¥ï¼Œç»§ç»­å’Œå¤§æ¨¡å‹å¯¹è¯</li>
</ol>
</li>
<li>è€Œ <code>ToolFormer</code> é‡‡ç”¨çš„æ–¹å¼å’Œ <code>Agent</code> æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä¹Ÿæœ‰ä¸åŒçš„åœ°æ–¹ï¼š
<ul>
<li>ç›¸ä¼¼ç‚¹ï¼š
<ol>
<li>éƒ½éœ€è¦å¤§æ¨¡å‹è¾“å‡ºä¸€æ®µç‰¹å®šæ ¼å¼çš„æ–‡æœ¬æ¥è°ƒç”¨å·¥å…·</li>
<li>éƒ½éœ€è¦ä¸€æ®µ <code>endless loop</code> ç¨‹åºæ¥è§£æå¤§æ¨¡å‹çš„è¾“å‡ºï¼Œè°ƒç”¨å·¥å…·</li>
</ol>
</li>
<li>ä¸åŒç‚¹ï¼š
<ol>
<li><code>ToolFormer</code> ä¸æ˜¯é€šè¿‡ <strong>å¤šè§’è‰²å¤šè½®å¯¹è¯</strong> çš„æ–¹å¼è°ƒç”¨å·¥å…·ï¼Œè€Œæ˜¯é€šè¿‡ <strong>å•è§’è‰²å•è½®å¯¹è¯</strong> çš„æ–¹å¼è°ƒç”¨å·¥å…·</li>
<li><code>ToolFormer</code> éœ€è¦å¯¹å¤§æ¨¡å‹è¿›è¡Œ <strong>å¾®è°ƒ</strong>ï¼Œè€Œ <code>Agent</code> ä¸éœ€è¦</li>
</ol>
</li>
</ul>
</li>
<li><code>ToolFormer</code> å¯ä»¥å°†å­˜åœ¨ç¡®å®šç­”æ¡ˆçš„ <strong>ä¸“ç”¨</strong> ä»»åŠ¡è½¬åŒ–ä¸ºå·¥å…·è°ƒç”¨ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼šè®¡ç®—ã€ç¿»è¯‘ã€é—®ç­”ç­‰ï¼‰ï¼Œè®©å¤§æ¨¡å‹å¯ä»¥æ›´ä¸“æ³¨åœ¨ <strong>é€šç”¨</strong> ä»»åŠ¡ä¸Šï¼ˆä¾‹å¦‚ï¼šä¸Šä¸‹æ–‡ç†è§£ã€å¸¸è¯†çŸ¥è¯†è¿ç”¨ç­‰ï¼‰ã€‚</li>
</ol>
<h3 id="toolformer-çš„å·¥ä½œæ–¹å¼"><a class="markdownIt-Anchor" href="#toolformer-çš„å·¥ä½œæ–¹å¼"></a> ToolFormer çš„å·¥ä½œæ–¹å¼</h3>
<ol>
<li><code>ToolFormer</code> æ˜¯ç»è¿‡å·¥å…·è°ƒç”¨å¾®è°ƒçš„å¤§æ¨¡å‹ï¼ŒçŸ¥é“æœ‰å“ªäº›å·¥å…·å¯ä»¥è°ƒç”¨ï¼Œä¹ŸçŸ¥é“å¦‚ä½•è°ƒç”¨è¿™äº›å·¥å…·ã€‚</li>
<li>å‡è®¾æ¨¡å‹è¾“å…¥çš„é—®é¢˜æ˜¯ï¼š<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pittsburgh <span class="keyword">is</span> <span class="keyword">also</span> known <span class="keyword">as</span></span><br></pre></td></tr></table></figure>
</li>
<li>è¿™ä¸ªæ—¶å€™ï¼Œæ¨¡å‹ä¼šæ„è¯†åˆ°è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è°ƒç”¨ <code>Question Answering</code> å·¥å…·æ¥è§£å†³ï¼Œäºæ˜¯æ¨¡å‹ä¼šç»­å†™ï¼š<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pittsburgh <span class="keyword">is</span> <span class="keyword">also</span> known <span class="keyword">as</span> &lt;API&gt;QA(Pittsburgh <span class="keyword">is</span> <span class="keyword">also</span> known <span class="keyword">as</span>)&lt;/API&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>è¾“å‡º <code>&lt;/API&gt;</code> ä¹‹åï¼Œæ¨ç†è¿›ç¨‹ä¼šæš‚åœæ¨ç†æ¨¡å‹ï¼Œç­‰å¾…å¤–éƒ¨ç›‘å¬ç¨‹åºçš„è°ƒç”¨ç»“æŸã€‚</li>
<li>å¤–éƒ¨ç›‘å¬ç¨‹åºä¼šè§£ææ¨¡å‹è¾“å‡ºæ–‡æœ¬ä¸­çš„å·¥å…·è°ƒç”¨æŒ‡ä»¤ï¼ˆé€šè¿‡ <code>&lt;API&gt; &lt;/API&gt;</code> æ ¼å¼ï¼‰ï¼Œç„¶åè°ƒç”¨ <code>Question Answering</code> å·¥å…·ï¼Œå¾—åˆ°ç»“æœï¼š<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">the Steel City</span></span><br></pre></td></tr></table></figure>
</li>
<li>æ¨ç†ç¨‹åºå°†å·¥å…·è°ƒç”¨ç»“æœå’Œæ¨¡å‹çš„å†å²è¾“å‡ºï¼ˆå»æ‰è°ƒç”¨ç›¸å…³ä¿¡æ¯ï¼‰æ‹¼æ¥èµ·æ¥ï¼Œç»§ç»­æ¨ç†æ¨¡å‹ï¼š<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pittsburgh <span class="keyword">is</span> <span class="keyword">also</span> known <span class="keyword">as</span> the Steel City.</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="åº”è¯¥æ€ä¹ˆå¾—åˆ°-toolformer"><a class="markdownIt-Anchor" href="#åº”è¯¥æ€ä¹ˆå¾—åˆ°-toolformer"></a> åº”è¯¥æ€ä¹ˆå¾—åˆ° ToolFormer</h3>
<ol>
<li>å‡è®¾ä¸Šé¢æåˆ°çš„ <code>ToolFormer</code> å·¥ä½œæ–¹å¼æ˜¯ä¸€ä¸ªæ„¿æ™¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è€ƒè™‘åº”è¯¥å¦‚ä½•å¾—åˆ°ä¸€ä¸ªè¿™æ ·çš„æ¨¡å‹ã€‚</li>
<li>æ˜¾ç„¶ï¼Œç›´æ¥æ‹¿ä¸€ä¸ªé¢„è®­ç»ƒæˆ–ç»è¿‡å¾®è°ƒçš„å¤§æ¨¡å‹æ¥ä½¿ç”¨æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºå®ƒå¹¶ä¸çŸ¥é“å“ªäº›å·¥å…·å¯ä»¥ç”¨ï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨ã€‚</li>
<li>é‚£ä¹ˆéœ€è¦åšçš„äº‹å°±æ˜¯ï¼š<strong>é€šè¿‡å¾®è°ƒï¼Œè®©å¤§æ¨¡å‹è‡ªå·±å­¦ä¹ å¦‚ä½•ä½¿ç”¨å·¥å…·</strong></li>
<li>æœ€å›°éš¾çš„éƒ¨åˆ†å°±æ˜¯ï¼š<strong>å¦‚ä½•æ„é€ å·¥å…·è°ƒç”¨æ•°æ®é›†</strong>ï¼Œå› ä¸ºä¸å­˜åœ¨ç°æˆçš„å·¥å…·è°ƒç”¨æ•°æ®é›†ï¼Œéœ€è¦è‡ªå·±æ„é€ ã€‚</li>
<li>è¿™ç¯‡è®ºæ–‡èŠ±äº†å¾ˆå¤§çš„ç¯‡å¹…å°±åœ¨è®²ä¸€ä»¶äº‹ï¼š<strong>å¦‚ä½•ç”¨å¤§æ¨¡å‹æ¥æ„é€ å·¥å…·è°ƒç”¨æ•°æ®é›†</strong></li>
</ol>
<h3 id="å¦‚ä½•æ„é€ å·¥å…·è°ƒç”¨æ•°æ®é›†"><a class="markdownIt-Anchor" href="#å¦‚ä½•æ„é€ å·¥å…·è°ƒç”¨æ•°æ®é›†"></a> å¦‚ä½•æ„é€ å·¥å…·è°ƒç”¨æ•°æ®é›†</h3>
<p><img src="https://s2.loli.net/2025/07/07/6cHrSKzkAD7agLl.png" alt="toolformer_1.png" /></p>
<blockquote>
<p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºäº†å¦‚ä½•ç”¨å¤§æ¨¡å‹æ¥æ„é€ å·¥å…·è°ƒç”¨æ•°æ®é›†çš„æµç¨‹ã€‚</p>
</blockquote>
<ol>
<li>é¦–å…ˆï¼Œè¿˜æ˜¯ç”¨é¢„è®­ç»ƒæ•°æ®åšä¸ºåŸºç¡€ï¼Œå‡è®¾ä¸€æ¡é¢„è®­ç»ƒæ•°æ®æ˜¯ï¼š<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pittsburgh <span class="keyword">is</span> <span class="keyword">also</span> known <span class="keyword">as</span> the Steel City.</span><br></pre></td></tr></table></figure>
</li>
<li>ç„¶åï¼Œä½¿ç”¨å¤§æ¨¡å‹ï¼ˆä¾‹å¦‚ï¼šGPT-3ï¼‰æ¥åœ¨æ•°æ®ä¸­æ‰¾åˆ°å¯ä»¥è°ƒç”¨å·¥å…·çš„ä½ç½®å’Œå·¥å…·ç±»å‹ï¼Œå¹¶ç»™å‡ºè°ƒç”¨å·¥å…·çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pittsburgh <span class="keyword">is</span> also known <span class="keyword">as</span> &lt;API&gt;QA<span class="function"><span class="params">(What other name <span class="keyword">is</span> Pittsburgh known <span class="keyword">by</span>?)</span> -&gt;</span> Steel City&lt;/API&gt; the Steel City.</span><br></pre></td></tr></table></figure>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pittsburgh <span class="keyword">is</span> also known <span class="keyword">as</span> &lt;API&gt;QA<span class="function"><span class="params">(Which country <span class="keyword">is</span> Pittsburgh <span class="keyword">in</span>?)</span> -&gt;</span> United States&lt;/API&gt; the Steel City.</span><br></pre></td></tr></table></figure>
</li>
<li>è®¡ç®—è°ƒç”¨å·¥å…·å¸¦æ¥çš„æŸå¤±æ”¶ç›Šï¼Œå‰”é™¤è´Ÿæ”¶ç›Šçš„æ•°æ®ï¼Œä¿ç•™æ­£æ”¶ç›Šçš„æ•°æ®ã€‚
<ul>
<li>æŸå¤±çš„è®¡ç®—æ–¹å¼ï¼ˆç¦»è°ƒç”¨å·¥å…·ä½ç½®è¶Šè¿œï¼ŒæŸå¤±æƒé‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>j</mi><mo>âˆ’</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{j-i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> è¶Šå°ï¼‰ï¼š</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mi>i</mi></mrow><mi>n</mi></munderover><msub><mi>w</mi><mrow><mi>j</mi><mo>âˆ’</mo><mi>i</mi></mrow></msub><mo>â‹…</mo><mi>log</mi><mo>â¡</mo><msub><mi>p</mi><mi>M</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>z</mi><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>i</mi><mo separator="true">;</mo><mi>j</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_i(z) = -\sum_{j=i}^n w_{j-i}\cdot \log p_M(x_j|z,x_{i;j-1})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000007em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">;</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li>è°ƒç”¨å·¥å…·çš„æŸå¤±ï¼š</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>L</mi><mi>i</mi><mo>+</mo></msubsup><mo>=</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>r</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_i^+=L_i(e(c_i,r_i))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.088326em;vertical-align:-0.266995em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8213309999999999em;"><span style="top:-2.433005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.266995em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li>ä¸è°ƒç”¨å·¥å…· / è°ƒç”¨å·¥å…·æ²¡æœ‰è¿”å›çš„æŸå¤±ï¼š</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>L</mi><mi>i</mi><mo>âˆ’</mo></msubsup><mo>=</mo><mi>min</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>Ïµ</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>Ïµ</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_i^- = \min(L_i(\epsilon),L_i(e(c_i,\epsilon)))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.088326em;vertical-align:-0.266995em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8213309999999999em;"><span style="top:-2.433005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ’</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.266995em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">Ïµ</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">Ïµ</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li>åªä¿ç•™è°ƒç”¨å·¥å…·æŸå¤±æ”¶ç›Šå¤§äºé˜ˆå€¼çš„æ ·æœ¬ï¼š</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>L</mi><mi>i</mi><mo>âˆ’</mo></msubsup><mo>âˆ’</mo><msubsup><mi>L</mi><mi>i</mi><mo>+</mo></msubsup><mo>&gt;</mo><msub><mi>Ï„</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">L_i^- - L_i^+ &gt; \tau_f
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.088326em;vertical-align:-0.266995em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8213309999999999em;"><span style="top:-2.433005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ’</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.266995em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.088326em;vertical-align:-0.266995em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8213309999999999em;"><span style="top:-2.433005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.266995em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.1132em;">Ï„</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
</li>
<li>ç”¨ç­›é€‰åçš„æ•°æ®æ¥å¾®è°ƒå¤§æ¨¡å‹ï¼Œå¾—åˆ° <code>ToolFormer</code>ã€‚</li>
</ol>
<p><img src="https://s2.loli.net/2025/07/07/8UkSBFT5zjZbCe3.png" alt="toolformer_2.png" /></p>
<ul>
<li>ä¸Šå›¾å±•ç¤ºäº† <code>ToolFormer</code> æ”¯æŒçš„äº”ç§å·¥å…·ç±»å‹ï¼š
<ol>
<li><code>Question Answering</code>ï¼šé—®ç­”å·¥å…·</li>
<li><code>Wikipedia Search</code>ï¼šç»´åŸºç™¾ç§‘æœç´¢å·¥å…·</li>
<li><code>Calculator</code>ï¼šè®¡ç®—å™¨å·¥å…·</li>
<li><code>Calendar</code>ï¼šæ—¥å†å·¥å…·</li>
<li><code>Machine Translation</code>ï¼šæœºå™¨ç¿»è¯‘å·¥å…·</li>
</ol>
</li>
</ul>
<h2 id="thoughts"><a class="markdownIt-Anchor" href="#thoughts"></a> Thoughts</h2>
<ul>
<li><code>ToolFormer</code> è¿™ç§é€šè¿‡å¤§æ¨¡å‹è‡ªæˆ‘å­¦ä¹ ä½¿ç”¨å·¥å…·çš„æ–¹å¼æ„Ÿè§‰æŒºå¥½çš„ï¼Œä½†ä¼¼ä¹åœ¨å®é™…ä½¿ç”¨ä¸­æ²¡æœ‰å¾—åˆ°å¤§èŒƒå›´æ¨å¹¿ï¼Œç›®å‰ä¸»æµå¤–æŒ‚å·¥å…·çš„æ–¹å¼åŸºæœ¬è¿˜æ˜¯ <code>Agent</code> çš„å¤šè§’è‰²å¤šè½®å¯¹è¯æ–¹å¼ã€‚</li>
<li>å¯èƒ½æ˜¯å› ä¸º <code>ToolFormer</code> çš„æ–¹å¼éœ€è¦å¯¹å¤§æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œè€Œ <code>Agent</code> çš„æ–¹å¼ä¸éœ€è¦åšå·¥å…·é€‚é…å¾®è°ƒï¼Œç›´æ¥ä½¿ç”¨åŸæ¨¡å‹å°±å¯ä»¥ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/07/04/ReAct-Synergizing-Reasoning-and-Acting-in-Language-Models/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/04/ReAct-Synergizing-Reasoning-and-Acting-in-Language-Models/" class="post-title-link" itemprop="url">ReAct: Synergizing Reasoning and Acting in Language Models</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-04 15:35:30" itemprop="dateCreated datePublished" datetime="2025-07-04T15:35:30+08:00">2025-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Agent/" itemprop="url" rel="index"><span itemprop="name">Agent</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/07/04/ReAct-Synergizing-Reasoning-and-Acting-in-Language-Models/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/07/04/ReAct-Synergizing-Reasoning-and-Acting-in-Language-Models/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2210.03629">https://arxiv.org/pdf/2210.03629</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/ysymyth/ReAct">https://github.com/ysymyth/ReAct</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>äººç±»é€šè¿‡è¯­è¨€æ¨ç†ï¼ˆåˆ†è§£ç›®æ ‡ã€è°ƒæ•´è®¡åˆ’ï¼‰ä¸è¡ŒåŠ¨ï¼ˆè·å–å¤–éƒ¨ä¿¡æ¯ï¼‰çš„â€‹â€‹ååŒæœºåˆ¶â€‹â€‹é«˜æ•ˆå®Œæˆä»»åŠ¡ï¼ˆå¦‚çƒ¹é¥ªæ—¶åŠ¨æ€è°ƒæ•´æ­¥éª¤ï¼‰ã€‚</li>
<li>å—åˆ°äººç±»æ™ºèƒ½å¯å‘ï¼Œæœ¬æ–‡æå‡ºä¸€ç§ <code>Reasoning</code> å’Œ <code>Acting</code> ç›¸ç»“åˆçš„æ¡†æ¶ï¼Œç§°ä¸º <code>ReAct</code>ï¼Œè¿™ç§æ–°çš„æ¨ç†èŒƒå¼å¯ä»¥ä½¿è¯­è¨€æ¨¡å‹åœ¨å¤æ‚ä»»åŠ¡ä¸­è¡¨ç°æ›´å¥½ã€‚</li>
<li>ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š
<ul>
<li><strong>äº‹å®æ€§</strong>ï¼šå‡å°‘æ¨¡å‹å¹»è§‰ï¼ˆè™šæ„ä¿¡æ¯ï¼‰ã€‚</li>
<li><strong>å†³ç­–é²æ£’æ€§</strong>ï¼šå¢å¼ºæ¨¡å‹åœ¨å¤æ‚ç¯å¢ƒä¸­çš„æ³›åŒ–èƒ½åŠ›ã€‚</li>
<li><strong>å¯è§£é‡Šæ€§</strong>ï¼šäººç±»å¯ä»¥è¿½è¸ªæ¨¡å‹çš„æ¨ç†è½¨è¿¹ã€‚</li>
</ul>
</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="react-æ¡†æ¶"><a class="markdownIt-Anchor" href="#react-æ¡†æ¶"></a> ReAct æ¡†æ¶</h3>
<p><img src="https://s2.loli.net/2025/07/04/RZwUfVm3oxDlABc.png" alt="ReACT.png" /></p>
<ul>
<li>çº¯æ¨ç†æ¨¡å‹ï¼ˆå¦‚ <code>Chain-of-Thought</code>ï¼‰â€‹â€‹ï¼šæ˜“äº§ç”Ÿäº‹å®å¹»è§‰ï¼ˆå¦‚è™šæ„ä¿¡æ¯ï¼‰å’Œé”™è¯¯ä¼ æ’­ï¼ˆå¦‚ç®—æœ¯æ¨ç†é”™è¯¯ï¼‰ï¼Œç¼ºä¹å®æ—¶ç¯å¢ƒäº¤äº’èƒ½åŠ›ï¼ˆå›¾ <code>1b</code>ï¼‰ã€‚</li>
<li>â€‹â€‹çº¯è¡ŒåŠ¨æ¨¡å‹ï¼ˆå¦‚ <code>WebGPT</code>ï¼‰â€‹â€‹ï¼šç¼ºä¹é«˜å±‚è§„åˆ’èƒ½åŠ›ï¼Œéš¾ä»¥å¤„ç†å¤šæ­¥å†³ç­–ï¼ˆå›¾<code>1c</code>ï¼‰ã€‚</li>
<li><code>ReAct</code> æ¨¡å‹ï¼šäº¤æ›¿è¿›è¡Œæ¨ç†å’Œè¡ŒåŠ¨ï¼Œèƒ½å¤Ÿåœ¨å¤æ‚ä»»åŠ¡ä¸­è¡¨ç°æ›´å¥½ï¼ˆå›¾ <code>1d</code>ï¼‰ã€‚</li>
</ul>
<h3 id="æ ¸å¿ƒè´¡çŒ®"><a class="markdownIt-Anchor" href="#æ ¸å¿ƒè´¡çŒ®"></a> æ ¸å¿ƒè´¡çŒ®â€‹â€‹</h3>
<ul>
<li>é¦–æååŒæ¡†æ¶â€‹â€‹ï¼šç»Ÿä¸€æ¨ç†ä¸è¡ŒåŠ¨ï¼Œè§£å†³é™æ€æ¨ç†ä¸æ— è§„åˆ’è¡ŒåŠ¨çš„ç¼ºé™·ã€‚</li>
<li>å®è·µä»·å€¼â€‹â€‹ï¼š
<ul>
<li>æå‡æ¨¡å‹â€‹â€‹äº‹å®æ€§â€‹â€‹ï¼ˆå‡å°‘å¹»è§‰ï¼‰ä¸â€‹â€‹å†³ç­–é²æ£’æ€§â€‹â€‹ï¼ˆå¤æ‚ç¯å¢ƒæ³›åŒ–ï¼‰ã€‚</li>
<li>å¢å¼ºâ€‹â€‹å¯è§£é‡Šæ€§â€‹â€‹ï¼šäººç±»å¯è¿½è¸ªæ¨ç†è½¨è¿¹ã€‚</li>
</ul>
</li>
</ul>
<h2 id="thoughts"><a class="markdownIt-Anchor" href="#thoughts"></a> Thoughts</h2>
<ul>
<li>è®ºæ–‡æå‡ºçš„ç®—æ³•ä¸€çœ¼å¼€é—¨ï¼Œéå¸¸ç¬¦åˆç›´è§‰ï¼Œä»å“²å­¦è§’åº¦è®²ï¼Œä¸€ä¸ªäº‹ç‰©çš„è¶…é›†ä¸€èˆ¬éƒ½ä¼˜äºå…¶æœ¬èº«ï¼Œå› ä¸ºæœ€å·®çš„æƒ…å†µå°±æ˜¯è¶…é›†é€€åŒ–ä¸ºæœ¬èº«ï¼ˆå› æ­¤å¸¸è§çš„ä¸€ä¸ªæƒ…å†µæ˜¯ï¼šæ–°çš„è®ºæ–‡ç§°ä¸€ç¯‡è€çš„è®ºæ–‡æ˜¯å…¶æŸä¸ªå‚æ•°è®¾ç½®ä¸‹çš„ä¸€ä¸ªç‰¹ä¾‹ï¼‰ã€‚</li>
<li>è¿™äº›æ‰€æœ‰çš„ <code>Reasoning</code> å’Œ <code>Acting</code> ç­‰ <code>Agent</code> åŠŸèƒ½ï¼Œéƒ½å»ºç«‹åœ¨å¤§æ¨¡å‹è¶…é•¿ä¸Šä¸‹æ–‡çš„åŸºç¡€ä¸Šï¼Œå› æ­¤æ¨¡å‹æ”¯æŒè¶…é•¿ä¸Šä¸‹æ–‡é•¿åº¦æ˜¯æ¨¡å‹æ˜¯å¦å…·æœ‰é«˜çº§æ™ºèƒ½æ½œè´¨çš„å…ˆå†³æ¡ä»¶ï¼ˆè‡³å°‘ç°æœ‰èŒƒå¼æ˜¯è¿™æ ·ï¼‰ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/07/01/Chain-of-Thought-Prompting-Elicits-Reasoning-in-Large-Language-Models/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/01/Chain-of-Thought-Prompting-Elicits-Reasoning-in-Large-Language-Models/" class="post-title-link" itemprop="url">Chain-of-Thought Prompting Elicits Reasoning in Large Language Models</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-07-01 11:16:29" itemprop="dateCreated datePublished" datetime="2025-07-01T11:16:29+08:00">2025-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/07/01/Chain-of-Thought-Prompting-Elicits-Reasoning-in-Large-Language-Models/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/07/01/Chain-of-Thought-Prompting-Elicits-Reasoning-in-Large-Language-Models/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2201.11903">https://arxiv.org/pdf/2201.11903</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>æœ¬æ–‡æ˜¯ <code>Google Research</code> å›¢é˜Ÿå‘è¡¨çš„ä¸€ç¯‡è®ºæ–‡ï¼Œè¿™ç¯‡è®ºæ–‡æ˜¯åœ¨å·²å¼€æºçš„ <strong>éæ¨ç†</strong> æ¨¡å‹ä¸Šï¼Œä¸åšå¾®è°ƒï¼Œè€Œæ˜¯é€šè¿‡ <code>Chain-of-Thought Prompting</code> çš„æ–¹å¼æ¥å¼•å¯¼æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œå–å¾—äº†å¾ˆå¥½çš„æ•ˆæœã€‚</li>
<li>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨è¾“å…¥ <code>prompt</code> ä¸­åŠ å…¥å°‘é‡çš„ <strong>è¾“å…¥-æ€ç»´é“¾-è¾“å‡º</strong> ä¸‰å…ƒç»„ç¤ºä¾‹ï¼Œå¼•å¯¼æ¨¡å‹ç”Ÿæˆä¸­é—´æ¨ç†æ­¥éª¤ï¼Œæœ€ç»ˆç»™å‡ºç­”æ¡ˆã€‚</li>
<li>åœ¨ç®—æœ¯ã€å¸¸è¯†å’Œç¬¦å·æ¨ç†ç­‰ä»»åŠ¡ä¸Šï¼Œ<code>Chain-of-Thought Prompting</code> çš„æ•ˆæœéƒ½éå¸¸å¥½ï¼Œæ¯”ç›´æ¥ç»™å‡ºç­”æ¡ˆçš„æ•ˆæœå¥½å¾ˆå¤šã€‚</li>
<li><code>Chain-of-Thought Prompting</code> æ˜¯åœ¨æ¨¡å‹è§„æ¨¡è¾¾åˆ°ä¸€å®šç¨‹åº¦ï¼ˆ<code>&gt;= 100B</code>ï¼‰åï¼Œæ‰æ¶Œç°å‡ºçš„èƒ½åŠ›ï¼Œå°æ¨¡å‹æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ã€‚</li>
</ul>
<h2 id="è®ºæ–‡è¯¦æƒ…"><a class="markdownIt-Anchor" href="#è®ºæ–‡è¯¦æƒ…"></a> è®ºæ–‡è¯¦æƒ…</h2>
<h3 id="1-æ ¸å¿ƒæ–¹æ³•æ€ç»´é“¾æç¤ºchain-of-thought-prompting"><a class="markdownIt-Anchor" href="#1-æ ¸å¿ƒæ–¹æ³•æ€ç»´é“¾æç¤ºchain-of-thought-prompting"></a> 1. æ ¸å¿ƒæ–¹æ³•ï¼šæ€ç»´é“¾æç¤ºï¼ˆChain-of-Thought Promptingï¼‰</h3>
<ul>
<li>è®ºæ–‡æå‡ºä¸€ç§ç®€å•æ–¹æ³•ï¼šåœ¨æç¤ºï¼ˆ<code>prompt</code>ï¼‰ä¸­æä¾› <strong>è¾“å…¥-æ€ç»´é“¾-è¾“å‡º</strong> çš„ä¸‰å…ƒç»„ç¤ºä¾‹ï¼Œå¼•å¯¼å¤§å‹è¯­è¨€æ¨¡å‹ç”Ÿæˆä¸€ç³»åˆ—ä¸­é—´æ¨ç†æ­¥éª¤ï¼ˆç§°ä¸º â€œæ€ç»´é“¾â€ï¼‰ï¼Œå†å¾—å‡ºæœ€ç»ˆç­”æ¡ˆã€‚</li>
<li>æ€ç»´é“¾ç±»ä¼¼äºäººç±»é€æ­¥æ¨ç†çš„è¿‡ç¨‹ï¼ˆä¾‹å¦‚ï¼Œè§£å†³æ•°å­¦é¢˜æ—¶å…ˆåˆ†è§£æ­¥éª¤ï¼šâ€œå…ˆè®¡ç®—Aï¼Œå†è®¡ç®—Bï¼Œæœ€åå¾—å‡ºç­”æ¡ˆâ€ï¼‰ã€‚</li>
</ul>
<h3 id="2-å…³é”®ä¼˜åŠ¿"><a class="markdownIt-Anchor" href="#2-å…³é”®ä¼˜åŠ¿"></a> 2. å…³é”®ä¼˜åŠ¿</h3>
<ul>
<li>æå‡å¤æ‚æ¨ç†èƒ½åŠ›ï¼šåœ¨ç®—æœ¯ï¼ˆå¦‚æ•°å­¦é¢˜ <code>GSM8K</code>ï¼‰ã€å¸¸è¯†ï¼ˆå¦‚ <code>CSQA</code>ï¼‰å’Œç¬¦å·æ¨ç†ï¼ˆå¦‚å­—æ¯æ‹¼æ¥æ¸¸æˆï¼‰ä»»åŠ¡ä¸Šï¼Œæ€ç»´é“¾æç¤ºæ˜¾è‘—ä¼˜äºæ ‡å‡†æç¤ºï¼ˆ<code>standard prompting</code>ï¼‰ã€‚</li>
<li>åœ¨ <code>GSM8K</code> æ•°å­¦é¢˜åŸºå‡†ä¸Šï¼Œ<code>PaLM 540B</code> æ¨¡å‹ä½¿ç”¨æ€ç»´é“¾æç¤ºåï¼Œå‡†ç¡®ç‡ä» <code>17.9%</code> æå‡è‡³ <code>56.9%</code>ï¼Œç”šè‡³è¶…è¿‡å¾®è°ƒçš„ <code>GPT-3</code> æ¨¡å‹ã€‚</li>
<li>åœ¨å¸¸è¯†æ¨ç†ä»»åŠ¡ï¼ˆå¦‚ <code>StrategyQA</code>ï¼‰ä¸Šï¼Œå‡†ç¡®ç‡ä» <code>68.6%</code> æå‡è‡³ <code>77.8%</code>ã€‚</li>
<li>æ¨¡å‹è§„æ¨¡æ¶Œç°ç‰¹æ€§ï¼šæ€ç»´é“¾æ¨ç†æ˜¯å¤§å‹æ¨¡å‹ï¼ˆçº¦ <code>100B</code> å‚æ•°ä»¥ä¸Šï¼‰çš„ â€œæ¶Œç°èƒ½åŠ›â€ â€”â€” <strong>å°æ¨¡å‹æ— æ³•ç”Ÿæˆé€»è¾‘æ€ç»´é“¾</strong>ï¼Œä½†è¶³å¤Ÿå¤§çš„æ¨¡å‹ï¼ˆå¦‚ <code>GPT-3 175B</code>ã€<code>PaLM 540B</code>ï¼‰èƒ½è‡ªç„¶å­¦ä¹ æ­¤æ¨¡å¼ã€‚</li>
<li>æ— éœ€å¾®è°ƒï¼šä»…éœ€åœ¨æç¤ºä¸­æ·»åŠ å°‘é‡ç¤ºä¾‹ï¼ˆå¦‚ <code>8</code> ä¸ªï¼‰ï¼Œå³å¯æ¿€å‘æ¨¡å‹èƒ½åŠ›ï¼Œæ— éœ€é¢å¤–è®­ç»ƒæˆ–æ•°æ®æ ‡æ³¨ã€‚</li>
<li>å¯è§£é‡Šæ€§ä¸æ³›åŒ–æ€§ï¼šæ€ç»´é“¾æä¾›é€æ˜æ¨ç†è·¯å¾„ï¼Œä¾¿äºè°ƒè¯•ï¼›ä¸”é€‚ç”¨äºå¤šç§ä»»åŠ¡ï¼ˆæ•°å­¦ã€å¸¸è¯†ã€ç¬¦å·ç­‰ï¼‰ï¼Œç”šè‡³èƒ½æ³›åŒ–åˆ°æ›´é•¿åºåˆ—ã€‚</li>
</ul>
<h3 id="3-å®éªŒéªŒè¯"><a class="markdownIt-Anchor" href="#3-å®éªŒéªŒè¯"></a> 3. å®éªŒéªŒè¯</h3>
<ul>
<li>ä»»åŠ¡è¦†ç›–ï¼š
<ul>
<li>ç®—æœ¯æ¨ç†ï¼šåœ¨ <code>GSM8K</code>ã€<code>SVAMP</code> ç­‰æ•°æ®é›†ä¸Šï¼Œæ€ç»´é“¾æç¤ºå°†æ€§èƒ½æå‡é«˜è¾¾ <code>39%</code>ï¼ˆ<code>PaLM 540B</code>ï¼‰ã€‚</li>
<li>å¸¸è¯†æ¨ç†ï¼šåœ¨ <code>StrategyQA</code>ã€<code>Date Understanding</code> ç­‰ä»»åŠ¡ä¸Šï¼Œæ¨¡å‹è¡¨ç°æ¥è¿‘æˆ–è¶…è¶Šäººç±»æ°´å¹³ã€‚</li>
<li>ç¬¦å·æ¨ç†ï¼šåœ¨ç¡¬å¸ç¿»è½¬ï¼ˆ<code>coin flip</code>ï¼‰å’Œå­—æ¯æ‹¼æ¥ï¼ˆ<code>last letter concatenation</code>ï¼‰ä»»åŠ¡ä¸­ï¼Œæ¨¡å‹èƒ½å¤„ç†æœªè§è¿‡çš„é•¿åºåˆ—ã€‚</li>
</ul>
</li>
<li>é²æ£’æ€§ï¼šä¸åŒæ³¨é‡Šè€…ç¼–å†™çš„æ€ç»´é“¾ç¤ºä¾‹å‡æœ‰æ•ˆï¼Œä¸”å¯¹ç¤ºä¾‹é¡ºåºã€æ•°é‡å˜åŒ–ä¸æ•æ„Ÿã€‚</li>
</ul>
<h3 id="4-å±€é™æ€§ä¸å¯ç¤º"><a class="markdownIt-Anchor" href="#4-å±€é™æ€§ä¸å¯ç¤º"></a> 4. å±€é™æ€§ä¸å¯ç¤º</h3>
<ul>
<li>æ¨¡å‹è§„æ¨¡ä¾èµ–ï¼šæ€ç»´é“¾ä»…åœ¨å¤§å‹æ¨¡å‹ï¼ˆ<code>â‰¥100B</code> å‚æ•°ï¼‰ä¸­æœ‰æ•ˆï¼Œå°æ¨¡å‹ç”Ÿæˆé€»è¾‘æ··ä¹±ã€‚</li>
<li>æ½œåœ¨é”™è¯¯ï¼šç”Ÿæˆçš„æ¨ç†è·¯å¾„å¯èƒ½ä¸å‡†ç¡®ï¼ˆå¦‚ç®—æœ¯è®¡ç®—é”™è¯¯æˆ–è¯­ä¹‰è¯¯è§£ï¼‰ï¼Œéœ€å¤–éƒ¨éªŒè¯ï¼ˆå¦‚æ·»åŠ è®¡ç®—å™¨ï¼‰ã€‚</li>
<li>åº”ç”¨æ„ä¹‰ï¼šè¯¥æ–¹æ³•æ‹“å±•äº†æç¤ºæŠ€æœ¯çš„è¾¹ç•Œï¼Œè¯æ˜å¤§å‹æ¨¡å‹èƒ½é€šè¿‡è‡ªç„¶è¯­è¨€ç¤ºä¾‹å­¦ä¹ å¤æ‚æ¨ç†ï¼Œå‡å°‘å¯¹æ ‡æ³¨æ•°æ®çš„ä¾èµ–ã€‚</li>
</ul>
<h3 id="è®ºæ–‡æ ¸å¿ƒè´¡çŒ®"><a class="markdownIt-Anchor" href="#è®ºæ–‡æ ¸å¿ƒè´¡çŒ®"></a> è®ºæ–‡æ ¸å¿ƒè´¡çŒ®</h3>
<ul>
<li>æ€ç»´é“¾æç¤ºæ˜¯ä¸€ç§ä½æˆæœ¬ã€é«˜æ•ˆçš„æ–¹æ³•ï¼Œé€šè¿‡æ¨¡æ‹Ÿäººç±»é€æ­¥æ¨ç†è¿‡ç¨‹ï¼Œé‡Šæ”¾å¤§å‹è¯­è¨€æ¨¡å‹åœ¨å¤æ‚ä»»åŠ¡ä¸Šçš„æ½œåŠ›ã€‚è®ºæ–‡å¼ºè°ƒï¼Œè¿™æ˜¯ â€œæ¨¡å‹è§„æ¨¡æ¶Œç°â€ çš„å…¸å‹ä¾‹å­â€”â€”æ¨ç†èƒ½åŠ›éšæ¨¡å‹å¢å¤§è€Œè‡ªç„¶å‡ºç°ï¼Œä¸ºæœªæ¥ <code>AI</code> æ¨ç†ç ”ç©¶æä¾›äº†æ–°æ–¹å‘ã€‚</li>
</ul>
<h2 id="thoughts"><a class="markdownIt-Anchor" href="#thoughts"></a> Thoughts</h2>
<ul>
<li>ä¸€å®šè¦æ³¨æ„ï¼Œè¿™ç¯‡è®ºæ–‡è®¨è®ºçš„å¯¹è±¡ <strong>ä¸æ˜¯ Reasoning æ¨¡å‹</strong>ï¼ˆè¿™ä¸ªè®ºæ–‡å‡ºæ¥çš„æ—¶å€™è¿˜æ²¡æœ‰ <code>Reasoning</code> æ¨¡å‹çš„æ¦‚å¿µï¼‰ï¼Œè€Œæ˜¯æ™®é€šçš„ <code>LLM</code> æ¨¡å‹ã€‚</li>
<li>æœ¬è´¨æ˜¯ä¸€ç§é€šè¿‡ <code>prompt</code> å¼•å¯¼æ¨¡å‹é€šè¿‡å¢åŠ æ¨ç†è®¡ç®—é¢„ç®—çš„æ–¹å¼ï¼Œæ¥æå‡æ¨¡å‹çš„æ¨ç†èƒ½åŠ›çš„æ–¹æ³•ã€‚</li>
<li>ä¾æ‰˜äº <code>LLM</code> ææ€–çš„æŒ‡ä»¤éµå¾ªå’Œä¸Šä¸‹æ–‡å­¦ä¹ èƒ½åŠ›ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2025/05/28/Large-Language-Diffusion-Models/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/28/Large-Language-Diffusion-Models/" class="post-title-link" itemprop="url">Large Language Diffusion Models</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-05-28 22:19:52" itemprop="dateCreated datePublished" datetime="2025-05-28T22:19:52+08:00">2025-05-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/05/28/Large-Language-Diffusion-Models/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/05/28/Large-Language-Diffusion-Models/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2502.09992">https://arxiv.org/pdf/2502.09992</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://ml-gsai.github.io/LLaDA-demo/">https://ml-gsai.github.io/LLaDA-demo/</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li><code>LLaDA</code> æå‡ºäº†ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå« â€œæ‰©æ•£è¯­è¨€æ¨¡å‹â€ï¼Œå’Œä¸»æµçš„è‡ªå›å½’è¯­è¨€æ¨¡å‹ <code>predict next token</code> çš„æ–¹å¼ä¸åŒï¼Œ<code>LLaDA</code> ä½¿ç”¨ç±»ä¼¼ <code>Diffusion</code> å»å™ªçš„æ–¹æ³•ï¼Œä¸€æ¬¡æ€§ç”Ÿæˆå¤šä¸ª <code>token</code>ï¼Œé€šè¿‡å¤šæ¬¡ç”Ÿæˆï¼Œå¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„ç”Ÿæˆæ–‡æœ¬ã€‚</li>
<li>ä½†ç»†çœ‹å°±ä¼šå‘ç°ï¼Œ<code>Diffusion</code> å°±æ˜¯ä¸€ä¸ªå½»å¤´å½»å°¾çš„å™±å¤´ï¼Œå’Œç»å…¸çš„çƒ­åŠ›å­¦æ‰©æ•£è¿‡ç¨‹æ²¡æœ‰é¸¡æ¯›å…³ç³»ï¼Œ<code>LLaDA</code> æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¤§ <code>BERT</code> æ¨¡å‹ï¼Œç”¨å®Œå½¢å¡«ç©ºçš„æ–¹å¼æ¥ç”Ÿæˆæ–‡æœ¬ï¼ˆä¸€æ¬¡å¯ä»¥åšå¤šä¸ªå®Œå½¢å¡«ç©ºï¼‰ï¼Œåªæ˜¯ä¸‹å›¾æ‰€ç¤ºçš„æ¯è½®è¿­ä»£çš„è¿‡ç¨‹çœ‹èµ·æ¥æœ‰ç‚¹åƒ <code>Diffusion</code> çš„å»å™ªï¼ˆæ²¡å…³ç³»ç¡¬è¹­ï¼‰ã€‚<br />
<img src="https://github.com/ML-GSAI/LLaDA/raw/main/imgs/example_gradio.gif" alt="llada" /></li>
</ul>
<blockquote>
<p>ä¸Šå›¾æ¥è‡ªå®˜æ–¹ <code>repo</code> çš„ <code>README</code></p>
</blockquote>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="æ€»ä½“æµç¨‹"><a class="markdownIt-Anchor" href="#æ€»ä½“æµç¨‹"></a> æ€»ä½“æµç¨‹</h3>
<ul>
<li>è™½ç„¶å¤šå°‘æœ‰ç‚¹æ ‡é¢˜å…šï¼Œä½†è¿™ç¯‡è®ºæ–‡æœ¬èº«æ˜¯å€¼å¾—ä¸€è¯»çš„ï¼Œå°†æ–‡æœ¬ç”Ÿæˆä»»åŠ¡åšäº†é‡æ–°å®šä¹‰ï¼Œç¡®å®å¯å¤§å¹…æé«˜ç”Ÿæˆé€Ÿåº¦ã€‚</li>
</ul>
<h4 id="æ¨¡å‹æ¶æ„"><a class="markdownIt-Anchor" href="#æ¨¡å‹æ¶æ„"></a> æ¨¡å‹æ¶æ„</h4>
<ul>
<li>çº¯çº¯ <code>Transformer encoder</code> æ¶æ„ï¼Œå’Œ <code>BERT</code> ç±»ä¼¼ï¼ŒåŒå‘æ³¨æ„åŠ›ï¼Œæ¨¡å‹å‚æ•°è§„æ¨¡è¾¾ <code>8B</code></li>
</ul>
<h4 id="è®­ç»ƒè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è®­ç»ƒè¿‡ç¨‹"></a> è®­ç»ƒè¿‡ç¨‹</h4>
<ol>
<li>é¢„è®­ç»ƒ
<ul>
<li>ä½¿ç”¨éšæœº <code>mask</code> ä¸€å®šæ¯”ä¾‹çš„ <code>token</code>ï¼Œç„¶åä½¿ç”¨ <code>Transformer</code> é¢„æµ‹è¢« <code>mask</code> çš„ <code>token</code>ï¼ˆå®Œå½¢å¡«ç©ºï¼‰</li>
<li>æŸå¤±å‡½æ•°ï¼š<code>mask</code> éƒ¨åˆ†çš„ <code>cross-entropy</code> æŸå¤±</li>
<li>æ•°æ®è§„æ¨¡ï¼š<code>2.3</code> ä¸‡äº¿ <code>token</code>ï¼ŒåŒ…å«é€šç”¨æ–‡æœ¬ã€ä»£ç å’Œå¤šè¯­è¨€æ•°æ®</li>
</ul>
</li>
<li><code>SFT</code>
<ul>
<li>ç›®æ ‡ï¼šä½¿æ¨¡å‹å…·å¤‡æŒ‡ä»¤è·Ÿéšèƒ½åŠ›</li>
<li>æ•°æ®æ ¼å¼ï¼šæˆå¯¹æ•°æ® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>p</mi><mi>Î¸</mi></msub><mo separator="true">,</mo><msub><mi>r</mi><mi>Î¸</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(p_\theta,r_\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">p_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯æŒ‡ä»¤ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">r_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯å“åº”</li>
<li>æ©ç ç­–ç•¥ï¼šä»…å¯¹å“åº”éƒ¨åˆ†æ©ç ï¼Œä¿æŒæŒ‡ä»¤å®Œæ•´</li>
<li>æŸå¤±å‡½æ•°ï¼šä»…å¯¹å“åº”éƒ¨åˆ†è®¡ç®— <code>cross-entropy</code> æŸå¤±</li>
<li>æ•°æ®è§„æ¨¡ï¼š<code>450</code> ä¸‡å¯¹æŒ‡ä»¤å“åº”å¯¹ï¼Œæ¶µç›–ä»£ç ã€æ•°å­¦å’Œå¤šè½®å¯¹è¯</li>
</ul>
</li>
</ol>
<h4 id="æ¨ç†ä¸ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#æ¨ç†ä¸ç”Ÿæˆ"></a> æ¨ç†ä¸ç”Ÿæˆ</h4>
<ul>
<li>è¿‡ç¨‹ï¼šä»å…¨æ©ç çš„å“åº”å¼€å§‹ï¼Œé€æ­¥é¢„æµ‹å¹¶æ›´æ–°æ©ç  <code>token</code>ï¼Œç›´åˆ°ç”Ÿæˆå®Œæ•´å“åº”</li>
<li>é‡æ©ç ç­–ç•¥ï¼ˆé¢„æµ‹ä¹‹å <code>mask</code> ä¸€éƒ¨åˆ†ç”Ÿæˆç»“æœåšäºŒæ¬¡ç”Ÿæˆï¼‰ï¼š
<ul>
<li>éšæœºé‡æ©ç ï¼šåŸºç¡€ç­–ç•¥ï¼Œä¸æ‰©æ•£è¿‡ç¨‹å¯¹é½</li>
<li>ä½ç½®ä¿¡åº¦é‡æ©ç ï¼šä¼˜å…ˆæ©ç é¢„æµ‹ç½®ä¿¡åº¦ä½çš„ <code>token</code></li>
<li>åŠè‡ªå›å½’ç­–ç•¥ï¼ˆ<code>SFT</code>åï¼‰ï¼šåˆ†å—ç”Ÿæˆï¼Œå—å†…å¹¶è¡Œé¢„æµ‹ä»¥æé«˜æ•ˆç‡</li>
</ul>
</li>
<li>ç”Ÿæˆæ•ˆæœï¼šæ”¯æŒå¤šè½®å¯¹è¯ã€å¤šè¯­è¨€ç¿»è¯‘å’Œå¤æ‚æ¨ç†ä»»åŠ¡</li>
</ul>
<h3 id="å’Œè‡ªå›å½’æ¨¡å‹å¯¹æ¯”"><a class="markdownIt-Anchor" href="#å’Œè‡ªå›å½’æ¨¡å‹å¯¹æ¯”"></a> å’Œè‡ªå›å½’æ¨¡å‹å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th style="text-align:center">ç‰¹æ€§</th>
<th style="text-align:center">è‡ªå›å½’æ¨¡å‹ï¼ˆå¦‚<code>GPT</code>ï¼‰</th>
<th style="text-align:center"><code>LLaDA</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ç”Ÿæˆé¡ºåº</td>
<td style="text-align:center">ä¸¥æ ¼ä»å·¦åˆ°å³é€ <code>token</code> ç”Ÿæˆ</td>
<td style="text-align:center">å¹¶è¡Œé¢„æµ‹ + åŠ¨æ€è°ƒæ•´</td>
</tr>
<tr>
<td style="text-align:center">è®¡ç®—æ•ˆç‡</td>
<td style="text-align:center">éœ€ä¸²è¡Œé¢„æµ‹å¤šæ¬¡</td>
<td style="text-align:center">ä»…éœ€å°‘é‡è¿­ä»£ï¼ˆå—çº§å¹¶è¡Œï¼‰</td>
</tr>
<tr>
<td style="text-align:center">é”™è¯¯ä¿®æ­£èƒ½åŠ›</td>
<td style="text-align:center">æ— æ³•ä¿®æ”¹å·²ç”Ÿæˆ <code>token</code></td>
<td style="text-align:center">é€šè¿‡é‡æ©ç å¯ä¿®æ­£ä½ç½®ä¿¡åº¦ä½ç½®</td>
</tr>
<tr>
<td style="text-align:center">é€†å‘æ¨ç†æ”¯æŒ</td>
<td style="text-align:center">å—é™äºå•å‘å»ºæ¨¡</td>
<td style="text-align:center">åŒå‘æ³¨æ„åŠ›æœºåˆ¶æ”¯æŒé€†å‘æ¨ç†</td>
</tr>
</tbody>
</table>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„å¤§æ¨¡å‹èŒƒå¼æ˜¯å¦ä¸€å®šæ˜¯æœ€ä¼˜çš„ï¼Ÿå¯èƒ½æœªå¿…ã€‚è¿™ç¯‡è®ºæ–‡å°±æå‡ºäº†ä¸€ä¸ªä¸é”™çš„æ€è·¯</li>
<li><code>make bert great again</code> <s>æ‰‹åŠ¨æ»‘ç¨½</s></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zhangzhe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">104</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhangzhe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js', () => {
    // åˆå§‹åŒ– Mermaid é…ç½®
    mermaid.initialize({
      theme    : 'dark',  // è®¾ç½®ä¸»é¢˜
      logLevel : 3,  // è®¾ç½®æ—¥å¿—ç­‰çº§
      flowchart: { curve: 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 },
      themeVariables: {
        'fontFamily': 'Microsoft YaHei, Arial, sans-serif',  // è®¾ç½®ä¸­æ–‡å­—ä½“
      }
    });

    // åˆå§‹åŒ– Mermaid å›¾è¡¨
    mermaid.init(undefined, document.querySelectorAll('pre.mermaid'));
  }, window.mermaid);
}
</script>


  

  
      
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css">


  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'eK3W25jybCO5jVUrYBBpAPqM-gzGzoHsz',
      appKey     : 'F4KVyUj9wHI5c80Bhz7O2uhq',
      placeholder: "è¯´ç‚¹ä»€ä¹ˆå†èµ°å§...",
      avatar     : 'hide',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>

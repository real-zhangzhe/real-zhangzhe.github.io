<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"real-zhangzhe.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Zhangzhe&#39;s Blog">
<meta property="og:url" content="https://real-zhangzhe.github.io/page/10/index.html">
<meta property="og:site_name" content="Zhangzhe&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zhangzhe">
<meta property="article:tag" content="No mistakes in the tango, not like life.">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://real-zhangzhe.github.io/page/10/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Zhangzhe's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Zhangzhe's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The projection of my life.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/archives/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2024/02/20/%E5%85%B3%E9%94%AE%E8%B7%A8%E8%B6%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/20/%E5%85%B3%E9%94%AE%E8%B7%A8%E8%B6%8A/" class="post-title-link" itemprop="url">关键跨越</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-02-20 20:52:50" itemprop="dateCreated datePublished" datetime="2024-02-20T20:52:50+08:00">2024-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%86%E5%AF%BC%E5%8A%9B/" itemprop="url" rel="index"><span itemprop="name">领导力</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/02/20/%E5%85%B3%E9%94%AE%E8%B7%A8%E8%B6%8A/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/02/20/%E5%85%B3%E9%94%AE%E8%B7%A8%E8%B6%8A/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="新手管理者的关键跨越"><a class="markdownIt-Anchor" href="#新手管理者的关键跨越"></a> 新手管理者的关键跨越</h1>
<h2 id="1-新手管理者会遇到的-9-个管理难题和需要完成的-3-个关键跨越"><a class="markdownIt-Anchor" href="#1-新手管理者会遇到的-9-个管理难题和需要完成的-3-个关键跨越"></a> 1. 新手管理者会遇到的 9 个管理难题和需要完成的 3 个关键跨越</h2>
<h3 id="11-九个管理难题"><a class="markdownIt-Anchor" href="#11-九个管理难题"></a> 1.1 九个管理难题</h3>
<ol>
<li>从同事变为管理者，接受和适应“管理者”的身份。</li>
<li>空降到团队做管理者，被团队接纳和认可。</li>
<li>给团队成员分配合理的任务，提出合理的要求。</li>
<li>让员工承担更多或更有挑战性的工作，付出额外的努力。</li>
<li>让员工理解和认同管理者的要求，真正承担起责任。</li>
<li>处理团队搞不定的问题和突发状况。</li>
<li>及时掌握团队的任务执行情况，提前干预。</li>
<li>用恰当的方式给予员工反馈。</li>
<li>根据员工的不同情况，因材施教。</li>
</ol>
<h3 id="12-三个关键跨越"><a class="markdownIt-Anchor" href="#12-三个关键跨越"></a> 1.2 三个关键跨越</h3>
<ol>
<li>获得团队的认可和信任，完成“承担管理责任”的跨越。</li>
<li>让团队稳定可靠地交付工作成果，完成“推动执行”的跨越。</li>
<li>帮助团队改进和提升，完成“辅导他人”的跨越。</li>
</ol>
<h2 id="2-新手管理者为何难以完成关键跨越"><a class="markdownIt-Anchor" href="#2-新手管理者为何难以完成关键跨越"></a> 2. 新手管理者为何难以完成关键跨越</h2>
<h3 id="21-新手管理者普遍存在的现象"><a class="markdownIt-Anchor" href="#21-新手管理者普遍存在的现象"></a> 2.1 新手管理者普遍存在的现象</h3>
<ul>
<li>通常当前在任的一线管理者在“承担管理责任”和“推动执行”方面表现良好，但在“辅导他人”方面表现很差，同时这也是相对最不受企业重视的能力。</li>
</ul>
<h3 id="22-管理者难以完成管理跨越的原因"><a class="markdownIt-Anchor" href="#22-管理者难以完成管理跨越的原因"></a> 2.2 管理者难以完成管理跨越的原因</h3>
<ol>
<li>从关注“事”到关注“人”，管理工作需要把工作对象和重心从“事”转移到“人”，这会挑战一部分管理者的工作习惯。</li>
<li>从“短期”到“长期”，管理工作相对需要更长的时间的投入才能看到成效，一部分管理者会等不及。</li>
<li>从“优势”变成“陷阱”，管理者习惯用过去自己习惯和擅长的方式解决问题，也更喜欢做自己擅长的事情。</li>
</ol>
<h3 id="23-新手管理者应该怎么做"><a class="markdownIt-Anchor" href="#23-新手管理者应该怎么做"></a> 2.3 新手管理者应该怎么做</h3>
<ol>
<li>需要做好的心态准备是“空杯心态”。</li>
<li>对“我过去这样成功过”的想法保持警惕。</li>
<li>列出一个反向待办事项清单，训练自己少做和不做过去自己擅长的事。</li>
</ol>
<h2 id="3-成功跨越在行动中改变"><a class="markdownIt-Anchor" href="#3-成功跨越在行动中改变"></a> 3. 成功跨越：在行动中改变</h2>
<h3 id="31-新手管理者在进行管理发展时需要先理解两个问题"><a class="markdownIt-Anchor" href="#31-新手管理者在进行管理发展时需要先理解两个问题"></a> 3.1 新手管理者在进行管理发展时，需要先理解两个问题</h3>
<ol>
<li>某些人可能更具有管理潜力，更适合做管理。具备潜力的人有更高的起点和更好的准备状态，但无论多有管理潜力，都与管理岗位的要求存在差距，而缩小差距的唯一办法就是进行管理实践。</li>
<li>“知行不合一”是常态，管理者能采取有效的管理行动却未必具备相应的素质能力，同样，不具备一定优势的管理者，仍然可以先努力使自己的行为贴近团队管理者应有的表现。</li>
</ol>
<h3 id="32-新手管理者若想获得发展需要采取的发展原则是从自身优势出发先行动起来"><a class="markdownIt-Anchor" href="#32-新手管理者若想获得发展需要采取的发展原则是从自身优势出发先行动起来"></a> 3.2 新手管理者若想获得发展，需要采取的发展原则是从自身优势出发，先行动起来</h3>
<ol>
<li>了解自己的优势，把自己的优势作为一个支撑点和发力点。</li>
<li>行动起来，在行动中学习和发展。</li>
<li>通过管理历练和具体的时间，发展出相应的素质和能力。</li>
</ol>
<h3 id="33-新手管理者可以采用-apple-发展策略"><a class="markdownIt-Anchor" href="#33-新手管理者可以采用-apple-发展策略"></a> 3.3 新手管理者可以采用 APPLE 发展策略</h3>
<p><strong>APPLE 发展策略：</strong></p>
<ol>
<li><code>Awareness</code>: 认知管理者的要求，以及自身优势。</li>
<li><code>Path</code>: 制定一个最小化的发展路线图。从优势出发，给自己建立一个支撑点，并制定一个包括发展目标，具体行动和检验方法的计划。</li>
<li><code>Practice</code>: 付诸行动，通过刻意和反复的练习，跟过去的习惯已建立好的脑区地图抢夺资源，建立起新的通往目的地的路径。</li>
<li><code>Learn</code>: 学习知识，结合实践总结和反思。在实践中先有体验，学习就是带着问题寻找答案的主动过程。</li>
<li><code>Evaluation</code>: 定期评估，学会重新看待“评价”，把评价看做反映某一阶段性状态的中性动作。</li>
</ol>
<h1 id="关键跨越一承担管理责任"><a class="markdownIt-Anchor" href="#关键跨越一承担管理责任"></a> 关键跨越一：承担管理责任</h1>
<h2 id="4-信任的基石承担管理责任"><a class="markdownIt-Anchor" href="#4-信任的基石承担管理责任"></a> 4. 信任的基石：承担管理责任</h2>
<h3 id="41-新手管理者上任后的首要任务是取得团队的认可和信任"><a class="markdownIt-Anchor" href="#41-新手管理者上任后的首要任务是取得团队的认可和信任"></a> 4.1 新手管理者上任后的首要任务是取得团队的认可和信任</h3>
<ol>
<li>必须表现出一个管理者该有的样子，承担起管理的责任。</li>
<li>承担管理责任有三个关键要点：表率垂范、为结果负责和组织意识。</li>
</ol>
<h3 id="42-表率垂范包括以身作则和身先士卒"><a class="markdownIt-Anchor" href="#42-表率垂范包括以身作则和身先士卒"></a> 4.2 表率垂范包括以身作则和身先士卒</h3>
<ol>
<li>以身作则的核心是，要求下属的管理者自己要先做到。</li>
<li>身先士卒主要是，管理者在困难或关键时刻能顶上，冲在最前面。</li>
<li>要做到表率垂范，态度和勇气比能力更重要，是愿不愿的问题，而非能不能到问题。</li>
</ol>
<h3 id="43-为结果负责包括为所做决定负责和为团队的工作结果负责"><a class="markdownIt-Anchor" href="#43-为结果负责包括为所做决定负责和为团队的工作结果负责"></a> 4.3 为结果负责包括为所做决定负责和为团队的工作结果负责</h3>
<ol>
<li>要做到为决定负责，得学会适应两个常态：一是会犯错，二是不能两全其美。</li>
<li>为团队的工作结果负责要区分“好”的和“坏”的结果。取得坏结果时要帮团队“背锅”，取得好结果时则要把舞台和聚光灯留给下属。</li>
</ol>
<h3 id="44-组织意识包括遵守和代表组织的规则以及团队的利益为先"><a class="markdownIt-Anchor" href="#44-组织意识包括遵守和代表组织的规则以及团队的利益为先"></a> 4.4 组织意识包括遵守和代表组织的规则，以及团队的利益为先</h3>
<ol>
<li>在建章立制之前，应先适应和符合现有的规则。</li>
<li>团队利益为先是指你要为团队和公司着想，把个人利益放在团队之后。</li>
</ol>
<h2 id="5-新手管理者容易走进的误区"><a class="markdownIt-Anchor" href="#5-新手管理者容易走进的误区"></a> 5. 新手管理者容易走进的误区</h2>
<h3 id="51-新手管理者在取得下属认可和信任时容易走入的第一类误区"><a class="markdownIt-Anchor" href="#51-新手管理者在取得下属认可和信任时容易走入的第一类误区"></a> 5.1 新手管理者在取得下属认可和信任时，容易走入的第一类误区</h3>
<ol>
<li>过于依赖个人的专业能力，想要靠专业征服团队。这会带来的主要问题是管理者成为团队能力的上限，限制员工的发展。</li>
<li>认为可以完全不靠专业，发挥领导力即可。这会带来的问题是管理浮于表面，无法获得实质性的成效。</li>
</ol>
<h3 id="52-在进入管理岗位后管理者需要在个人能力上实现两个转换"><a class="markdownIt-Anchor" href="#52-在进入管理岗位后管理者需要在个人能力上实现两个转换"></a> 5.2 在进入管理岗位后，管理者需要在个人能力上实现两个转换</h3>
<ol>
<li>从运用自己的专业能力解决具体问题，转换为将专业优势赋能于团队。</li>
<li>从运用自己的个人实力去带领团队，转换为培养和成就团队。</li>
</ol>
<h3 id="53-第二类误区是让下属满意还是让上级满意的问题"><a class="markdownIt-Anchor" href="#53-第二类误区是让下属满意还是让上级满意的问题"></a> 5.3 第二类误区是让下属满意，还是让上级满意的问题</h3>
<ol>
<li>唯下”的管理者通常用两种方式取悦下属：一是让下属尽量少吃苦，二是滥用物质奖励。本质上都只是满足了保障性因素，只能让下属处于“不是不满意，也不是满意”的中性状态。</li>
<li>“唯上”的管理者围绕上级开展工作，不太关心员工的感受。这类管理者的个人发展极为有限，更易受领导更换或组织环境变化影响。</li>
</ol>
<h3 id="54-管理者只需要让客户满意这本质上是对绩效负责"><a class="markdownIt-Anchor" href="#54-管理者只需要让客户满意这本质上是对绩效负责"></a> 5.4 管理者只需要让客户满意，这本质上是对绩效负责</h3>
<ol>
<li>管理者需要为此而帮助下属改进和挑战下属突破。这是管理者与团队建立信任的正确方式。</li>
</ol>
<h3 id="55-第三类误区是关于与下属的距离和关系"><a class="markdownIt-Anchor" href="#55-第三类误区是关于与下属的距离和关系"></a> 5.5 第三类误区是关于与下属的距离和关系</h3>
<p>管理者易走入的两个极端：</p>
<ol>
<li>制造距离感，以树立个人领导权威。</li>
<li>过于注重经营关系，导致为关系所累，或是只运用人际和影响技巧而不交心，变成对下属的操纵控制。</li>
</ol>
<h3 id="56-管理者需要把握不同场合的交往分寸"><a class="markdownIt-Anchor" href="#56-管理者需要把握不同场合的交往分寸"></a> 5.6 管理者需要把握不同场合的交往分寸</h3>
<ul>
<li>管理者需要把握不同场合的交往分寸，做到“工作时严肃立规矩，私下可称兄道弟”。“事务”导向和“人际”导向的管理者所需要的努力不同，前者需要增加交流和互动，后者需要把握好情感投入的度。这样管理者与下属之间才能既有信任，也有温度。</li>
</ul>
<h2 id="6-真诚是最好的套路"><a class="markdownIt-Anchor" href="#6-真诚是最好的套路"></a> 6. 真诚是最好的套路</h2>
<h3 id="61-真诚是赢得信任的终极套路包括真诚坦率和展现真我"><a class="markdownIt-Anchor" href="#61-真诚是赢得信任的终极套路包括真诚坦率和展现真我"></a> 6.1 真诚是赢得信任的终极套路，包括真诚坦率和展现真我</h3>
<h3 id="62-真诚坦率包括两个维度"><a class="markdownIt-Anchor" href="#62-真诚坦率包括两个维度"></a> 6.2 真诚坦率包括两个维度</h3>
<ol>
<li>管理者能分享真实的信息，不隐瞒、不遮掩、不欺骗。</li>
<li>管理者能站在员工的角度理解员工，照顾员工的感受，真正为员工着想。根据这两个维度，管理者与下属相处有四种方式。
<ul>
<li>虚伪应付：不告知员工信息或不讲真话，同时也不在乎员工的感受。这是最不真诚的，管理者展现的是一种高高在上地掌控一切的傲慢。</li>
<li>真情假意：因为担心员工受伤害，而遮遮掩掩，不直接沟通。这样反而会弄巧成拙，员工会感觉到管理者有话不明说，因而会有各种猜测，从而造成很多误会。</li>
<li>直言不讳：有话明说，但不太考虑员工的感受。尽管可能会让员工感觉不舒服，但这种方式比虚伪应付和真情假意更真诚。</li>
<li>真诚坦率：既讲真话、实话，又能照顾到员工的感受。</li>
</ul>
</li>
</ol>
<h3 id="63-做到真诚坦率要注意五点"><a class="markdownIt-Anchor" href="#63-做到真诚坦率要注意五点"></a> 6.3 做到真诚坦率要注意五点</h3>
<ol>
<li>就事论事</li>
<li>讲具体的事</li>
<li>多分析背景信息</li>
<li>不带着情绪</li>
<li>多给建议和指导</li>
</ol>
<h3 id="64-为了满足各种社会期待每个人都会包装自己"><a class="markdownIt-Anchor" href="#64-为了满足各种社会期待每个人都会包装自己"></a> 6.4 为了满足各种社会期待，每个人都会包装自己</h3>
<p>但如果包装后的公众自我与你的内在自我差别很大，就会出现问题。</p>
<ol>
<li>虚张声势很容易会被看出来，让管理者看起来不值得被信赖。</li>
<li>过度假装会让管理者自己很不开心。</li>
</ol>
<h3 id="65-展现真我要做到三点"><a class="markdownIt-Anchor" href="#65-展现真我要做到三点"></a> 6.5 展现真我要做到三点</h3>
<ol>
<li>认识你自己</li>
<li>建立你内心的准则</li>
<li>适当地暴露弱点</li>
</ol>
<h1 id="关键跨越二推动执行"><a class="markdownIt-Anchor" href="#关键跨越二推动执行"></a> 关键跨越二：推动执行</h1>
<h2 id="7-新手管理者的执行力-20"><a class="markdownIt-Anchor" href="#7-新手管理者的执行力-20"></a> 7. 新手管理者的执行力 2.0</h2>
<h3 id="71-新手管理者需要将个人执行力升级为团队执行力"><a class="markdownIt-Anchor" href="#71-新手管理者需要将个人执行力升级为团队执行力"></a> 7.1 新手管理者需要将个人执行力升级为团队执行力</h3>
<ul>
<li>新手管理者需要将个人执行力升级为团队执行力，把最大化团队产出作为自己的工作目标，投入精力完成管理工作。</li>
</ul>
<h3 id="72-新手管理者要充分发挥团队成员的能力"><a class="markdownIt-Anchor" href="#72-新手管理者要充分发挥团队成员的能力"></a> 7.2 新手管理者要充分发挥团队成员的能力</h3>
<ul>
<li>新手管理者要充分发挥团队成员的能力，激发团队成员的工作动力，并提供必要的支持，为团队成员减少工作阻力。</li>
</ul>
<h3 id="73-新手管理者需要警惕常见的六大误区"><a class="markdownIt-Anchor" href="#73-新手管理者需要警惕常见的六大误区"></a> 7.3 新手管理者需要警惕常见的六大误区</h3>
<ul>
<li>新手管理者需要警惕常见的六大误区，规避不适用的思维模式和行为模式，完成管理角色转型。
<ul>
<li>误区一：超人心态</li>
<li>误区二：完美主义</li>
<li>误区三：想当然</li>
<li>误区四：控制狂</li>
<li>误区五：疏离旁观</li>
<li>误区六：安于现状</li>
</ul>
</li>
</ul>
<h2 id="8-做该做的事把猴子还给下属"><a class="markdownIt-Anchor" href="#8-做该做的事把猴子还给下属"></a> 8. 做该做的事，把“猴子”还给下属</h2>
<h3 id="81-管理者要多做自己该做的事少做或不做不该做的事"><a class="markdownIt-Anchor" href="#81-管理者要多做自己该做的事少做或不做不该做的事"></a> 8.1 管理者要多做自己该做的事，少做或不做不该做的事</h3>
<ol>
<li>员工现有能力可以完成的任务，要坚定不移地交给员工去做。</li>
<li>员工“跳一跳”能完成的任务也可以交给员工去做，同时管理者要提供必要的辅导和资源支持。</li>
<li>员工能力差距较大但有意愿去挑战的任务，如果有试错的空间，管理者可以和员工一起做，并承担失败的风险。</li>
</ol>
<h3 id="82-忍住让员工去思考和解决问题避免接过原本属于员工的猴子"><a class="markdownIt-Anchor" href="#82-忍住让员工去思考和解决问题避免接过原本属于员工的猴子"></a> 8.2 忍住，让员工去思考和解决问题，避免接过原本属于员工的“猴子”</h3>
<ol>
<li>不要直接给员工答案。</li>
<li>用提问的方式启发员工，让员工思考下一步如何行动。</li>
<li>让员工为工作任务负起责任来。</li>
</ol>
<h3 id="83-不要做超人放平心态"><a class="markdownIt-Anchor" href="#83-不要做超人放平心态"></a> 8.3 不要做“超人”，放平心态</h3>
<ol>
<li>对团队多一些耐心，不要为了快速达成目标而代替员工完成工作。</li>
<li>通过帮助团队成长获得新的成就感，不要因为无法站在舞台中央的失落感，就选择自己做事，和下属竞争站回舞台中央的机会。</li>
<li>不要因为害怕失败就不敢冒险放手让下属尝试，要给员工犯错空间，并学会把失败当成自己和团队学习的机会。</li>
<li>不需要通过代替员工做事去刻意讨好下属，得有把任务派给员工后被讨厌的勇气。</li>
</ol>
<h2 id="9-要事第一目标取舍的智慧和勇气"><a class="markdownIt-Anchor" href="#9-要事第一目标取舍的智慧和勇气"></a> 9. 要事第一：目标取舍的智慧和勇气</h2>
<h3 id="91-良好的开端是成功的一半在明确目标阶段管理者要做到要事第一"><a class="markdownIt-Anchor" href="#91-良好的开端是成功的一半在明确目标阶段管理者要做到要事第一"></a> 9.1 良好的开端是成功的一半，在明确目标阶段管理者要做到“要事第一”</h3>
<ol>
<li>到重要的20%，重点投入。</li>
<li>跟上级充分沟通，让上级帮助明确不同目标的重要性和优先级排序。</li>
<li>不要追求面面俱到，得学会取舍，避免目标平均主义。</li>
</ol>
<h3 id="92-管理者在完成短期目标的同时需要考虑如何实现年度目标逐步建立长期思维"><a class="markdownIt-Anchor" href="#92-管理者在完成短期目标的同时需要考虑如何实现年度目标逐步建立长期思维"></a> 9.2 管理者在完成短期目标的同时，需要考虑如何实现年度目标，逐步建立长期思维</h3>
<ol>
<li>管理工作本身就是在为长期目标负责。</li>
<li>学会拉长时间维度去评估投入与收益。</li>
<li>根据业务紧迫性和团队成熟度对目标的优先级进行动态调整。</li>
</ol>
<h2 id="10-人事匹配让对的人去做对的事"><a class="markdownIt-Anchor" href="#10-人事匹配让对的人去做对的事"></a> 10. 人事匹配：让对的人去做对的事</h2>
<h3 id="101-根据意愿能力四象限完成人事匹配"><a class="markdownIt-Anchor" href="#101-根据意愿能力四象限完成人事匹配"></a> 10.1 根据意愿能力四象限，完成人事匹配</h3>
<ol>
<li>对于高意愿高能力的明星员工，可以把有难度的重要工作交给他们。</li>
<li>对于低意愿低能力的问题员工，需要进行绩效反馈，明确绩效改进方向。</li>
<li>对于高意愿低能力的“潜力股”员工，应以能胜任的工作任务为主，同时分配一些“跳起来”可以够得着的挑战性任务来提升其能力。</li>
<li>对于低意愿高能力的“精明人”员工，需要适当激发，并保证团队内部任务分配和激励回报的公平性。</li>
</ol>
<h3 id="102-可以通过观察-询问-实战三个环节来判断员工的意愿和能力"><a class="markdownIt-Anchor" href="#102-可以通过观察-询问-实战三个环节来判断员工的意愿和能力"></a> 10.2 可以通过观察、询问、实战三个环节来判断员工的意愿和能力</h3>
<h3 id="103-在进行任务沟通时管理者要做到四点"><a class="markdownIt-Anchor" href="#103-在进行任务沟通时管理者要做到四点"></a> 10.3 在进行任务沟通时，管理者要做到四点</h3>
<ul>
<li>第一，将工作“翻译”成员工更容易听懂的语言，解释清楚“为什么”。</li>
<li>第二，清晰无误地说明任务要求，不遗漏必要信息。</li>
<li>第三，进行双向沟通，获得员工及时反馈。</li>
<li>第四，与员工沟通不同工作的优先级。</li>
</ul>
<h3 id="104-管理者要避免陷入想当然误区"><a class="markdownIt-Anchor" href="#104-管理者要避免陷入想当然误区"></a> 10.4 管理者要避免陷入“想当然”误区</h3>
<ul>
<li>管理者要避免陷入“想当然”误区，主动反思自己是否以己度人，忽略了人与人之间的差异，或低估了任务的难度。</li>
</ul>
<h3 id="105-管理者要避免想当然应该在行动上向员工展现出欢迎提问的姿态也需要在工作中多观察员工的行为了解员工的意愿和能力"><a class="markdownIt-Anchor" href="#105-管理者要避免想当然应该在行动上向员工展现出欢迎提问的姿态也需要在工作中多观察员工的行为了解员工的意愿和能力"></a> 10.5 管理者要避免“想当然”，应该在行动上向员工展现出欢迎提问的姿态，也需要在工作中多观察员工的行为，了解员工的意愿和能力</h3>
<h2 id="11-过程管理把握尺度"><a class="markdownIt-Anchor" href="#11-过程管理把握尺度"></a> 11. 过程管理：把握尺度</h2>
<h3 id="111-根据任务容错率和员工成熟度选择不同的管控方式避免一刀切"><a class="markdownIt-Anchor" href="#111-根据任务容错率和员工成熟度选择不同的管控方式避免一刀切"></a> 11.1 根据任务容错率和员工成熟度选择不同的管控方式，避免一刀切</h3>
<ol>
<li>对于容错率高的任务，如果员工成熟度高，可以让员工放手去做；如果员工成熟度低，则需要加强过程辅导。</li>
<li>对于容错率低的任务，即使员工成熟度高，管理者仍需要管理过程中的关键节点；如果员工成熟度低，这项任务应该由管理者自己负责，带着员工一起完成。</li>
</ol>
<h3 id="112-在过程管理中要避免陷入微观管理变成控制狂也不能放手不管做一个远离团队的甩手掌柜"><a class="markdownIt-Anchor" href="#112-在过程管理中要避免陷入微观管理变成控制狂也不能放手不管做一个远离团队的甩手掌柜"></a> 11.2 在过程管理中要避免陷入微观管理，变成“控制狂”，也不能放手不管，做一个远离团队的“甩手掌柜”</h3>
<h3 id="113-过程管理更有效的方式是设置合理的信息沟通反馈机制"><a class="markdownIt-Anchor" href="#113-过程管理更有效的方式是设置合理的信息沟通反馈机制"></a> 11.3 过程管理更有效的方式是设置合理的信息沟通反馈机制</h3>
<ul>
<li>管理者可以通过以下方式获取需要的信息：
<ul>
<li>定期开例会</li>
<li>建立抄送邮件的规则</li>
<li>工作进度可视化</li>
<li>开展专项会议讨论</li>
<li>加强非正式沟通</li>
</ul>
</li>
</ul>
<h2 id="12-vuca时代需要敏捷执行"><a class="markdownIt-Anchor" href="#12-vuca时代需要敏捷执行"></a> 12. VUCA时代需要敏捷执行</h2>
<h3 id="121-vuca时代需要敏捷执行核心是以终为始抓住关键矛盾"><a class="markdownIt-Anchor" href="#121-vuca时代需要敏捷执行核心是以终为始抓住关键矛盾"></a> 12.1 VUCA时代需要敏捷执行，核心是以终为始，抓住关键矛盾</h3>
<h3 id="122-产出最小化可交付成果尽早获得最终用户的反馈通过多次迭代来更聪明-高效地工作完成比完美更重要"><a class="markdownIt-Anchor" href="#122-产出最小化可交付成果尽早获得最终用户的反馈通过多次迭代来更聪明-高效地工作完成比完美更重要"></a> 12.2 产出最小化可交付成果，尽早获得最终用户的反馈，通过多次迭代来更聪明、高效地工作，完成比完美更重要</h3>
<h3 id="123-制订有弹性的工作计划给自己预留20的时间用于应对临时出现的重要任务或者就用于思考避免被不重要的事情塞满日程表"><a class="markdownIt-Anchor" href="#123-制订有弹性的工作计划给自己预留20的时间用于应对临时出现的重要任务或者就用于思考避免被不重要的事情塞满日程表"></a> 12.3 制订有弹性的工作计划，给自己预留20%的时间用于应对临时出现的重要任务或者就用于思考，避免被不重要的事情塞满日程表</h3>
<h3 id="124-管理者要敢于说不赢回自己的时间"><a class="markdownIt-Anchor" href="#124-管理者要敢于说不赢回自己的时间"></a> 12.4 管理者要敢于说“不”，赢回自己的时间</h3>
<p>具体可以参考以下三个步骤：</p>
<ul>
<li>复述对方的要求</li>
<li>解释拒绝的原因</li>
<li>坦诚说“不”</li>
</ul>
<h2 id="13-复盘让管理实现闭环"><a class="markdownIt-Anchor" href="#13-复盘让管理实现闭环"></a> 13. 复盘让管理实现闭环</h2>
<h3 id="131-复盘让管理形成闭环为管理者提供思考的空间也是团队改进和提升的原点"><a class="markdownIt-Anchor" href="#131-复盘让管理形成闭环为管理者提供思考的空间也是团队改进和提升的原点"></a> 13.1 复盘让管理形成闭环，为管理者提供思考的空间，也是团队改进和提升的原点</h3>
<h3 id="132-成功的复盘要求管理者和团队成员建立信任保持开放-包容的心态并有能力从过往的实践中提炼出规律性的结论指导行动"><a class="markdownIt-Anchor" href="#132-成功的复盘要求管理者和团队成员建立信任保持开放-包容的心态并有能力从过往的实践中提炼出规律性的结论指导行动"></a> 13.2 成功的复盘要求管理者和团队成员建立信任，保持开放、包容的心态，并有能力从过往的实践中提炼出规律性的结论，指导行动</h3>
<h3 id="133-复盘可以作为日常管理的工具要做到及时和精要才能保证良好的复盘效果"><a class="markdownIt-Anchor" href="#133-复盘可以作为日常管理的工具要做到及时和精要才能保证良好的复盘效果"></a> 13.3 复盘可以作为日常管理的工具，要做到及时和精要，才能保证良好的复盘效果</h3>
<h3 id="134-专项复盘可以帮助团队及时总结失败教训沉淀成功经验"><a class="markdownIt-Anchor" href="#134-专项复盘可以帮助团队及时总结失败教训沉淀成功经验"></a> 13.4 专项复盘可以帮助团队及时总结失败教训，沉淀成功经验</h3>
<p>专项复盘分为三步曲：</p>
<ul>
<li>还原事实</li>
<li>分析问题根因</li>
<li>制订行动计划</li>
</ul>
<h1 id="关键跨越三辅导他人"><a class="markdownIt-Anchor" href="#关键跨越三辅导他人"></a> 关键跨越三：辅导他人</h1>
<h2 id="14-辅导他人亟待提升"><a class="markdownIt-Anchor" href="#14-辅导他人亟待提升"></a> 14. 辅导他人，亟待提升</h2>
<h3 id="141-辅导员工的关键四步"><a class="markdownIt-Anchor" href="#141-辅导员工的关键四步"></a> 14.1 .辅导员工的关键四步</h3>
<ul>
<li>投入时间：坚持在辅导上投入时间，切实帮助团队提升。</li>
<li>明确目标：以绩效目标为导向，了解员工现状，和员工就发展目标达成共识。</li>
<li>反馈与指导：在辅导现场，直面挑战，提升员工的积极性，帮助员工解决问题。</li>
<li>跟进与评价：跟进与评价员工的表现，评价他们的行为进展，并通过正确地批评和表扬他们，帮助他们更好地提升。</li>
</ul>
<h3 id="142-新手管理者在辅导上容易陷入的三个误区"><a class="markdownIt-Anchor" href="#142-新手管理者在辅导上容易陷入的三个误区"></a> 14.2 新手管理者在辅导上容易陷入的三个误区</h3>
<ul>
<li>理想化：辅导形式大于内容，不考虑业务需求和员工现状。</li>
<li>以自我为中心：只从自己的想法出发，忽视员工与自己的差异，遇到问题不是从自身寻找原因。</li>
<li>急于求成：对员工的成长没有耐心，辅导员工时容易急躁，急于给员工下定论，难以持续投入。</li>
</ul>
<h2 id="15-辅导的开始如何投入时间"><a class="markdownIt-Anchor" href="#15-辅导的开始如何投入时间"></a> 15. 辅导的开始：如何投入时间</h2>
<p>管理者进行辅导的第一步：切实有效地在辅导上投入时间。管理者要注意：</p>
<h3 id="151-不为自己没有在辅导上投入找借口"><a class="markdownIt-Anchor" href="#151-不为自己没有在辅导上投入找借口"></a> 15.1 不为自己没有在辅导上投入找借口</h3>
<ol>
<li>正视自己没有辅导员工的现状，思考自己要如何改变。</li>
<li>相信自己可以决定自己的时间，并为自己的时间负责。</li>
</ol>
<h3 id="152-找到问题的症结所在避免陷入越努力越忙碌的处境"><a class="markdownIt-Anchor" href="#152-找到问题的症结所在避免陷入越努力越忙碌的处境"></a> 15.2 找到问题的症结所在，避免陷入“越努力，越忙碌”的处境</h3>
<ol>
<li>管理者面对的问题是系统性问题，单一的问题解决思路会起到反效果。</li>
<li>评估自己的行为会对团队产生的影响，通过辅导提升团队能力，从而建立自己在工作中的正向循环。</li>
</ol>
<h3 id="153-坚持在辅导上进行投入"><a class="markdownIt-Anchor" href="#153-坚持在辅导上进行投入"></a> 15.3 坚持在辅导上进行投入</h3>
<ol>
<li>辅导更需要细水长流的投入，考验的是管理者是否能坚持。</li>
<li>管理者需要有意识地培养自己的辅导习惯，可以通过诸如“辅导他人行为清单”的方式提醒自己。</li>
</ol>
<h3 id="154-基于二八原则分配自己的时间"><a class="markdownIt-Anchor" href="#154-基于二八原则分配自己的时间"></a> 15.4 基于二八原则分配自己的时间</h3>
<ol>
<li>管理者辅导员工时需要以团队的产出最大化为目标。</li>
<li>表现优秀的员工更值得，也更需要管理者的辅导。</li>
<li>只关注绩效表现不佳的员工，容易让其他员工感到不公平。</li>
<li>有效分配时间的关键在于准确地对员工进行分类。</li>
<li>管理者在评估员工时，要同时关注当下工作和未来工作的要求。</li>
</ol>
<h2 id="16-明确目标促进绩效达成"><a class="markdownIt-Anchor" href="#16-明确目标促进绩效达成"></a> 16. 明确目标，促进绩效达成</h2>
<p>管理者在和员工制定辅导目标时，需要遵循以下三个原则：</p>
<h3 id="161-促进绩效提升"><a class="markdownIt-Anchor" href="#161-促进绩效提升"></a> 16.1 促进绩效提升</h3>
<ol>
<li>基于对绩效目标的分析，结合员工当下的重点工作，初步找出可能需要提升的地方。</li>
<li>还原工作现场，通过行为观察、他人反馈、情境模拟等多种方式，了解员工实际的工作情况。</li>
<li>深入分析，找到员工表现背后的原因，制定有针对性的辅导方向。</li>
</ol>
<h3 id="162-和员工达成共识"><a class="markdownIt-Anchor" href="#162-和员工达成共识"></a> 16.2 和员工达成共识</h3>
<ol>
<li>在与员工沟通前，管理者和员工都需要做好充分的准备。</li>
<li>鼓励员工发表意见，认真倾听员工的想法，并且即使遇到冲突也就事论事，不强求员工听取自己的意见，也不和员工去争一时的对错。</li>
</ol>
<h3 id="163-辅导目标可评估-可实现"><a class="markdownIt-Anchor" href="#163-辅导目标可评估-可实现"></a> 16.3 辅导目标可评估、可实现</h3>
<ol>
<li>辅导目标要注重可行性，不要好高骛远。</li>
<li>辅导目标中应该包含具体的行为，有助于管理者和员工达成共识。</li>
</ol>
<h2 id="17-信任-激发与赋能"><a class="markdownIt-Anchor" href="#17-信任-激发与赋能"></a> 17. 信任、激发与赋能</h2>
<p>在成功辅导员工的过程中，管理者要做到三件事情：与员工建立相互信任的辅导关系；激发员工不断提升自我的积极性；赋能员工，提升员工解决问题的能力。</p>
<h3 id="171-建立相互信任的辅导关系"><a class="markdownIt-Anchor" href="#171-建立相互信任的辅导关系"></a> 17.1 建立相互信任的辅导关系</h3>
<ol>
<li>管理者要让员工尽快感受到自己的提升，从而让其对辅导抱有信心。</li>
<li>管理者需要避免高高在上，和员工做平等沟通，多倾听员工的想法。</li>
</ol>
<h3 id="172-激发员工的积极性"><a class="markdownIt-Anchor" href="#172-激发员工的积极性"></a> 17.2 激发员工的积极性</h3>
<ol>
<li>面对受挫的员工：管理者需要引导员工从长远和正向的角度看待问题，理解其受挫的感受和心情，并通过工作的调配转移其注意力。</li>
<li>面对积极性不高的员工：让员工更客观地认知自己的水平；为员工树立榜样，展现未来发展愿景；通过竞争持续调动员工的积极性。</li>
<li>面对缺少行动力的员工：发挥目标的管控作用，要求员工必须有行动；让员工为自己负责，管理者避免越俎代庖；必要时，终止辅导关系。</li>
</ol>
<h3 id="173-赋能员工"><a class="markdownIt-Anchor" href="#173-赋能员工"></a> 17.3 赋能员工</h3>
<ol>
<li>理解员工能力提升的三个阶段：知道、理解和应用。员工要逐步形成自己的知识体系，并通过思考和实践，不断地获得反馈和提升。</li>
<li>只让员工去尝试而不给予反馈，或只让员工学习知识而不实践都不是适合员工的辅导方式。</li>
<li>在赋能员工时，管理者要让员工通过历练，感受到挑战和问题所在，并对问题进行分析和思考，进而在实践中做出尝试和探索。在逐步探索中，管理者要鼓励员工形成自己的判断，通过对外输出，将自己的经验转化为能力。</li>
</ol>
<h2 id="18-跟进与评价"><a class="markdownIt-Anchor" href="#18-跟进与评价"></a> 18. 跟进与评价</h2>
<p>员工的能力提升需要经历持续练习和反馈的过程。管理者需要在这个过程中持续跟进员工的行为表现，及时发现并指出员工的问题，帮助他们持续改进。管理者还需要及时看到员工取得的进展，并及时给予鼓励和肯定。</p>
<h3 id="181-把辅导当成项目来管理"><a class="markdownIt-Anchor" href="#181-把辅导当成项目来管理"></a> 18.1 把辅导当成项目来管理</h3>
<p>跟进最难的地方在于坚持，管理者可以按照管理项目的方式，始终聚焦辅导目标，制订跟进计划，明确责任人，使用辅助工具，以帮助自己形成跟进的习惯。</p>
<h3 id="182-对员工的成长有耐心"><a class="markdownIt-Anchor" href="#182-对员工的成长有耐心"></a> 18.2 对员工的成长有耐心</h3>
<p>员工的成长并非一蹴而就，管理者需要给员工时间和试错的空间，并且当员工取得进步时，即使没有达到期待，也要给予正向的鼓励。</p>
<h3 id="183-做出正确的批评和表扬"><a class="markdownIt-Anchor" href="#183-做出正确的批评和表扬"></a> 18.3 做出正确的批评和表扬</h3>
<p>跟进是评价和反馈的基础，要做到正确地批评和表扬，管理者要以事实为依据，以解决问题为导向，并在沟通时保持真诚。</p>
<h1 id="成为管理者"><a class="markdownIt-Anchor" href="#成为管理者"></a> 成为管理者</h1>
<h2 id="19-管理者发展的全景图五个阶段的关键跨越"><a class="markdownIt-Anchor" href="#19-管理者发展的全景图五个阶段的关键跨越"></a> 19. 管理者发展的全景图：五个阶段的关键跨越</h2>
<h3 id="191-一个人的职业发展会历经很多角色了解管理者发展的全景图能帮助你提前做好准备学会换位思考理解上下级的工作挑战和想法"><a class="markdownIt-Anchor" href="#191-一个人的职业发展会历经很多角色了解管理者发展的全景图能帮助你提前做好准备学会换位思考理解上下级的工作挑战和想法"></a> 19.1 一个人的职业发展会历经很多角色，了解管理者发展的全景图，能帮助你提前做好准备，学会换位思考，理解上下级的工作挑战和想法</h3>
<h3 id="192-你会经历的职场角色有五个阶段"><a class="markdownIt-Anchor" href="#192-你会经历的职场角色有五个阶段"></a> 19.2 你会经历的职场角色有五个阶段</h3>
<ol>
<li>管理自我</li>
<li>管理他人</li>
<li>管理管理者</li>
<li>管理职能/事业部</li>
<li>管理企业</li>
</ol>
<h3 id="193-管理自我阶段的关键挑战"><a class="markdownIt-Anchor" href="#193-管理自我阶段的关键挑战"></a> 19.3 管理自我阶段的关键挑战</h3>
<p>管理自我阶段的关键挑战:稳定可靠地交付工作成果、保持并提高专业的水准和效率、与客户和工作伙伴顺畅沟通。<br />
所需完成的关键跨越：</p>
<ol>
<li>高效执行</li>
<li>展现专业素养</li>
<li>有效沟通</li>
</ol>
<h3 id="194-管理他人阶段的关键挑战"><a class="markdownIt-Anchor" href="#194-管理他人阶段的关键挑战"></a> 19.4 管理他人阶段的关键挑战</h3>
<p>管理他人阶段的关键挑战：获得团队的认可和信任、让团队稳定可靠地交付工作成果、帮助团队改进和提升。<br />
所需完成的关键跨越：</p>
<ol>
<li>承担管理责任</li>
<li>推动执行</li>
<li>辅导他人</li>
</ol>
<h3 id="195-管理管理者阶段的关键挑战"><a class="markdownIt-Anchor" href="#195-管理管理者阶段的关键挑战"></a> 19.5 管理管理者阶段的关键挑战</h3>
<p>管理管理者阶段的关键挑战：</p>
<ol>
<li>系统性地解决问题</li>
<li>让一线管理者充分发挥作用</li>
<li>统一目标，平衡资源和利益<br />
所需完成的关键跨越：</li>
<li>系统化思考</li>
<li>授权</li>
<li>协同增效</li>
</ol>
<h3 id="196-管理职能事业部阶段的关键挑战"><a class="markdownIt-Anchor" href="#196-管理职能事业部阶段的关键挑战"></a> 19.6 管理职能/事业部阶段的关键挑战</h3>
<p>应对常态化的模糊和不确定状况、以经营思维管理职能部门或事业部、确保人才梯队支持业务持续发展。所需完成的关键跨越：</p>
<ol>
<li>模糊决策</li>
<li>经营意识</li>
<li>构建人才梯队</li>
</ol>
<h3 id="197-整个职业发展过程中也起着决定性作用的另外几个底层能力"><a class="markdownIt-Anchor" href="#197-整个职业发展过程中也起着决定性作用的另外几个底层能力"></a> 19.7 整个职业发展过程中也起着决定性作用的另外几个底层能力</h3>
<p>还有几个底层能力，在整个职业发展过程中也起着决定性作用。这些能力包括：</p>
<ol>
<li>清晰的自我认知能力</li>
<li>持续学习能力</li>
<li>弹性和韧性</li>
</ol>
<h3 id="198-发展关键跨越上的能力"><a class="markdownIt-Anchor" href="#198-发展关键跨越上的能力"></a> 19.8 发展关键跨越上的能力</h3>
<p>发展关键跨越上的能力需要做到：</p>
<ol>
<li>充分了解这些能力的完整行为链条</li>
<li>保持刻意练习</li>
<li>做好打持久战的准备</li>
</ol>
<h2 id="20-一生的修炼更好的自己"><a class="markdownIt-Anchor" href="#20-一生的修炼更好的自己"></a> 20. 一生的修炼，更好的自己</h2>
<p>如同电影《和平战士》中，心灵导师苏格拉底对主人公丹·米尔曼所说：“没有开始或者终止，只有过程。”人生是一场修炼，修的是心性，炼的是技能，没有终点，出生即开始，永远都在进程中。我们陪伴了很多管理者走过“至暗时刻”，别着急，每个人都会经历，没有谁比谁更高明，只要坚持就会成功。在坚持的路上，除了职场的收获，你还会获得很多可迁移的技能。正如在游泳池中学会了游泳，在大海中也能施展一样。管理者练就的管理技能、打磨的心性，都可以在更多人生的场景找到应用机会。所以可以说，一旦成为管理者，就进入了这场修行的经验加速区：管理技能要求的倾听、沟通、共情，用在处理家庭矛盾、开展子女教育中，也效果明显；管理角色要求的时间管理、任务分配、绩效辅导、培养员工等技能，在自我管理、家庭决策、子女教育中，同样增益匪浅。成为管理者，能加速人生的修炼，乃至成就更好的自己。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2024/01/10/[WIP]Nerf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/10/%5BWIP%5DNerf/" class="post-title-link" itemprop="url">Nerf</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-10 09:10:21" itemprop="dateCreated datePublished" datetime="2024-01-10T09:10:21+08:00">2024-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nerf/" itemprop="url" rel="index"><span itemprop="name">Nerf</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/01/10/%5BWIP%5DNerf/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/01/10/%5BWIP%5DNerf/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-三维重建流程"><a class="markdownIt-Anchor" href="#1-三维重建流程"></a> 1. 三维重建流程</h1>
<h2 id="11-运动恢复结构structure-from-motion-sfm"><a class="markdownIt-Anchor" href="#11-运动恢复结构structure-from-motion-sfm"></a> 1.1 运动恢复结构（Structure from Motion, SfM）</h2>
<ul>
<li>输入：
<ul>
<li>多视角图像</li>
<li>相机内参</li>
</ul>
</li>
<li>输出：
<ul>
<li>稀疏三维点云</li>
<li>相机外参（位姿）</li>
</ul>
</li>
<li>主要过程：
<ul>
<li>特征提取： 从图像中提取出能够用于匹配的特征点，如角点、边缘等。</li>
<li>特征匹配： 在图像序列中匹配相对应的特征点，以建立图像之间的对应关系。</li>
<li>相机定位： 利用特征匹配信息，估计相机在不同图像之间的运动，即相机的位姿。</li>
<li>三维重建： 基于相机的位姿估计和特征点的视差信息，计算出场景中物体的三维坐标。</li>
</ul>
</li>
</ul>
<h2 id="12-多立体视觉multi-view-stereo-mvs"><a class="markdownIt-Anchor" href="#12-多立体视觉multi-view-stereo-mvs"></a> 1.2 多立体视觉（Multi-View Stereo, MVS）</h2>
<ul>
<li>输入：
<ul>
<li>多视角图像</li>
<li>相机内外参</li>
<li>稀疏三维点云</li>
</ul>
</li>
<li>输出：
<ul>
<li>稠密三维点云</li>
</ul>
</li>
<li>主要过程：
<ul>
<li>图像对齐： 通过相机定位和特征匹配，将多个图像对齐，确保它们在同一坐标系下。</li>
<li>深度图生成： 对每个像素估计其在场景中的深度或距离。这可以通过多个视角的图像之间的视差信息来实现，视差越大表示物体离</li>
<li>机越近。</li>
<li>点云重建： 利用深度图，将每个像素映射到三维空间中，形成一个点云表示物体的表面。</li>
</ul>
</li>
</ul>
<h2 id="13-表面重建"><a class="markdownIt-Anchor" href="#13-表面重建"></a> 1.3 表面重建</h2>
<ul>
<li>输入：稠密三维点云</li>
<li>输出：场景/模型的三角网格（三角面片）</li>
<li>主要过程：
<ul>
<li>网格生成： 将点云转换为更为紧凑和结构化的表示，通常是三角网格。</li>
</ul>
</li>
<li>表面模型通常可导入可视化软件，也可进行物理仿真</li>
</ul>
<h2 id="14-纹理重建"><a class="markdownIt-Anchor" href="#14-纹理重建"></a> 1.4 纹理重建</h2>
<ul>
<li>输入：
<ul>
<li>多视角图像</li>
<li>相机内外参</li>
</ul>
</li>
<li>输出：
<ul>
<li>场景/模型的纹理图像</li>
</ul>
</li>
<li>主要过程：
<ul>
<li>纹理映射（Texture Mapping）： 将从图像中捕捉到的纹理信息映射到三维模型的表面上。这可以通过将图像中的颜色信息映射相应的三维模型表面上的顶点或像素来实现。这样，模型就能够呈现出与真实世界相似的外观。</li>
<li>相邻像素插值： 由于模型表面上的顶点或像素数量有限，需要进行插值操作，以在整个表面上创建平滑和连续的纹理。这通常涉及对相邻像素之间的颜色进行插值，以便在纹理映射的过程中产生平滑的过渡效果。</li>
<li>去除失真和伸缩： 在将图像纹理映射到三维模型时，可能会发生一些失真和伸缩。为了保持模型的准确性和真实性，需要进行一些校正步骤，以修复这些失真。</li>
</ul>
</li>
<li>纹理重建后即可可视化</li>
</ul>
<h1 id="2-神经辐射场neural-radiance-fields-nerf"><a class="markdownIt-Anchor" href="#2-神经辐射场neural-radiance-fields-nerf"></a> 2. 神经辐射场（Neural Radiance Fields, NeRF）</h1>
<ul>
<li>将三维重建流程存储在 <strong>三角面片和纹理信息</strong> 的三维信息用神经网络拟合（隐式建模）。</li>
<li>缺点是无法进行物理仿真。</li>
<li>优点：
<ul>
<li>ppl 简单</li>
<li>无空洞</li>
<li>高逼真</li>
</ul>
</li>
</ul>
<h1 id="wip"><a class="markdownIt-Anchor" href="#wip"></a> WIP</h1>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/09/07/A-Keypoint-based-Global-Association-Network-for-Lane-Detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/07/A-Keypoint-based-Global-Association-Network-for-Lane-Detection/" class="post-title-link" itemprop="url">A Keypoint-based Global Association Network for Lane Detection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-07 16:20:10" itemprop="dateCreated datePublished" datetime="2023-09-07T16:20:10+08:00">2023-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Autopilot/" itemprop="url" rel="index"><span itemprop="name">Autopilot</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/09/07/A-Keypoint-based-Global-Association-Network-for-Lane-Detection/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/07/A-Keypoint-based-Global-Association-Network-for-Lane-Detection/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2204.07335.pdf">https://arxiv.org/pdf/2204.07335.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/Wolfwjs/GANet">https://github.com/Wolfwjs/GANet</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>传统基于关键点检测的车道线检测网络通常需要根据任务的定义设计模型输出头结构，比如 <code>UFLD</code> 算法每条车道线需要占据一个输出 <code>channel</code> 。</li>
<li>本论文提出一种新颖的车道线检测范式，解耦了任务和网络，仅使用固定的输出通道数即可检测任意多条车道线。</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="总体思路"><a class="markdownIt-Anchor" href="#总体思路"></a> 总体思路</h3>
<p><img src="https://s2.loli.net/2023/09/07/rTU59Ca6tMz24QD.png" alt="ganet2.png" /></p>
<ul>
<li>如何实现只用一个 <code>channel</code> 输出即可检测任意多条车道线？一个可以想到的简单方法是：
<ol>
<li>输出一个 <code>channel = 1</code> 的 <code>heat map</code>，其中每个位置的 <code>heat map value</code> 依旧表示该位置是车道线关键点的概率。</li>
<li>使用阈值过滤得到所有车道线的关键点坐标（每条车道线关键点数量应 &gt;= 2）。</li>
<li>使用聚类的方式将一堆关键点分成若干组，每组关键点表示一条车道线。聚类中的 “距离” 判定逻辑需要根据一些先验知识进行设计（比如：因为车道线在图片中更接近竖直方向，因此水平距离权重小于垂直距离）。</li>
</ol>
</li>
<li>上述操作中的聚类过程包含了很多人为总结的先验知识，非常不 “机器学习”，于是我们可以改进这个过程：
<ol>
<li>输出一个 <code>channel = 1</code> 的 <code>heat map</code> 和一个 <code>channel = 2</code> 的 <code>offset map</code>，其中每个位置的 <code>heat map value</code> 依旧表示该位置是车道线关键点的概率，每个位置的 <code>offset map value</code> 表示 <strong>如果该点是关键点，那么该点相对于本条车道线起始点的偏移（x, y）</strong>，起始点表示一条车道线关键点中最靠近图片下方的点。</li>
<li>使用阈值过滤得到所有关键点，将关键点对应位置的偏移 <code>offset</code> 得到新的点 <code>p'</code>，理论上同一条车道线的每一个关键点偏移后得到的新位置 <code>p'</code> 都一致，都是车道线起始点。</li>
<li>因为神经网络不太能拟合到 <code>loss == 0</code>，因此还需要对所有的 <code>p'</code> 进行聚类，每个类表示一条车道线实例，本质相当于将聚类中的距离判定逻辑吸到神经网络内部。</li>
</ol>
</li>
<li>以上就是本论文提出的 <code>GANet</code> 算法的核心思想：用固定的有限个输出通道去预测任意条车道线。</li>
</ul>
<h3 id="网络结构"><a class="markdownIt-Anchor" href="#网络结构"></a> 网络结构</h3>
<p><img src="https://s2.loli.net/2023/09/07/nfbWKHOtFgjp6oz.png" alt="ganet1.png" /></p>
<h3 id="lfalane-aware-feature-aggregator"><a class="markdownIt-Anchor" href="#lfalane-aware-feature-aggregator"></a> LFA（Lane-aware Feature Aggregator）</h3>
<p><img src="https://s2.loli.net/2023/09/07/nk9NbMJztSWQRrq.png" alt="ganet3.png" /></p>
<h4 id="动机"><a class="markdownIt-Anchor" href="#动机"></a> 动机</h4>
<ul>
<li>传统的2D卷积在固定的网格状区域内采样特征，这不适用于处理车道线的狭长形状。</li>
<li>因此作者使用如下步骤改进各关键点上的局部特征：
<ol>
<li>预测该关键点同一条车道线紧邻的 <code>num_adjacent_keypoints</code> 个点的 <code>offset</code>，进行显式监督。</li>
<li>用预测的 <code>offset</code> 引导可变形卷积改进关键点局部特征。</li>
</ol>
</li>
</ul>
<h4 id="代码实现"><a class="markdownIt-Anchor" href="#代码实现"></a> 代码实现</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> torchvision.ops <span class="keyword">import</span> deform_conv2d</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LFA</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, out_channels, num_adjacent_keypoints=<span class="number">5</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(LFA, self).__init__()</span><br><span class="line">        self.offset_conv = nn.Conv2d(in_channels, <span class="number">2</span> * num_adjacent_keypoints, kernel_size=<span class="number">1</span>)</span><br><span class="line">        self.deform_conv_weight = nn.Parameter(torch.Tensor(out_channels, in_channels, <span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line">        nn.init.kaiming_uniform_(self.deform_conv_weight, a=math.sqrt(<span class="number">5</span>))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="comment"># x: input feature map with shape [batch_size, in_channels, height, width]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Step 1: Predict the offsets for adjacent keypoints</span></span><br><span class="line">        offsets = self.offset_conv(x)  <span class="comment"># shape: [batch_size, 2 * num_adjacent_keypoints, height, width]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Step 2: Perform deformable convolution to aggregate features</span></span><br><span class="line">        aggregated_features = deform_conv2d(x, offsets, self.deform_conv_weight, stride=<span class="number">1</span>, padding=<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> aggregated_features, offsets  <span class="comment"># Return both aggregated features and offsets</span></span><br><span class="line"><span class="comment"># Initialize LFA module</span></span><br><span class="line">lfa = LFA(in_channels=<span class="number">64</span>, out_channels=<span class="number">128</span>, num_adjacent_keypoints=<span class="number">5</span>)</span><br><span class="line"><span class="comment"># Dummy input feature map with shape [batch_size, in_channels, height, width]</span></span><br><span class="line">input_feature_map = torch.randn(<span class="number">16</span>, <span class="number">64</span>, <span class="number">128</span>, <span class="number">128</span>)</span><br><span class="line"><span class="comment"># Forward pass</span></span><br><span class="line">aggregated_features, predicted_offsets = lfa(input_feature_map)</span><br><span class="line"><span class="comment"># aggregated_features 是特征输出</span></span><br><span class="line"><span class="comment"># predicted_offsets 是预测的相邻的 num_adjacent_keypoints 个车道线的偏移量，显式监督</span></span><br></pre></td></tr></table></figure>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>提出了一种灵活的车道线检测范式，具有较好的可拓展性，目前在车道线榜单上比较靠前。</li>
<li>另外一个创新点是<code>LFA module</code>，主要是用到了可形变卷积，对于大多数动态性较差的端侧芯片来说，不容易部署。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/08/16/BEVFormer-Learning-Bird%E2%80%99s-Eye-View-Representation-from-Multi-Camera-Images-via-Spatiotemporal-Transformers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/16/BEVFormer-Learning-Bird%E2%80%99s-Eye-View-Representation-from-Multi-Camera-Images-via-Spatiotemporal-Transformers/" class="post-title-link" itemprop="url">BEVFormer: Learning Bird’s-Eye-View Representation from Multi-Camera Images via Spatiotemporal Transformers</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-16 12:02:58" itemprop="dateCreated datePublished" datetime="2023-08-16T12:02:58+08:00">2023-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BEV/" itemprop="url" rel="index"><span itemprop="name">BEV</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/08/16/BEVFormer-Learning-Bird%E2%80%99s-Eye-View-Representation-from-Multi-Camera-Images-via-Spatiotemporal-Transformers/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/08/16/BEVFormer-Learning-Bird%E2%80%99s-Eye-View-Representation-from-Multi-Camera-Images-via-Spatiotemporal-Transformers/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2203.17270.pdf">https://arxiv.org/pdf/2203.17270.pdf</a></li>
<li>chinese paper: <a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1dKnD6gUHhBXZ8gT733cIU_A7dHEEzNTP/view?pli=1">https://drive.google.com/file/d/1dKnD6gUHhBXZ8gT733cIU_A7dHEEzNTP/view?pli=1</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/fundamentalvision/BEVFormer">https://github.com/fundamentalvision/BEVFormer</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>传统 <code>BEV</code> 算法中 <code>View Transform</code> 都是通过 <code>LSS</code> 实现 <code>Image View</code> 到 <code>BEV View</code> 的转变，这种视角转换方法依赖于图像视角的深度估计（显式（例如 <code>BEVDepth</code>）或隐式（例如 <code>LSS / BEVDet</code> 等））。</li>
<li>本文提出一种新的通过时空注意力机制实现的 <code>View Transform</code> 方法，在 <code>Neuscenes</code> 数据集上取得了不错的 <code>3D</code> 目标检测成绩（略差于 <code>BEVDet4D</code>）。</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<p><img src="https://s2.loli.net/2024/10/09/wkgV4SOFjJtncAX.png" alt="bevformer.png" /></p>
<h3 id="整体架构"><a class="markdownIt-Anchor" href="#整体架构"></a> 整体架构</h3>
<h4 id="1-输入"><a class="markdownIt-Anchor" href="#1-输入"></a> 1. 输入</h4>
<ul>
<li>输入包含两部分，分别是：
<ul>
<li>环视图（<code>6</code> 张）</li>
<li><code>BEV Queries</code>（<code>shape = [num_voxel, dim]</code>）</li>
<li><code>History BEV Feature</code>（上一帧的 <code>BEV Feature</code> 输出，<code>shape = [num_voxel, dim]</code>）</li>
</ul>
</li>
</ul>
<h4 id="2-输出"><a class="markdownIt-Anchor" href="#2-输出"></a> 2. 输出</h4>
<ul>
<li>输出为当前帧的 <code>BEV Feature</code>（<code>shape = [num_voxel, dim]</code>），记作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">B_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>暂时不考虑任务头</li>
</ul>
<h4 id="3-网络模块"><a class="markdownIt-Anchor" href="#3-网络模块"></a> 3. 网络模块</h4>
<ol>
<li>图像特征提取
<ul>
<li><code>6</code> 张图片单独做 <code>CNN base</code> 特征提取，输出记作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">F_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li>时序信息融合：
<ul>
<li>将构造的 <code>BEV Queries</code>（记作 <code>Q</code>），和上一帧的 <code>BEV Feature</code>（记作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">B_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>）做 <code>Self-Attention</code></li>
<li>其中 <code>Q</code> 作为 <code>Query</code>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">B_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> 作为 <code>Key / value</code>，做 <code>Attention</code> 运算</li>
<li>虽然这里的 <code>Query / Key / Value</code> 并不同源，但依然被称为是 <code>Self-Attention</code> 而不是 <code>Cross-Attention</code>，是因为 <code>Q</code> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">B_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> 都属于 <code>BEV</code> 语义</li>
<li>输出记作 <code>Q'</code></li>
</ul>
</li>
<li>空间交叉注意力（<strong>视角转换</strong>）
<ul>
<li>此步骤是本文的重点，<code>BEVFormer</code> 通过这一步将透视图特征转换为俯视图特征</li>
<li>输入为:
<ul>
<li><code>Q'</code></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">F_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li>做 <code>Cross-Attention</code> 运算，其中：
<ul>
<li><code>Q'</code> 作为 <code>Queries</code></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">F_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 作为 <code>Key / Value</code></li>
</ul>
</li>
<li>用预设的无意义且可学习的 <code>BEV Queries</code> 去查询图片总体特征，得到 <code>BEV Feature</code> 输出，记作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">B_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li>任务相关头
<ul>
<li>输入为：<code>BEV Feature</code></li>
<li>输出为：<code>BEV</code> 视角下的检测 / 分割等任务预测结果</li>
<li>模型结构：可以是 <code>CNN base</code> 也可以是 <code>Transformer base</code> 的</li>
</ul>
</li>
</ol>
<ul>
<li>以上提到的所有 <code>Attention</code> 过程都需要额外添加 <code>Position embedding</code></li>
</ul>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>过程并不复杂，只要看过经典的 <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2005.12872"><code>DETR</code></a>，都熟悉这种套路：<strong>预设一个无意义的（随机初始化但可学习） <code>pattern</code> 序列作为 <code>Query</code> 去查询 <code>image features</code>，得到有意义的结果（或者说是可监督的结果）</strong></li>
<li>后续的部分工作对其改进是：<strong>将随机初始化预设的 <code>Query</code> 有意义化（例如通过一个轻量化 <code>2D</code> 检测头预检测，得到 <code>proposal</code> 并编码为 <code>Query</code>）</strong></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/08/06/BEVDepth-Acquisition-of-Reliable-Depth-for-Multi-view-3D-Object-Detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/06/BEVDepth-Acquisition-of-Reliable-Depth-for-Multi-view-3D-Object-Detection/" class="post-title-link" itemprop="url">BEVDepth: Acquisition of Reliable Depth for Multi-view 3D Object Detection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-06 20:43:24" itemprop="dateCreated datePublished" datetime="2023-08-06T20:43:24+08:00">2023-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BEV/" itemprop="url" rel="index"><span itemprop="name">BEV</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/08/06/BEVDepth-Acquisition-of-Reliable-Depth-for-Multi-view-3D-Object-Detection/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/08/06/BEVDepth-Acquisition-of-Reliable-Depth-for-Multi-view-3D-Object-Detection/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2206.10092.pdf">https://arxiv.org/pdf/2206.10092.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/Megvii-BaseDetection/BEVDepth">https://github.com/Megvii-BaseDetection/BEVDepth</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>本文提出一种 <code>BEV</code> 视角下的的 <code>3D</code> 目标检测算法，作者认为尽管深度对相机 <code>3D</code> 检测至关重要，但最近的方法中的深度估计却出奇地不足。</li>
<li><code>BEVDepth</code> 通过利用显式深度监督（来自 <code>lidar</code> 点云）来解决这个问题。</li>
<li>同时使用关键帧和过渡帧在 <code>bev feature</code> 维度进行特征融合，引入时序信息，提高模型效果。</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<p><img src="https://s2.loli.net/2023/08/14/hiLsqmKyRrbajHe.png" alt="bevdepth1.png" /></p>
<ul>
<li>与 <code>BEVDet4D</code> 的 <code>pipeline</code> 很相似，区别是 <code>BEVDepth</code> 使用了 <code>DepthNet</code> 用激光雷达点云数据做了深度监督。</li>
<li><code>DepthNet</code> 深度监督的输入是 <code>6v</code> 图像特征和每个相机的内外参，输出为 <strong>相机相关深度估计（camera_awareness_depth_estimation）</strong><br />
<img src="https://s2.loli.net/2023/08/14/fDwVr9PMLEb1z3Q.png" alt="bevdepth2.png" /></li>
</ul>
<blockquote>
<p>显式监督效果和 baseline 对比还是很赞的！<br />
<img src="https://s2.loli.net/2023/08/15/G9fWVKmtTeawzYQ.png" alt="table.png" /><br />
<code>MAP</code> 和 <code>NDS</code> 吊打了一众基于纯视觉的算法</p>
</blockquote>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>多帧训练中过渡帧使用了 <code>nuScenes</code> 数据集的 <code>Sweep</code> 数据（没有人工标注的原始数据，只包含图像和 lidar 点云），无形中拓展了数据量。</li>
<li>本文创新点不多，基本是 <code>BEVDet4D + DepthNet</code>，更像是一个工程优化，比如：用 <code>cuda</code> 写了 <code>voxel pooling</code> 过程，计算过程非常高效。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/08/06/BEVDet4D-Exploit-Temporal-Cues-in-Multi-camera-3D-Object-Detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/06/BEVDet4D-Exploit-Temporal-Cues-in-Multi-camera-3D-Object-Detection/" class="post-title-link" itemprop="url">BEVDet4D: Exploit Temporal Cues in Multi-camera 3D Object Detection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-06 15:00:34" itemprop="dateCreated datePublished" datetime="2023-08-06T15:00:34+08:00">2023-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BEV/" itemprop="url" rel="index"><span itemprop="name">BEV</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/08/06/BEVDet4D-Exploit-Temporal-Cues-in-Multi-camera-3D-Object-Detection/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/08/06/BEVDet4D-Exploit-Temporal-Cues-in-Multi-camera-3D-Object-Detection/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2203.17054.pdf">https://arxiv.org/pdf/2203.17054.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/HuangJunJie2017/BEVDet">https://github.com/HuangJunJie2017/BEVDet</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li><code>BEVDet4D</code> 是基于 <code>BEVDet</code> 加入了时序信息的一篇论文</li>
<li>具体来说就是将上一帧的 <code>BEV Feature</code> 和本帧的 <code>BEV Feature</code> 对齐后 <code>Concat</code> 到一起送入 <code>BEV Encoder</code> 中进行 <code>BEV</code> 视角下的 <code>3D</code> 目标检测</li>
<li><code>BEVDet</code> 论文中的 <code>image encoder + view transformer</code> 完全保持不变</li>
<li>由于有两帧的信息，所以对速度的预测相较于单帧有较大提升</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="整体流程"><a class="markdownIt-Anchor" href="#整体流程"></a> 整体流程</h3>
<p><img src="https://s2.loli.net/2023/08/06/XwCSmtKiFWJEzQk.png" alt="bevdet4d.png" /><br />
在 <code>BEV Feature</code> 层面（<code>View Transformer</code> 的输出）融合两帧信息</p>
<h3 id="算法的伪代码表示"><a class="markdownIt-Anchor" href="#算法的伪代码表示"></a> 算法的伪代码表示</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BEVDet4D</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 初始化相关的编码器、转换器和其他必要的组件</span></span><br><span class="line">        self.image_view_encoder = ImageViewEncoder()</span><br><span class="line">        self.view_transformer = ViewTransformer()</span><br><span class="line">        self.bev_encoder = BEVEncoder()</span><br><span class="line">        self.head = DetectionHead()</span><br><span class="line">        self.previous_bev_feature = <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spatial_alignment</span>(<span class="params">self, feature</span>):</span></span><br><span class="line">        <span class="comment"># 这里执行空间对齐操作，具体细节可能需要根据原始论文进行补充</span></span><br><span class="line">        <span class="comment"># 实际代码中这里似乎没有开，即上一帧的 BEV feature 直接和本帧 BEV feature map concat</span></span><br><span class="line">        aligned_feature = ... </span><br><span class="line">        <span class="keyword">return</span> aligned_feature</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, current_image</span>):</span></span><br><span class="line">        <span class="comment"># 使用图像视图编码器和视图转换器处理当前图像</span></span><br><span class="line">        image_feature = self.image_view_encoder(current_image)</span><br><span class="line">        transformed_feature = self.view_transformer(image_feature)</span><br><span class="line">        <span class="comment"># 使用BEV编码器获取当前帧的BEV特征</span></span><br><span class="line">        current_bev_feature = self.bev_encoder(transformed_feature)</span><br><span class="line">        <span class="comment"># 如果存在前一帧的BEV特征，则进行空间对齐和融合</span></span><br><span class="line">        <span class="keyword">if</span> self.previous_bev_feature:</span><br><span class="line">            aligned_previous_feature = self.spatial_alignment(self.previous_bev_feature)</span><br><span class="line">            fused_feature = concatenate(aligned_previous_feature, current_bev_feature)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fused_feature = current_bev_feature</span><br><span class="line">        <span class="comment"># 使用检测头部进行3D物体检测</span></span><br><span class="line">        detections = self.head(fused_feature)</span><br><span class="line">        <span class="comment"># 保存当前帧的BEV特征以供下一帧使用</span></span><br><span class="line">        self.previous_bev_feature = current_bev_feature</span><br><span class="line">        <span class="keyword">return</span> detections</span><br><span class="line"><span class="comment"># 实例化BEVDet4D并进行前向传递</span></span><br><span class="line">bevdet4d = BEVDet4D()</span><br><span class="line">detections = bevdet4d.forward(current_image)</span><br></pre></td></tr></table></figure>
<h3 id="result"><a class="markdownIt-Anchor" href="#result"></a> result</h3>
<p><img src="https://s2.loli.net/2023/08/06/TgX7qpHDZUjsEGn.png" alt="BEVdet4D2.png" /></p>
<blockquote>
<p>效果比 <code>BEVDet</code> 好了不少，尤其是 <code>mAVE</code> (速度误差)</p>
</blockquote>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>没有很大的创新点，更像是 <code>BEVDet</code> 的一个使用 <code>trick</code></li>
<li><code>BEVDet</code> 的计算量主要分布在 <code>image encoder</code> 和 <code>view transformer</code>，所以复用上一帧的 <code>BEV feature</code> 即充分利用了上一帧的计算量，对当前帧引入的额外计算量也比较可控（<code>BEV encoder</code> 和 <code>task head</code> 都比较轻量）</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/08/06/BEVDet-High-Performance-Multi-Camera-3D-Object-Detection-in-Bird-Eye-View/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/06/BEVDet-High-Performance-Multi-Camera-3D-Object-Detection-in-Bird-Eye-View/" class="post-title-link" itemprop="url">BEVDet: High-Performance Multi-Camera 3D Object Detection in Bird-Eye-View</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-06 09:57:25" itemprop="dateCreated datePublished" datetime="2023-08-06T09:57:25+08:00">2023-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BEV/" itemprop="url" rel="index"><span itemprop="name">BEV</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/08/06/BEVDet-High-Performance-Multi-Camera-3D-Object-Detection-in-Bird-Eye-View/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/08/06/BEVDet-High-Performance-Multi-Camera-3D-Object-Detection-in-Bird-Eye-View/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2112.11790.pdf">https://arxiv.org/pdf/2112.11790.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/HuangJunJie2017/BEVDet">https://github.com/HuangJunJie2017/BEVDet</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>本文介绍了一种 <code>BEV</code> 视角下的 <code>3D</code> 障碍物检测算法，该算法的输入是由多张（6张）图片组成的车身环视视角，输出为车身周围障碍物的 <code>3D bbox</code></li>
<li>与 <code>LSS（lift-splat-shoot）</code> 算法较为相似，但任务不同，<code>LSS</code> 想要解决的是 <code>BEV</code> 视角下的分割问题，<code>BEVDet</code> 想要解决的是 <code>3D</code> 障碍物检测问题</li>
<li>与 <code>FCOS3D</code> 等单目 <code>3D</code> 障碍物检测的任务类型相似，区别在于：单目 <code>3D</code> 障碍物检测对每个视角做 <code>3D</code> 障碍物检测后，需要使用后处理融合跨视角的物体，<code>BEVDet</code> 可以将跨视角融合问题内嵌到模型中（<code>BEV</code>）</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="总体结构"><a class="markdownIt-Anchor" href="#总体结构"></a> 总体结构</h3>
<p><img src="https://s2.loli.net/2023/08/06/pEmYIytkViZeRrv.png" alt="BevDet.png" /><br />
由上图可以看出，模型主要由四个部分组成，分别是：</p>
<ul>
<li><strong><code>Image-view Encoder</code></strong>：图像特征提取（<code>backbone + neck</code>），6个视角分别做特征提取，不做视角间特征融合</li>
<li><strong><code>View Transformer</code></strong>：视角变换（同时也实现了图像间信息融合），从图像视角转换为 <code>BEV</code> 视角，使用的方法和 <code>LSS</code> 方法一样，输出为 <code>BEV feature</code></li>
<li><strong><code>BEV Encoder</code></strong>：对 <code>BEV feature</code> 用一个较小的 <code>BEV backbone</code> 做特征提取</li>
<li><strong><code>Head</code></strong>：任务头，预测 <code>3D bbox</code> 等，本文使用了 <code>CenterPoint Head</code></li>
</ul>
<h3 id="算法流程的伪代码表示"><a class="markdownIt-Anchor" href="#算法流程的伪代码表示"></a> 算法流程的伪代码表示</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义输入，shape: (8, 6, 256, 704, 3) [batch, camera, H, W, C]</span></span><br><span class="line">input_images = get_input_images()</span><br><span class="line"><span class="comment"># 图像视图编码器，输出shape: (8, 6, 16, 44, 256) [batch, camera, H//16, W//16, C]</span></span><br><span class="line">image_view_features = image_view_encoder(input_images)</span><br><span class="line"><span class="comment"># 视图变换器，输出shape: (8, 64, 128, 128) [batch, C, Bev_H, Bev_W]</span></span><br><span class="line">transformed_features = view_transformer(image_view_features)</span><br><span class="line"><span class="comment"># BEV编码器，输出shape: (8, 256, 64, 64) [batch, C, Bev_H//2, Bev_W//2]</span></span><br><span class="line">encoded_bev_features = bev_encoder(transformed_features)</span><br><span class="line"><span class="comment"># 任务特定头部进行3D物体检测，输出shape: (8, num_objects, object_info)</span></span><br><span class="line">detection_results = task_specific_head(encoded_bev_features)</span><br><span class="line"><span class="comment"># 返回3D物体检测结果</span></span><br><span class="line"><span class="keyword">return</span> detection_results</span><br></pre></td></tr></table></figure>
<h3 id="数据增广方法"><a class="markdownIt-Anchor" href="#数据增广方法"></a> 数据增广方法</h3>
<ul>
<li><strong>独立图片空间数据增广</strong>：图片的翻转、裁剪和旋转可以用 <code>3x3</code> 矩阵表示，在 <code>View Transformer</code> 的时候需要做对应逆变换，即 <em>同时更改图片和 View Transformer 过程</em></li>
<li><strong>BEV视角下的数据增广</strong>：在BEV空间的学习中，数据量少于图像视图空间，因为每个样本包含多个摄像机图像，所以更容易过拟合；该增广方法遵循常见的 <code>LiDAR</code> 方法，采用了 <code>2D</code> 空间中的常见数据增广操作，如翻转、缩放和旋转，需要对应修改目标 <code>3D bbox</code>，即 <em>同时更改 BEV Feature 和 3D bbox GT</em></li>
</ul>
<h3 id="scale-nms"><a class="markdownIt-Anchor" href="#scale-nms"></a> <code>Scale-NMS</code></h3>
<ul>
<li>由于 <code>BEV</code> 空间中不同类别的空间分布与图像视图空间中的分布非常不同，所以作者提出了 <code>Scale-NMS</code>，在执行经典的 <code>NMS</code> 算法之前根据每个对象的类别来缩放每个对象的大小，可显著提高了对小面积类别（如行人和交通锥）的预测性能</li>
</ul>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>从模型结构和数据增广方式看 <code>BEVDet</code> 本质是一个二阶段算法：
<ul>
<li><code>image Encode + View Transformer</code>：环视图像编码到 <code>BEV</code> 空间</li>
<li><code>BEV Encoder + Task Head</code>：<code>BEV</code> 空间下的 <code>3D</code> 障碍物检测</li>
</ul>
</li>
<li>但第一阶段输出的 <code>BEV Feature</code> 没有用 <code>LiDAR</code> 点云监督就有点怪…（后续的改进算法加了）</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/07/29/MOTR-End-to-End-Multiple-Object-Tracking-with-Transformer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/29/MOTR-End-to-End-Multiple-Object-Tracking-with-Transformer/" class="post-title-link" itemprop="url">MOTR: End-to-End Multiple-Object Tracking with Transformer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-29 19:12:12" itemprop="dateCreated datePublished" datetime="2023-07-29T19:12:12+08:00">2023-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Transformer/" itemprop="url" rel="index"><span itemprop="name">Transformer</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/07/29/MOTR-End-to-End-Multiple-Object-Tracking-with-Transformer/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/07/29/MOTR-End-to-End-Multiple-Object-Tracking-with-Transformer/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2105.03247.pdf">https://arxiv.org/pdf/2105.03247.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/megvii-research/MOTR">https://github.com/megvii-research/MOTR</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>提出了一个完全端到端的多目标跟踪框架</li>
<li>将多目标跟踪问题形式化为一组序列预测问题</li>
<li>引入了跟踪感知的标签分配</li>
<li>提出了用于时间建模的集体平均损失和时间聚合网络方法</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="motr-整体流程"><a class="markdownIt-Anchor" href="#motr-整体流程"></a> MOTR 整体流程</h3>
<p><img src="https://s2.loli.net/2023/07/29/d6goYqmnSGXVOW8.png" alt="MOTR.png" /></p>
<ol>
<li><strong>特征提取</strong>：用 <code>CNN backbone</code> 提取连续帧中每一帧的特征（上图中的 <code>Enc</code>）</li>
<li><strong>查询生成</strong>：用 <code>Deformable Transformer</code> 对第一步提取的特征进行查询（上图中的 <code>Dec</code>）
<ul>
<li>对于视频第一帧，只解码 <code>object detection query</code> （上图中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ）得到 <code>hidden state</code></li>
<li>对于非第一帧，将 <code>object detection query</code> （上图中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ）和上一帧的 <code>tracking query</code> （上图中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mi>t</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">q_{tr}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ）先 <code>concat</code> 再进行解码得到 <code>hidden state</code></li>
</ul>
</li>
<li><strong>预测结果生成</strong>：用一个简单的结构将上一步得到的 <code>hidden state</code> 映射到任务空间，预测结果包含 <code>object detection results</code> 和 <code>tracking results</code></li>
<li><strong>得到下一帧的 tracking query</strong>：用 <code>QIM (Query Interaction Module, 查询交互模块)</code> 将上一步得到的预测结果映射为下一帧的 <code>tracking query</code></li>
<li><strong>计算损失 / 输出预测结果</strong>：对于训练，计算集体平均损失（<code>CAL, Collective Average Loss</code>）;对于预测，直接输出第 3 步得到的结果</li>
</ol>
<ul>
<li>描述 <code>MOTR</code> 过程的伪代码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_frame</span>(<span class="params">frame, detect_queries, track_queries=<span class="literal">None</span>, ground_truths=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="comment"># 使用CNN提取帧特征</span></span><br><span class="line">    <span class="comment"># frame shape: (height, width, channels)</span></span><br><span class="line">    frame_features = extract_frame_features(frame)  <span class="comment"># Shape: (height, width, channels)</span></span><br><span class="line">    <span class="keyword">if</span> track_queries <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># 使用Deformable DETR解码器生成隐藏状态</span></span><br><span class="line">        <span class="comment"># detect_queries shape: (num_queries, query_dim)</span></span><br><span class="line">        <span class="comment"># frame_features shape: (height, width, channels)</span></span><br><span class="line">        hidden_states = deformable_detr_decoder(detect_queries, frame_features)  <span class="comment"># Shape: (num_queries, hidden_dim)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        queries = concatenate(track_queries, detect_queries)  <span class="comment"># Shape: (num_queries + num_tracks, query_dim)</span></span><br><span class="line">        hidden_states = deformable_detr_decoder(queries, frame_features)  <span class="comment"># Shape: (num_queries + num_tracks, hidden_dim)</span></span><br><span class="line">    <span class="comment"># 生成预测</span></span><br><span class="line">    <span class="comment"># hidden_states shape: (num_queries, hidden_dim)</span></span><br><span class="line">    predictions = predict(hidden_states)  <span class="comment"># Shape: (num_queries + num_tracks, num_classes + 4)</span></span><br><span class="line">    <span class="comment"># 使用Query Interaction Module (QIM)生成下一帧的跟踪查询</span></span><br><span class="line">    <span class="comment"># hidden_states shape: (num_queries, hidden_dim)</span></span><br><span class="line">    track_queries = qim(hidden_states)  <span class="comment"># Shape: (num_tracks, query_dim)</span></span><br><span class="line">    <span class="keyword">if</span> ground_truths <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># 使用Collective Average Loss (CAL)进行训练</span></span><br><span class="line">        <span class="comment"># predictions shape: (num_queries, num_classes + 4)</span></span><br><span class="line">        <span class="comment"># ground_truths shape: (num_objects, num_classes + 4)</span></span><br><span class="line">        loss = cal(predictions, ground_truths)</span><br><span class="line">        backpropagate(loss)</span><br><span class="line">    <span class="keyword">return</span> predictions, track_queries  <span class="comment"># Shape: (num_queries + num_tracks, num_classes + 4), (num_tracks, query_dim)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_video</span>(<span class="params">video, ground_truths=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="comment"># 初始化检测查询</span></span><br><span class="line">    <span class="comment"># 返回形状：(num_queries, query_dim)</span></span><br><span class="line">    detect_queries = initialize_detect_queries()  </span><br><span class="line">    track_queries = <span class="literal">None</span>  <span class="comment"># Shape: (num_tracks, query_dim)</span></span><br><span class="line">    <span class="keyword">for</span> frame <span class="keyword">in</span> video:</span><br><span class="line">        predictions, track_queries = process_frame(frame, detect_queries, track_queries, ground_truths)</span><br><span class="line">        <span class="keyword">if</span> ground_truths <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">yield</span> predictions</span><br></pre></td></tr></table></figure>
<h3 id="查询交互模块"><a class="markdownIt-Anchor" href="#查询交互模块"></a> 查询交互模块</h3>
<ul>
<li>查询交互模块 <code>Query Interaction Module (QIM)</code> 是 <code>MOTR</code> 中的一个关键组件，它负责处理物体的进入和退出，以及增强长期的时间关系建模</li>
<li><code>QIM</code> 的输入是当前帧预测的 <code>detection result</code> 和 <code>tracking result</code>，输出是下一帧的 <code>tacking query</code></li>
<li>通俗来说，<code>QIM</code> 是根据当前帧预测的结果，给出下一帧的 “提问”</li>
<li><code>QIM</code> 过程的伪代码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_interaction_module</span>(<span class="params">hidden_states, scores, tau_en, tau_ex, M</span>):</span></span><br><span class="line">    <span class="comment"># hidden_states shape: (num_queries, hidden_dim)</span></span><br><span class="line">    <span class="comment"># scores shape: (num_queries, num_classes)</span></span><br><span class="line">    <span class="comment"># tau_en, tau_ex: entrance and exit thresholds</span></span><br><span class="line">    <span class="comment"># M: number of consecutive frames for exit threshold</span></span><br><span class="line">    <span class="comment"># Object Entrance</span></span><br><span class="line">    entrance_mask = scores.<span class="built_in">max</span>(dim=<span class="number">1</span>) &gt; tau_en  <span class="comment"># Shape: (num_queries,)</span></span><br><span class="line">    hidden_states = hidden_states[entrance_mask]  <span class="comment"># Shape: (num_entrance_queries, hidden_dim)</span></span><br><span class="line">    <span class="comment"># Temporal Aggregation Network (TAN)，主要目的是融合时序信息，本文是用了一个 Multi-Head Self-Attention 实现</span></span><br><span class="line">    hidden_states = temporal_aggregation_network(hidden_states)  <span class="comment"># Shape: (num_entrance_queries, hidden_dim)</span></span><br><span class="line">    <span class="comment"># Object Exit</span></span><br><span class="line">    exit_mask = scores.<span class="built_in">max</span>(dim=<span class="number">1</span>) &lt; tau_ex  <span class="comment"># Shape: (num_entrance_queries,)</span></span><br><span class="line">    exit_mask = exit_mask.rolling(window=M).<span class="built_in">sum</span>() &gt; <span class="number">0</span>  <span class="comment"># Shape: (num_entrance_queries,)</span></span><br><span class="line">    hidden_states = hidden_states[~exit_mask]  <span class="comment"># Shape: (num_track_queries, hidden_dim)</span></span><br><span class="line">    <span class="keyword">return</span> hidden_states  <span class="comment"># Shape: (num_track_queries, hidden_dim)</span></span><br></pre></td></tr></table></figure>
<h3 id="集体平均损失"><a class="markdownIt-Anchor" href="#集体平均损失"></a> 集体平均损失</h3>
<ul>
<li>集体平均损失（Collective Average Loss，CAL）是 <code>MOTR</code> 算法中用于训练的损失函数。不同于传统的逐帧计算损失，<code>CAL</code> 收集整个视频剪辑的所有预测，然后基于整个视频剪辑计算总体损失</li>
<li>集体平均损失的代码描述</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">collective_average_loss</span>(<span class="params">predictions, ground_truths, matching_results</span>):</span></span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line">    total_objects = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(predictions)):</span><br><span class="line">        pred_tracked = predictions[i][<span class="string">&#x27;tracked&#x27;</span>]</span><br><span class="line">        pred_detected = predictions[i][<span class="string">&#x27;detected&#x27;</span>]</span><br><span class="line">        gt_tracked = ground_truths[i][<span class="string">&#x27;tracked&#x27;</span>]</span><br><span class="line">        gt_detected = ground_truths[i][<span class="string">&#x27;detected&#x27;</span>]</span><br><span class="line">        match_tracked = matching_results[i][<span class="string">&#x27;tracked&#x27;</span>]</span><br><span class="line">        match_detected = matching_results[i][<span class="string">&#x27;detected&#x27;</span>]</span><br><span class="line">        total_loss += single_frame_loss(pred_tracked, match_tracked, gt_tracked)</span><br><span class="line">        total_loss += single_frame_loss(pred_detected, match_detected, gt_detected)</span><br><span class="line">        total_objects += <span class="built_in">len</span>(gt_tracked) + <span class="built_in">len</span>(gt_detected)</span><br><span class="line">    <span class="keyword">return</span> total_loss / total_objects</span><br></pre></td></tr></table></figure>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>以一种非常优雅的方式解决了端到端多目标追踪的任务，打破了之前 <code>NN detection + Hard logic code tracking</code> 的 <code>tracking</code> 范式</li>
<li>这种非黑盒的（显式监督 <code>detecion bbox</code>）复杂任务端到端训练，启发了后续的许多更复杂的端到端任务，例如 <code>UniAD</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/07/29/Deformable-DETR-Deformable-Transformers-for-End-to-end-Object-Detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/29/Deformable-DETR-Deformable-Transformers-for-End-to-end-Object-Detection/" class="post-title-link" itemprop="url">Deformable DETR: Deformable Transformers for End-to-end Object Detection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-29 10:47:54" itemprop="dateCreated datePublished" datetime="2023-07-29T10:47:54+08:00">2023-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Transformer/" itemprop="url" rel="index"><span itemprop="name">Transformer</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/07/29/Deformable-DETR-Deformable-Transformers-for-End-to-end-Object-Detection/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/07/29/Deformable-DETR-Deformable-Transformers-for-End-to-end-Object-Detection/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> URL</h2>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2010.04159.pdf">https://arxiv.org/pdf/2010.04159.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/fundamentalvision/Deformable-DETR">https://github.com/fundamentalvision/Deformable-DETR</a></li>
</ul>
<h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li><strong>提出了 <code>Deformable DETR</code></strong>：这是一种新的目标检测模型，解决了现有 <code>DETR</code> 模型的收敛速度慢和特征空间分辨率有限的问题。</li>
<li><strong>使用可变形的注意力模块</strong>：这些模块只关注参考点周围的一小部分关键采样点，从而在更少的训练周期内提高了性能，尤其是对小对象的检测。</li>
<li><strong>结合了可变形卷积的稀疏空间采样和 <code>Transformer</code> 的关系建模能力</strong>：这使得模型能够在处理大规模数据时保持高效，同时还能捕捉到复杂的上下文关系。</li>
<li><strong>引入了一种两阶段的变体</strong>：在这个变体中，区域提议由 <code>Deformable DETR</code> 生成，然后进行迭代的细化。这使得模型能够更精确地定位和识别目标。</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<p><img src="https://s2.loli.net/2023/07/29/zLITUxlAaR7QNJ2.png" alt="deformable_detr.png" /></p>
<blockquote>
<p><code>Deformable DETR</code> 整体结构图</p>
</blockquote>
<h3 id="deformabel-attention-block"><a class="markdownIt-Anchor" href="#deformabel-attention-block"></a> Deformabel Attention Block</h3>
<p><img src="https://s2.loli.net/2023/07/29/9rHe4CBKV1iEAOj.png" alt="deformable_attention.png" /></p>
<ul>
<li><code>Multi-Head Attention</code>:<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mi>H</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>z</mi><mi>q</mi></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></msubsup><msub><mi>W</mi><mi>m</mi></msub><mo stretchy="false">[</mo><msub><mo>∑</mo><mrow><mi>k</mi><mo>∈</mo><msub><mi mathvariant="normal">Ω</mi><mi>k</mi></msub></mrow></msub><msub><mi>A</mi><mrow><mi>m</mi><mi>q</mi><mi>k</mi></mrow></msub><mo>⋅</mo><msubsup><mi>W</mi><mi>m</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><msub><mi>x</mi><mi>k</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">MultiHeadAtten(z_q, x) = \sum_{m=1}^MW_m[\sum_{k\in\Omega_k}A_{mqk}\cdot W_m&#x27;x_k]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">A</span><span class="mord mathnormal">t</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.386801em;vertical-align:-0.40557em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.18639799999999984em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight">Ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.40557em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>
<ul>
<li>
<p>输入为一个 <code>query</code> 的表征 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>q</mi></msub></mrow><annotation encoding="application/x-tex">z_q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ，以及总特征 <code>x</code>，输出为 <code>query</code> 查询结果向量</p>
</li>
<li>
<p><code>M</code> 表示 <code>number of head</code></p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>q</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">A_{mqk}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><mi>d</mi></msqrt></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">softmax(\frac{QK^T}{\sqrt{d}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.627473em;vertical-align:-0.538em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.089473em;"><span style="top:-2.5335085em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.937845em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mathnormal mtight">d</span></span></span><span style="top:-2.8978450000000002em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.102155em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9190928571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>W</mi><mi>m</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">W_m&#x27;x_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 实际上就是 <code>self-attention</code> 中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></p>
</li>
</ul>
</li>
<li><code>Deformable Attention</code>:<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>z</mi><mi>q</mi></msub><mo separator="true">,</mo><msub><mi>p</mi><mi>q</mi></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></msubsup><msub><mi>W</mi><mi>m</mi></msub><mo stretchy="false">[</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msub><mi>A</mi><mrow><mi>m</mi><mi>q</mi><mi>k</mi></mrow></msub><mo>⋅</mo><msubsup><mi>W</mi><mi>m</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mi>x</mi><mo stretchy="false">(</mo><msub><mi>p</mi><mi>q</mi></msub><mo>+</mo><mi mathvariant="normal">Δ</mi><msub><mi>p</mi><mrow><mi>m</mi><mi>q</mi><mi>k</mi></mrow></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">DeformableAtten(z_q,p_q,x) = \sum_{m=1}^MW_m[\sum_{k=1}^KA_{mqk}\cdot W_m&#x27;x(p_q + \Delta p_{mqk})]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">A</span><span class="mord mathnormal">t</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2809409999999999em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span></span></span></span>
<ul>
<li>输入为一个 <code>query</code> 的表征 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>q</mi></msub></mrow><annotation encoding="application/x-tex">z_q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ，总特征 <code>x</code>，以及 <code>query</code> 对应的 <strong>预设采样位置</strong>，输出为 <code>query</code> 查询结果向量</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>p</mi><mrow><mi>m</mi><mi>q</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta p_{mqk}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 表示由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>q</mi></msub></mrow><annotation encoding="application/x-tex">z_q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 计算得到的 <strong>基于预设查询位置的横纵偏移</strong></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>q</mi><mi>k</mi></mrow></msub><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>z</mi><mi>q</mi></msub><msub><mi>W</mi><mi>a</mi></msub><mo stretchy="false">)</mo><mtext>  </mtext><mo separator="true">,</mo><msub><mi>W</mi><mi>a</mi></msub><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>d</mi><mi>i</mi><mi>m</mi><mo>×</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>s</mi></mrow></msup><mtext>  </mtext><mo separator="true">,</mo><msub><mi>z</mi><mi>q</mi></msub><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>d</mi><mi>i</mi><mi>m</mi></mrow></msup></mrow><annotation encoding="application/x-tex">A_{mqk} = softmax(z_qW_a)\ \ ,W_a\in\mathbb{R}^{dim\times num\_points}\ \ ,z_q\in\mathbb{R}^{dim}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"> </span><span class="mspace"> </span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.135216em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">m</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mspace"> </span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span></span></span></span> ，即 <strong><code>point position attention</code> 是由 <code>query</code> 线性映射得到的</strong> ，因此 <strong><code>Deformable Attention</code> 没有 <code>Key</code> 的存在，只有 <code>Query</code> 和 <code>Value</code></strong></li>
<li><code>K</code> 表示 <code>number of points</code>，即采样点个数</li>
</ul>
</li>
<li><code>Multi-Scale Deformable Attention</code>：<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>S</mi><mi>D</mi><mi>e</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>z</mi><mi>q</mi></msub><mo separator="true">,</mo><msub><mover accent="true"><mi>p</mi><mo>^</mo></mover><mi>q</mi></msub><mo separator="true">,</mo><mo stretchy="false">{</mo><mi>x</mi><msubsup><mo stretchy="false">}</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></msubsup><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></msubsup><msub><mi>W</mi><mi>m</mi></msub><mo stretchy="false">[</mo><msubsup><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msub><mi>A</mi><mrow><mi>m</mi><mi>l</mi><mi>q</mi><mi>k</mi></mrow></msub><mo>⋅</mo><msubsup><mi>W</mi><mi>m</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><msup><mi>x</mi><mi>l</mi></msup><mo stretchy="false">(</mo><msub><mi>ϕ</mi><mi>l</mi></msub><mo stretchy="false">(</mo><msub><mover accent="true"><mi>p</mi><mo>^</mo></mover><mi>q</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mi mathvariant="normal">Δ</mi><msub><mi>p</mi><mrow><mi>m</mi><mi>l</mi><mi>q</mi><mi>k</mi></mrow></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">MSDeformableAtten(z_q,\hat{p}_q,\{x\}_{l=1}^L) = \sum_{m=1}^MW_m[\sum_{l=1}^L\sum_{k=1}^KA_{mlqk}\cdot W_m&#x27;x^l(\phi_l(\hat{p}_q) + \Delta p_{mlqk})]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1274389999999999em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">A</span><span class="mord mathnormal">t</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">{</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2809409999999999em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.135216em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">ϕ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span></span></span></span>
<ul>
<li>与 <code>Deformable Attention</code> 不同的是，输入的 <code>x</code> 变成了多尺度特征（例如 <code>backbone</code> 不同深度的特征），更贴近实际视觉工程化应用场景</li>
<li><code>point</code> 采样范围是所有 <code>level</code> 的 <code>feature map</code>，即 <code>MSDefromableAttention</code> 有全局 <code>attention</code> 信息</li>
</ul>
</li>
<li><code>Deformable Attention</code> 和 <code>Self Attention</code> 对比</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attention</span>(<span class="params">query, key, value</span>):</span></span><br><span class="line">    <span class="comment"># query, key, value shapes: (batch_size, sequence_length, embedding_dim)</span></span><br><span class="line">    scores = torch.matmul(query, key.transpose(-<span class="number">2</span>, -<span class="number">1</span>)) / math.sqrt(query.size(-<span class="number">1</span>))</span><br><span class="line">    <span class="comment"># scores shape: (batch_size, sequence_length, sequence_length)</span></span><br><span class="line">    probs = F.softmax(scores, dim=-<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># probs shape: (batch_size, sequence_length, sequence_length)</span></span><br><span class="line">    output = torch.matmul(probs, value)</span><br><span class="line">    <span class="comment"># output shape: (batch_size, sequence_length, embedding_dim)</span></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deformable_attention</span>(<span class="params">query, value, reference_points, num_sampling_points, atten_linear, offset_linear</span>):</span></span><br><span class="line">    <span class="comment"># query shape: (batch_size, sequence_length, embedding_dim)</span></span><br><span class="line">    <span class="comment"># value shape: (batch_size, sequence_length, embedding_dim)</span></span><br><span class="line">    <span class="comment"># reference_points shape: (batch_size, sequence_length, 2)</span></span><br><span class="line">    <span class="comment"># num_sampling_points: integer, number of points to sample around each reference point</span></span><br><span class="line">    </span><br><span class="line">    batch_size, seq_len, embed_dim = query.size()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Calculate offsets</span></span><br><span class="line">    <span class="comment"># offset_linear is a linear layer that predicts the offsets</span></span><br><span class="line">    offsets = offset_linear(reference_points).view(batch_size, seq_len, num_sampling_points, <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># offsets shape: (batch_size, sequence_length, num_sampling_points, 2)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Calculate sampling positions based on reference points</span></span><br><span class="line">    sampling_positions = reference_points.unsqueeze(<span class="number">2</span>) + offsets</span><br><span class="line">    <span class="comment"># sampling_positions shape: (batch_size, sequence_length, num_sampling_points, 2)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Sample values (this is simplified; you might need interpolation)</span></span><br><span class="line">    <span class="comment"># Here, we assume value and reference_points are in the same space for simplicity</span></span><br><span class="line">    sampling_values = value.gather(<span class="number">1</span>, sampling_positions.long())</span><br><span class="line">    <span class="comment"># sampling_values shape: (batch_size, sequence_length, num_sampling_points, embedding_dim)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Calculate scores</span></span><br><span class="line">    <span class="comment"># atten_linear is a linear layer that transforms the query for calculating attention scores</span></span><br><span class="line">    scores = atten_linear(query).view(batch_size, seq_len, num_sampling_points)</span><br><span class="line">    <span class="comment"># scores shape: (batch_size, sequence_length, num_sampling_points)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Softmax to get attention probabilities</span></span><br><span class="line">    probs = F.softmax(scores, dim=-<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># probs shape: (batch_size, sequence_length, num_sampling_points)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Calculate output</span></span><br><span class="line">    output = torch.matmul(probs, sampling_values)</span><br><span class="line">    <span class="comment"># output shape: (batch_size, sequence_length, embedding_dim)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
<h2 id="thought"><a class="markdownIt-Anchor" href="#thought"></a> Thought</h2>
<ul>
<li>用 <code>query</code> 线性映射代替 <code>query</code> 和 <code>key</code> 外积做 <code>attention</code> 数学上可解释性会变差，计算复杂度会降低</li>
<li><code>Deformable Conv</code> 是典型的对 <code>NPU</code> 不友好，<code>Deformable Attention</code> 会更复杂，<s>被代季峰支配的恐惧</s></li>
<li>用 <code>Multi-scale</code> 做各特征尺度上的信息融合，开创了一个 <strong>CNN 做 backbone + Deformable Transformer 做 head 的计算机视觉任务模型新范式</strong>，甚至省去了 <code>FPN</code></li>
<li>总之是用各种便宜的计算来近似复杂的全局 <code>attention</code>，复杂度从 <code>H*W</code> --&gt; <code>K</code>，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>−</mo><mo>&gt;</mo><mi>O</mi><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2) -&gt; O(K)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span></span></span></span></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://real-zhangzhe.github.io/2023/07/18/%E4%B8%80%E4%BA%9B%E9%AB%98%E6%95%88backbone%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangzhe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhangzhe's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/18/%E4%B8%80%E4%BA%9B%E9%AB%98%E6%95%88backbone%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/" class="post-title-link" itemprop="url">一些高效backbone设计思想</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-18 16:35:50" itemprop="dateCreated datePublished" datetime="2023-07-18T16:35:50+08:00">2023-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-11 13:48:26" itemprop="dateModified" datetime="2025-12-11T13:48:26+08:00">2025-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CNN-Architecture-Design/" itemprop="url" rel="index"><span itemprop="name">CNN Architecture Design</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/07/18/%E4%B8%80%E4%BA%9B%E9%AB%98%E6%95%88backbone%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/07/18/%E4%B8%80%E4%BA%9B%E9%AB%98%E6%95%88backbone%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2>
<ul>
<li>本文介绍了 <code>YOLO</code> 系列几种高效的 <code>backbone</code> 设计，主要包括：<code>VoVNet</code>、<code>PRN</code>、<code>CSPNet</code>、<code>ELAN</code>、<code>E-ELAN</code> 等</li>
</ul>
<h2 id="algorithm"><a class="markdownIt-Anchor" href="#algorithm"></a> Algorithm</h2>
<h3 id="1-vovnet"><a class="markdownIt-Anchor" href="#1-vovnet"></a> 1. VoVNet</h3>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1904.09730.pdf">https://arxiv.org/pdf/1904.09730.pdf</a><br />
<img src="https://s2.loli.net/2023/07/18/mhKOv8jGbpPXqJQ.png" alt="vovnet.png" /></li>
<li>作者认为 <code>densenet</code> 存在问题：每一层 <code>Conv</code> 都使用之前所有层的输出，因此会导致当前 <code>Conv</code> 的 <code>input channel</code> 很大，输出到 <code>output channel</code> 却较小</li>
<li>因此，作者只在 <code>VoVNet Block</code> 的最后一个 <code>Conv</code> 才用之前所有层的输出</li>
<li>相同计算量下，效果优于 <code>Resnet</code> 和 <code>DenseNet</code></li>
</ul>
<h3 id="2-prn"><a class="markdownIt-Anchor" href="#2-prn"></a> 2. PRN</h3>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://openaccess.thecvf.com/content_ICCVW_2019/papers/LPCV/Wang_Enriching_Variety_of_Layer-Wise_Learning_Information_by_Gradient_Combination_ICCVW_2019_paper.pdf">https://openaccess.thecvf.com/content_ICCVW_2019/papers/LPCV/Wang_Enriching_Variety_of_Layer-Wise_Learning_Information_by_Gradient_Combination_ICCVW_2019_paper.pdf</a><br />
<img src="https://s2.loli.net/2023/07/18/3I42vcukOx9QZrm.png" alt="prn.png" /></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/WongKinYiu/PartialResidualNetworks/tree/master">https://github.com/WongKinYiu/PartialResidualNetworks/tree/master</a></li>
<li><code>PRN</code> 全称是 <code>Partial Residule Networks</code>, 在 <code>PRN</code> 中，将 <code>identity</code> 连接乘以二进制 <code>Mask</code>，并且只允许将某些通道的特征映射添加到计算块的输出中</li>
</ul>
<h3 id="3-cspnetyolov5"><a class="markdownIt-Anchor" href="#3-cspnetyolov5"></a> 3. CSPNet（YOLOV5）</h3>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1911.11929.pdf">https://arxiv.org/pdf/1911.11929.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/WongKinYiu/CrossStagePartialNetworks">https://github.com/WongKinYiu/CrossStagePartialNetworks</a><br />
<img src="https://s2.loli.net/2023/07/18/xz1IDSeAFBVncuH.png" alt="CSPNet.png" /></li>
<li><code>CPSNet</code> 的全称是 <code>Cross Stage Partial Networks</code>, 本质是把模型分成两部分，其中一部分经过计算（几层 Conv）后和另外一部分合起来，相当于第二部分和第一部分模型深度不同</li>
</ul>
<h3 id="4-elan"><a class="markdownIt-Anchor" href="#4-elan"></a> 4. ELAN</h3>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2211.04800.pdf">https://arxiv.org/pdf/2211.04800.pdf</a><br />
<img src="https://s2.loli.net/2023/07/18/w4gqVE1Az5Sck9m.png" alt="elan.png" /></li>
<li><code>ELAN</code> 全称是 <code>Efficient Layer Aggregation Network</code>, 作者以 <code>VoVNet</code> 和 <code>ResNet</code> 做对比，<code>VoVNet</code> 在叠加更多 <code>block</code> 时表现要比 <code>ResNet</code> 更差，作者分析是因为 <code>VoVNet</code> 结构中存在过多的 <code>transition layers</code>，这导致在叠加 <code>block</code> 时最短梯度路径（ <code>the shortest gradient path</code> ）不断增加，从而使得 <code>block</code> 增加时训练难度上升</li>
<li><code>PRN</code> 相比 <code>ResNet</code>，使用 <code>mask</code> 让输入只有部分 <code>channel</code> 通过 <code>identity connection</code>，丰富了梯度来源；</li>
<li><code>CSPNet</code> 通过将 <code>channel split</code>，一方面增加了梯度信息（同 <code>PRN</code>），另一方面减少了 <code>computational block</code> 中的计算量；</li>
<li><code>ELAN</code> 的思想是：搭建网络时需要考虑每一层的最短最长梯度路径，还要考虑整个网络的最长梯度路径。</li>
</ul>
<h3 id="5-e-elanyolov7"><a class="markdownIt-Anchor" href="#5-e-elanyolov7"></a> 5. E-ELAN（YOLOV7）</h3>
<ul>
<li>paper: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2207.02696.pdf">https://arxiv.org/pdf/2207.02696.pdf</a></li>
<li>code: <a target="_blank" rel="noopener" href="https://github.com/WongKinYiu/yolov7">https://github.com/WongKinYiu/yolov7</a><br />
<img src="https://s2.loli.net/2023/07/18/cZANQbK5R7Vmoag.png" alt="eelan.png" /></li>
<li><code>E-ELAN</code> 是 <code>extended ELAN</code>，在不改变 <code>gradient path</code> 的情况下，加入了 <code>Group Conv</code>、<code>Shuffle and merge Conv</code> 等操作，极大的提高了模型表现能力，成就了 <code>YOLOV7</code> 又快又好的效果！</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zhangzhe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">176</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">105</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhangzhe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js', () => {
    // 初始化 Mermaid 配置
    mermaid.initialize({
      theme    : 'dark',  // 设置主题
      logLevel : 3,  // 设置日志等级
      flowchart: { curve: 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 },
      themeVariables: {
        'fontFamily': 'Microsoft YaHei, Arial, sans-serif',  // 设置中文字体
      }
    });

    // 初始化 Mermaid 图表
    mermaid.init(undefined, document.querySelectorAll('pre.mermaid'));
  }, window.mermaid);
}
</script>


  

  
      
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css">


  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'eK3W25jybCO5jVUrYBBpAPqM-gzGzoHsz',
      appKey     : 'F4KVyUj9wHI5c80Bhz7O2uhq',
      placeholder: "说点什么再走吧...",
      avatar     : 'hide',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
